import{M as e,Q as t,_ as n,a$ as r,a2 as i,aC as a,aG as o,aH as s,aI as c,aN as l,aO as u,aS as d,aU as f,aV as p,aX as m,aY as h,aZ as ee,ar as te,ay as g,b0 as _,b3 as ne,b5 as v,b6 as y,bd as b,bf as x,bg as S,bh as re,bj as C,d as ie,j as ae,q as oe,r as se,y as w}from"./index-BogmXPcL.js";import"./GlobalConfig-wPgXFcZ5.js";import{b as T}from"./StatCard-CZ1uUQrS.js";import{c as ce,f as E}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import{b as le}from"./PageHeader-fwn1kRSK.js";import{c as ue}from"./itemsStore-ClNTeteu.js";import{b as de}from"./warehousesStore-CKx0g_pZ.js";var D=class{baseUrl=`/items/movements`;async getItemMovements(e){try{let t=this.buildQueryParams(e),n=await g(`${this.baseUrl}?${t}`,{loadingMessage:`Loading item movements...`,showLoading:!0});return{data:n.data.data||[],stats:n.data.stats||{total_credit:0,total_debit:0,balance:0}}}catch(e){throw console.error(`Error fetching item movements:`,e),e}}async getItemMovement(e){try{let t=await g(`${this.baseUrl}/${e}`,{loadingMessage:`Loading item movement...`});return t.data.data}catch(e){throw console.error(`Error fetching item movement:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const O=new D,fe=c(`itemMovements`,()=>{let e=x([]),t=x(null),n=x({total_credit:0,total_debit:0,balance:0}),r=x(!1),i=x({}),a=async t=>{try{r.value=!0,t&&(i.value={...i.value,...t});let a=await O.getItemMovements(i.value);e.value=a.data,n.value=a.stats}catch(e){throw console.error(`Error fetching item movements:`,e),e}finally{r.value=!1}},o=async e=>{try{let n=await O.getItemMovement(e);return t.value=n,n}catch(e){throw console.error(`Error fetching item movement:`,e),e}},s=e=>{i.value={...i.value,...e}},c=()=>{i.value={}},l=()=>{t.value=null},u=()=>{e.value=[],t.value=null,n.value={total_credit:0,total_debit:0,balance:0},i.value={},r.value=!1};return{itemMovements:e,currentItemMovement:t,stats:n,loading:r,filters:i,fetchItemMovements:a,fetchItemMovement:o,updateFilters:s,clearFilters:c,clearCurrentItemMovement:l,reset:u}}),pe={class:`space-y-6`},me={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},he={class:`grid grid-cols-1 md:grid-cols-3 gap-4`},k={class:`md:col-span-2`},A={class:`relative`},j={key:0,class:`absolute z-10 mt-1 w-full md:w-2/3 bg-white dark:bg-gray-700 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm`},M=[`onClick`],N={class:`flex items-center`},P={class:`font-medium block truncate text-gray-900 dark:text-white`},F={class:`text-gray-500 dark:text-gray-400 ml-2 text-xs block truncate`},I={key:0,class:`flex items-end`},L={class:`w-full p-3 bg-blue-50 dark:bg-blue-900 rounded-md`},R={class:`flex justify-between items-start`},ge={class:`text-sm font-medium text-blue-900 dark:text-blue-100`},_e={class:`text-xs text-blue-700 dark:text-blue-300`},ve={key:0,class:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6`},ye={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},be={class:`grid grid-cols-1 md:grid-cols-6 gap-4`},xe=[`value`],Se={class:`relative`},Ce={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},we={key:0,class:`p-8 text-center`},Te={key:1,class:`p-8 text-center`},Ee={class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},De={key:2,class:`overflow-x-auto`},Oe={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},ke={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ae={class:`px-4 py-1 whitespace-nowrap`},je={class:`text-sm text-gray-900 dark:text-white`},Me={class:`px-4 py-1 whitespace-nowrap`},Ne={class:`text-sm text-gray-900 dark:text-white`},Pe={class:`px-4 py-1 whitespace-nowrap`},Fe={class:`px-4 py-1 whitespace-nowrap`},Ie={class:`text-sm text-gray-900 dark:text-white`},Le={class:`px-4 py-1 whitespace-nowrap text-right`},Re={class:`text-sm font-medium text-green-600 dark:text-green-400`},ze={class:`px-4 py-1 whitespace-nowrap text-right`},Be={class:`text-sm font-medium text-red-600 dark:text-red-400`},Ve={class:`px-4 py-1 whitespace-nowrap text-right`},He={class:`text-sm font-medium text-blue-600 dark:text-blue-400`},Ue={class:`px-4 py-1 whitespace-nowrap`},We={class:`text-sm text-gray-900 dark:text-white`},Ge={class:`px-4 py-1 whitespace-nowrap text-center`},Ke=[`onClick`],qe={key:1,class:`text-gray-400`},Je={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center`};var z=_({__name:`IndexPage`,setup(c){let g=s(),_=o(),D=a(),O=ue(),z=fe(),B=de(),V=ie(),H=x(!1),U=x(null),W=x(``),G=x(null),K=x({search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``}),q=f(()=>z.itemMovements),J=f(()=>z.stats),Ye=f(()=>B.warehousesForSelect),Xe=f(()=>J.value?.total_credit||0),Ze=f(()=>J.value?.total_debit||0),Qe=f(()=>J.value?.balance||0),Y=f(()=>V.items),X=f(()=>{if(!W.value||W.value.length<2)return[];let e=W.value.toLowerCase();return Y.value.filter(t=>{let n=t.code?.toLowerCase()||``,r=t.short_name?.toLowerCase()||``,i=t.description?.toLowerCase()||``;return n.includes(e)||r.includes(e)||i.includes(e)}).slice(0,20)}),$e=e=>{G.value=e,W.value=`${e.code} - ${e.short_name}`,Z()},et=()=>{G.value=null,W.value=``,z.reset(),$()},Z=async()=>{if(G.value?.id)try{H.value=!0,await z.fetchItemMovements({item_id:G.value.id,...K.value})}catch(e){D.error(`Failed to load item movements`,{title:`Error`}),console.error(`Error fetching movements:`,e)}finally{H.value=!1}},tt=async e=>{try{H.value=!0;let t=typeof e==`string`?parseInt(e):e,n=await O.fetchItem(t);n?(G.value=n,W.value=`${n.code} - ${n.short_name}`,await Z()):D.error(`Item not found`)}catch(e){D.error(`Failed to load item`,{title:`Error`}),console.error(`Error loading item:`,e)}finally{H.value=!1}},nt=()=>{U.value&&clearTimeout(U.value),U.value=setTimeout(()=>{Z()},300)},Q=()=>{Z()},$=()=>{K.value={search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``},G.value&&Z()},rt=e=>{let t={purchase:`Purchase`,sale:`Sale`,transfer_in:`Transfer In`,transfer_out:`Transfer Out`,adjust_add:`Adjust Add`,adjust_subtract:`Adjust Subtract`,purchase_return:`Purchase Return`,sale_return:`Sale Return`};return t[e]||e},it=e=>{let t={purchase:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`,sale:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100`,transfer_in:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100`,transfer_out:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100`,adjust_add:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-teal-100 text-teal-800 dark:bg-teal-800 dark:text-teal-100`,adjust_subtract:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100`,purchase_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100`,sale_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-100`};return t[e]||`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100`},at=e=>{if(!e.transaction_type||!e.parent_id)return;let t={sale:`sales.show`,purchase:`purchases.view`,transfer_in:`item-transfers.view`,transfer_out:`item-transfers.view`,adjustment:`item-adjusts.view`,initial_inventory:`items.view`,purchase_return:`purchase-returns.view`,sale_return:`customer.return.show`},n=t[e.transaction_type];if(!n){console.warn(`No route mapping for transaction type:`,e.transaction_type);return}let r=g.resolve({name:n,params:{id:e.parent_id}});window.open(r.href,`_blank`)};return ne(async()=>{await V.fetchItems(),await B.fetchWarehouses();let e=_.params.id;e&&await tt(e)}),(a,o)=>(v(),h(`div`,pe,[r(le,{title:`Item Movements`,description:`Search and view item transaction history including purchases, sales, transfers, and adjustments`,showCreateButton:!1}),p(`div`,me,[p(`div`,he,[p(`div`,k,[o[6]||=p(`label`,{for:`item-search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Item (by code or name) `,-1),p(`div`,A,[b(p(`input`,{id:`item-search`,"onUpdate:modelValue":o[0]||=e=>W.value=e,type:`text`,placeholder:`Enter item code or name...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`},null,512),[[u,W.value]]),r(S(w),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})]),X.value.length>0&&W.value?(v(),h(`div`,j,[(v(!0),h(d,null,y(X.value,e=>(v(),h(`div`,{key:e.id,onClick:t=>$e(e),class:`cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100 dark:hover:bg-gray-600`},[p(`div`,N,[p(`span`,P,C(e.code)+` - `+C(e.short_name),1)]),p(`span`,F,C(e.description),1)],8,M))),128))])):m(``,!0)]),G.value?(v(),h(`div`,I,[p(`div`,L,[p(`div`,R,[p(`div`,null,[p(`p`,ge,C(G.value.code)+` - `+C(G.value.short_name),1),p(`p`,_e,C(G.value.description),1)]),p(`button`,{onClick:et,class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`},[r(S(ae),{class:`h-4 w-4`})])])])])):m(``,!0)])]),G.value&&q.value.length>0?(v(),h(`div`,ve,[r(T,{label:`Total In`,value:S(E)(Xe.value),icon:S(oe),"icon-color":`green`},null,8,[`value`,`icon`]),r(T,{label:`Total Out`,value:S(E)(Ze.value),icon:S(se),"icon-color":`red`},null,8,[`value`,`icon`]),r(T,{label:`Net Balance`,value:S(E)(Qe.value),icon:S(e),"icon-color":`blue`},null,8,[`value`,`icon`]),r(T,{label:`Total Movements`,value:q.value.length.toString(),icon:S(te),"icon-color":`purple`},null,8,[`value`,`icon`])])):m(``,!0),G.value?(v(),h(`div`,ye,[p(`div`,be,[p(`div`,null,[o[7]||=p(`label`,{for:`from_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` From Date `,-1),b(p(`input`,{id:`from_date`,"onUpdate:modelValue":o[1]||=e=>K.value.from_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[u,K.value.from_date]])]),p(`div`,null,[o[8]||=p(`label`,{for:`to_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` To Date `,-1),b(p(`input`,{id:`to_date`,"onUpdate:modelValue":o[2]||=e=>K.value.to_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[u,K.value.to_date]])]),p(`div`,null,[o[10]||=p(`label`,{for:`warehouse`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Warehouse `,-1),b(p(`select`,{id:`warehouse`,"onUpdate:modelValue":o[3]||=e=>K.value.warehouse_id=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},[o[9]||=p(`option`,{value:``},`All Warehouses`,-1),(v(!0),h(d,null,y(Ye.value,e=>(v(),h(`option`,{key:e.value,value:e.value},C(e.label),9,xe))),128))],544),[[l,K.value.warehouse_id]])]),p(`div`,null,[o[12]||=p(`label`,{for:`movement_type`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Movement Type `,-1),b(p(`select`,{id:`movement_type`,"onUpdate:modelValue":o[4]||=e=>K.value.movement_type=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},o[11]||=[ee(`<option value="">All Types</option><option value="purchase">Purchase</option><option value="sale">Sale</option><option value="transfer_in">Transfer In</option><option value="transfer_out">Transfer Out</option><option value="adjust_add">Adjust Add</option><option value="adjust_subtract">Adjust Subtract</option><option value="purchase_return">Purchase Return</option><option value="sale_return">Sale Return</option>`,9)],544),[[l,K.value.movement_type]])]),p(`div`,null,[o[13]||=p(`label`,{for:`search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search `,-1),p(`div`,Se,[b(p(`input`,{id:`search`,"onUpdate:modelValue":o[5]||=e=>K.value.search=e,type:`text`,placeholder:`Search...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:nt},null,544),[[u,K.value.search]]),r(S(w),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})])]),p(`div`,{class:`flex items-end`},[p(`button`,{onClick:$,class:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200`},` Clear `)])])])):m(``,!0),G.value?(v(),h(`div`,Ce,[H.value?(v(),h(`div`,we,[r(S(t),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),o[14]||=p(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading movements...`,-1)])):q.value.length===0?(v(),h(`div`,Te,[r(S(n),{class:`h-12 w-12 mx-auto text-gray-400`}),o[15]||=p(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No movements found `,-1),p(`p`,Ee,C(K.value.search||K.value.movement_type?`Try adjusting your search criteria.`:`No movements available for this item.`),1)])):(v(),h(`div`,De,[p(`table`,Oe,[o[16]||=p(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[p(`tr`,null,[p(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Date `),p(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Trans # `),p(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Type `),p(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Warehouse `),p(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Credit (In) `),p(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Debit (Out) `),p(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Balance `),p(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` By `),p(`th`,{class:`px-4 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Action `)])],-1),p(`tbody`,ke,[(v(!0),h(d,null,y(q.value,e=>(v(),h(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200`},[p(`td`,Ae,[p(`div`,je,C(S(ce)(e.date)),1)]),p(`td`,Me,[p(`div`,Ne,C(e.code||`-`),1)]),p(`td`,Pe,[p(`span`,{class:re(it(e.type))},C(rt(e.type)),3)]),p(`td`,Fe,[p(`div`,Ie,C(e.warehouse?.name||`-`),1)]),p(`td`,Le,[p(`div`,Re,C(e.credit?S(E)(e.credit):`-`),1)]),p(`td`,ze,[p(`div`,Be,C(e.debit?S(E)(e.debit):`-`),1)]),p(`td`,Ve,[p(`div`,He,C(S(E)(e.balance)),1)]),p(`td`,Ue,[p(`div`,We,C(e.by||`N/A`),1)]),p(`td`,Ge,[e.code?(v(),h(`button`,{key:0,onClick:t=>at(e),class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`,title:`View Details`},[r(S(i),{class:`h-4 w-4`})],8,Ke)):(v(),h(`span`,qe,`-`))])]))),128))])])]))])):(v(),h(`div`,Je,[r(S(e),{class:`h-16 w-16 mx-auto text-gray-400 mb-4`}),o[17]||=p(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Select an Item `,-1),o[18]||=p(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},` Search and select an item to view its movement history `,-1)]))]))}}),B=z;export{B as default};