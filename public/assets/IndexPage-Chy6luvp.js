import{I as e,S as t,a$ as n,aD as r,aF as i,aG as a,aI as o,aJ as s,aL as ee,aM as c,aN as te,aR as l,aS as u,aY as ne,aZ as d,an as re,as as ie,az as f,b0 as p,b1 as ae,b3 as m,h as oe,i as se,s as h,x as g,z as ce}from"./index-DMU9rpXT.js";import"./GlobalConfig-Dep5CV3r.js";import"./tableUtils-BFc6-TYF.js";import{b as le}from"./PageHeader-CVBZ9Zix.js";import{c as ue,f as _}from"./common-DNevajli.js";import{b as v}from"./StatCard-CxIk6-0v.js";import{b as y}from"./currencyUtil-DFY2m5KW.js";import{b as de}from"./customersStore-DmnCoJQX.js";const fe={class:`space-y-6`},pe=[`disabled`],me={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},he={class:`grid grid-cols-1 md:grid-cols-3 gap-4`},ge={class:`md:col-span-2`},_e={class:`relative`},b={key:0,class:`absolute z-10 mt-1 w-full md:w-2/3 bg-white dark:bg-gray-700 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm`},x=[`onClick`],S={class:`flex items-center`},C={class:`font-medium block truncate text-gray-900 dark:text-white`},w={class:`text-gray-500 dark:text-gray-400 ml-2 text-xs block truncate`},T={key:0,class:`flex items-end`},E={class:`w-full p-3 bg-blue-50 dark:bg-blue-900 rounded-md`},D={class:`flex justify-between items-start`},O={class:`text-sm font-medium text-blue-900 dark:text-blue-100`},k={class:`text-xs text-blue-700 dark:text-blue-300`},A={key:0,class:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6`},j={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},M={class:`grid grid-cols-1 md:grid-cols-6 gap-4`},N={class:`md:col-span-2`},P={class:`relative`},F={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},I={key:0,class:`p-8 text-center`},ve={key:1,class:`p-8 text-center`},ye={class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},be={key:2,class:`overflow-x-auto`},xe={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Se={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ce={class:`px-4 py-1 whitespace-nowrap`},we={class:`text-sm text-gray-900 dark:text-white`},Te={class:`px-4 py-1 whitespace-nowrap`},Ee={class:`px-4 py-1 whitespace-nowrap`},De=[`onClick`],Oe={key:1,class:`text-sm text-gray-900 dark:text-white`},ke={class:`px-4 py-1 whitespace-nowrap`},Ae={class:`text-sm text-gray-900 dark:text-white`},je={class:`px-4 py-1 whitespace-nowrap text-right`},Me={class:`text-sm font-medium text-red-600 dark:text-red-400`},Ne={class:`px-4 py-1 whitespace-nowrap text-right`},Pe={class:`text-sm font-medium text-green-600 dark:text-green-400`},Fe={class:`px-4 py-1 whitespace-nowrap text-right`},Ie={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center`};var L=te({__name:`IndexPage`,setup(te){let L=ie(),R=re(),z=de(),B=n(!1),V=n([]),H=n({}),U=n(null),W=n(null),G=n(``),K=n([]),q=n(null),J=n({search:``,from_date:``,to_date:``,transaction_type:``,withPage:!1}),Y=i(()=>q.value?.id),Le=()=>{W.value&&clearTimeout(W.value),W.value=setTimeout(async()=>{G.value.length>=2?await Re():K.value=[]},300)},Re=async()=>{try{await z.fetchCustomers({search:G.value,per_page:10}),K.value=z.customers}catch(e){console.error(`Error searching customers:`,e),R.error(`Failed to search customers`)}},ze=e=>{q.value=e,G.value=`${e.code} - ${e.name}`,K.value=[],X()},Be=()=>{q.value=null,G.value=``,V.value=[],H.value={},$()},X=async()=>{if(Y.value)try{B.value=!0;let e=await z.fetchCustomerStatements(Y.value,J.value);V.value=e.data,H.value=e.stats}catch(e){R.error(`Failed to load customer statements`,{title:`Error`}),console.error(`Error fetching statements:`,e)}finally{B.value=!1}},Ve=()=>{U.value&&clearTimeout(U.value),U.value=setTimeout(()=>{X()},300)},Z=()=>{X()},Q=e=>{if(!e.id||!e.transaction_type)return;let t={sale:`sales.show`,payment:`customer.payments.show`,credit_debit_note:`customer.notes.show`,customer_returns:`customer.return.show`},n=t[e.transaction_type];if(!n)return;let r=L.resolve({name:n,params:{id:e.id}});window.open(r.href,`_blank`)},$=()=>{J.value={search:``,from_date:``,to_date:``,transaction_type:``,withPage:!1},q.value&&X()},He=e=>{let t={sales:`Sales`,payments:`Payment`,credit_note:`Credit Note`,debit_note:`Debit Note`,returns:`Return`};return t[e]||e},Ue=()=>{Y.value&&L.push({name:`customers.statement.preview`,params:{id:Y.value},query:{from_date:J.value.from_date,to_date:J.value.to_date,search:J.value.search,transaction_type:J.value.transaction_type}})};return(n,i)=>(l(),s(`div`,fe,[c(le,{title:`Customer Statements`,description:`Search and view customer transaction history including sales, payments, and notes`,showCreateButton:!1},{actions:ne(()=>[q.value?(l(),s(`button`,{key:0,onClick:Ue,disabled:V.value.length===0,class:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[c(p(ce),{class:`w-4 h-4 mr-2`}),i[4]||=ee(` Print Preview `,-1)],8,pe)):o(``,!0)]),_:1}),a(`div`,me,[a(`div`,he,[a(`div`,ge,[i[5]||=a(`label`,{for:`customer-search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Customer (by name or code) `,-1),a(`div`,_e,[d(a(`input`,{id:`customer-search`,"onUpdate:modelValue":i[0]||=e=>G.value=e,type:`text`,placeholder:`Enter customer name or code...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Le},null,544),[[f,G.value]]),c(p(h),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})]),K.value.length>0&&G.value?(l(),s(`div`,b,[(l(!0),s(r,null,u(K.value,e=>(l(),s(`div`,{key:e.id,onClick:t=>ze(e),class:`cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100 dark:hover:bg-gray-600`},[a(`div`,S,[a(`span`,C,m(e.code)+` - `+m(e.name),1)]),a(`span`,w,m(e.city),1)],8,x))),128))])):o(``,!0)]),q.value?(l(),s(`div`,T,[a(`div`,E,[a(`div`,D,[a(`div`,null,[a(`p`,O,m(q.value.code)+` - `+m(q.value.name),1),a(`p`,k,m(q.value.city),1)]),a(`button`,{onClick:Be,class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`},[c(p(oe),{class:`h-4 w-4`})])])])])):o(``,!0)])]),q.value?(l(),s(`div`,A,[c(v,{label:`Balance`,value:p(_)(H.value.balance),icon:p(g),"icon-color":`blue`},null,8,[`value`,`icon`]),c(v,{label:`Credit`,value:p(_)(H.value.total_credit),icon:p(g),"icon-color":`green`},null,8,[`value`,`icon`]),c(v,{label:`Debit`,value:p(_)(H.value.total_debit),icon:p(g),"icon-color":`red`},null,8,[`value`,`icon`])])):o(``,!0),q.value?(l(),s(`div`,j,[a(`div`,M,[a(`div`,N,[i[6]||=a(`label`,{for:`search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Note `,-1),a(`div`,P,[d(a(`input`,{id:`search`,"onUpdate:modelValue":i[1]||=e=>J.value.search=e,type:`text`,placeholder:`Search note...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Ve},null,544),[[f,J.value.search]]),c(p(h),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})])]),a(`div`,null,[i[7]||=a(`label`,{for:`from_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` From Date `,-1),d(a(`input`,{id:`from_date`,"onUpdate:modelValue":i[2]||=e=>J.value.from_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Z},null,544),[[f,J.value.from_date]])]),a(`div`,null,[i[8]||=a(`label`,{for:`to_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` To Date `,-1),d(a(`input`,{id:`to_date`,"onUpdate:modelValue":i[3]||=e=>J.value.to_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Z},null,544),[[f,J.value.to_date]])]),a(`div`,{class:`flex items-end`},[a(`button`,{onClick:$,class:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200`},` Clear `)])])])):o(``,!0),q.value?(l(),s(`div`,F,[B.value?(l(),s(`div`,I,[c(p(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),i[9]||=a(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading statements...`,-1)])):V.value.length===0?(l(),s(`div`,ve,[c(p(t),{class:`h-12 w-12 mx-auto text-gray-400`}),i[10]||=a(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No statements found `,-1),a(`p`,ye,m(J.value.search||J.value.transaction_type?`Try adjusting your search criteria.`:`No transactions available for this customer.`),1)])):(l(),s(`div`,be,[a(`table`,xe,[i[14]||=a(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[a(`tr`,null,[a(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Date `),a(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Type `),a(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Transaction ID `),a(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Note `),a(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Debit `),a(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Credit `),a(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Balance `)])],-1),a(`tbody`,Se,[(l(!0),s(r,null,u(V.value,e=>(l(),s(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200`},[a(`td`,Ce,[a(`div`,we,m(p(ue)(e.date)),1)]),a(`td`,Te,m(He(e.type)),1),a(`td`,Ee,[e.code?(l(),s(`div`,{key:0,onClick:t=>Q(e),class:`text-sm text-blue-600 dark:text-blue-400 cursor-zoom-in hover:underline`},m(e.code),9,De)):(l(),s(`div`,Oe,` - `))]),a(`td`,ke,[a(`div`,Ae,m(e.note||`-`),1)]),a(`td`,je,[a(`div`,Me,m(e.debit?p(y)(e.debit,!0):`-`),1)]),a(`td`,Ne,[a(`div`,Pe,m(e.credit?p(y)(e.credit,!0):`-`),1)]),a(`td`,Fe,[a(`div`,{class:ae([`text-sm font-medium`,e.balance>=0?`text-green-600 dark:text-green-400`:`text-red-600 dark:text-red-400`])},m(p(y)(e.balance,!0)),3)])]))),128)),i[13]||=a(`tr`,null,[a(`td`,{class:`px-4 py-2`,colspan:`7`},`\xA0`)],-1),o(``,!0)])])]))])):(l(),s(`div`,Ie,[c(p(se),{class:`h-16 w-16 mx-auto text-gray-400 mb-4`}),i[15]||=a(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Select a Customer `,-1),i[16]||=a(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},` Search and select a customer to view their statement `,-1)]))]))}}),R=L;export{R as default};