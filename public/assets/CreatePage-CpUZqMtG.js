import{M as e,Y as t,a$ as n,aC as r,aI as i,aM as ee,aN as a,aP as o,aQ as s,aS as c,aT as l,aV as u,aW as d,aX as f,aZ as te,aj as ne,ax as re,b0 as p,b2 as ie,b7 as m,b9 as h,ba as g,bb as _,bd as v,d as ae,h as oe}from"./index-DK9OQQwU.js";import{b as se}from"./GlobalConfig-wPgXFcZ5.js";import"./tableUtils-ylneqlK-.js";import{f as y}from"./common-qdv5PS_C.js";import"./currencyUtil-BdcLyycc.js";import{b as ce}from"./salaryStore-n45RJBQZ.js";import{b as le,c as ue,d as de}from"./EmployeeDailyBusinessBreadDown-DdDSqMcJ.js";const fe={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},pe={class:`mx-auto`},me={class:`mb-8`},he={class:`flex items-center space-x-4 mb-2`},ge={class:`grid grid-cols-12 gap-4`},_e={class:`col-span-4`},ve={class:`flex items-center gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-4`},b=[`value`],x=[`value`],S={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},C={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},w={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},T={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},E={class:`px-3 py-2 text-center border border-gray-300 dark:border-gray-600`},D=[`onClick`],O={key:0},k={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},A={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},j={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},M={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},N={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},P={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},F={class:`px-3 py-2 text-center border border-gray-300 dark:border-gray-600`},ye=[`onClick`],be={class:`col col-span-8`},xe={key:0,class:`text-lg`},Se={key:1},Ce={class:`flex items-center justify-between gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md`},we={class:`flex gap-3`},Te={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},Ee={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},De={key:2},Oe={key:3,class:`bg-white mt-4 dark:bg-gray-800 shadow rounded-lg`},ke={class:`p-6`},Ae={class:`mb-4 text-sm text-gray-700 dark:text-gray-300`},je={class:`mb-1`},Me={class:`w-full border-collapse mb-4`},Ne={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Pe={class:`px-3 py-2 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100`},Fe={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ie={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Le={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Re={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},ze={class:`bg-gray-100 dark:bg-gray-700`},Be={class:`px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`},Ve={class:`px-3 py-2 rounded-md bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 font-semibold text-gray-900 dark:text-gray-100`},He={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ue=[`disabled`],We=[`value`],Ge={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ke={key:0,class:`border-1 rounded bg-red-500/10 p-2`},qe={class:`text-red-800`},Je={class:`flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700`},Ye=[`disabled`],Xe=[`disabled`],Ze={key:0,class:`flex items-center justify-center`},Qe={key:1};var I=f({__name:`CreatePage`,setup(f){let I=h(null),L=r(),R=ce(),z=ae(),{showSuccess:$e,showError:B}=re(),V=h(!1),H=h(!1),U=h({}),W=new Date,et=W.getMonth()+1,G=W.getFullYear(),K=h(et),q=h(G),J=h({date:new Date().toISOString().split(`T`)[0],employee_id:0,account_id:0,month:new Date().getMonth()+1,year:new Date().getFullYear(),sub_total:0,advance_payment:0,base_salary:0,others:0,final_total:0,others_note:``,note:``}),Y=[{value:1,label:`January`},{value:2,label:`February`},{value:3,label:`March`},{value:4,label:`April`},{value:5,label:`May`},{value:6,label:`June`},{value:7,label:`July`},{value:8,label:`August`},{value:9,label:`September`},{value:10,label:`October`},{value:11,label:`November`},{value:12,label:`December`}],tt=o(()=>{let e=[];for(let t=se.commissionStartYear;t<=G;t++)e.push(t);return e.reverse()});o(()=>{let e=new Date().getFullYear(),t=[];for(let n=e-5;n<=e+1;n++)t.push(n);return t.reverse()});let nt=o(()=>z.employees),rt=o(()=>z.accounts||[]),it=o(()=>R.salaries),X=o(()=>R.pendingLoan),at=o(()=>Object.keys(U.value).length>0);o(()=>J.value.month>0&&J.value.month<=12?Y[J.value.month-1]:``);let ot=e=>{U.value[e]&&delete U.value[e]},st=e=>{U.value={};for(let[t,n]of Object.entries(e))n&&n.length>0&&(U.value[t]=n[0])},Z=()=>{U.value={}},Q=()=>{let e=Number(J.value.sub_total)||0,t=Number(J.value.advance_payment)||0,n=Number(J.value.base_salary)||0,r=Number(J.value.others)||0;J.value.final_total=e-t+r+n},ct=()=>{J.value={date:new Date().toISOString().split(`T`)[0],employee_id:0,account_id:0,month:new Date().getMonth()+1,year:new Date().getFullYear(),sub_total:0,advance_payment:0,base_salary:0,others:0,final_total:0,others_note:``,note:``},Z()},lt=()=>{Z();let e={};if(J.value.date||(e.date=`Date is required`),(!J.value.employee_id||J.value.employee_id<=0)&&(e.employee_id=`Employee is required`),(!J.value.account_id||J.value.account_id<=0)&&(e.account_id=`Account is required`),(!J.value.month||J.value.month<1||J.value.month>12)&&(e.month=`Valid month is required`),(!J.value.year||J.value.year<2e3||J.value.year>2100)&&(e.year=`Valid year is required`),(J.value.sub_total===void 0||J.value.sub_total<0)&&(e.sub_total=`Sub total must be 0 or greater`),(J.value.advance_payment===void 0||J.value.advance_payment<0)&&(e.advance_payment=`Advance payment must be 0 or greater`),J.value.others===void 0&&(e.others=`Others amount is required`),J.value.others_note&&J.value.others_note.length>500&&(e.others_note=`Others note cannot exceed 500 characters`),J.value.note&&J.value.note.length>1e3&&(e.note=`Notes cannot exceed 1000 characters`),U.value=e,Object.keys(e).length>0){let t=Object.values(e).join(`, `);B(`Validation failed: ${t}`)}return Object.keys(e).length===0},ut=async()=>{if(lt())try{V.value=!0,await R.createSalary(J.value),ct(),$e(`Salary created successfully`),L.push({name:`employees.salaries.index`})}catch(e){e.response?.status===422&&e.response?.data?.errors?st(e.response.data.errors):B(e.response?.data?.message||`Failed to create salary`)}finally{V.value=!1}},dt=()=>{L.push({name:`employees.salaries.index`})},ft=()=>{L.go(-1)},$=async e=>{try{H.value=!0;let t=await de.getMonthlyCommission({employee_id:e,month:K.value,year:q.value});I.value=t,await R.fetchPendingLoan(e),await pt(e),J.value.employee_id=e,J.value.month=K.value,J.value.year=q.value,J.value.sub_total=I.value.total_commission,J.value.advance_payment=X?.value||0,J.value.base_salary=I.value.business_summary.base_salary,Q()}catch(e){console.error(`Error fetching commission data:`,e)}finally{H.value=!1}},pt=async e=>{await R.fetchSalaries({employee_id:e})},mt=async()=>{try{z.employees.length===0&&await z.fetchListData(`employees`)}catch(e){console.error(`Failed to load employees:`,e)}},ht=async()=>{try{z.accounts.length===0&&await z.fetchListData(`accounts`)}catch(e){console.error(`Failed to load accounts:`,e)}};return te(async()=>{await Promise.all([mt(),ht()])}),(r,o)=>{let f=ie(`Input`);return n(),l(`div`,fe,[s(`div`,pe,[s(`div`,me,[s(`div`,he,[s(`button`,{onClick:ft,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[d(g(ne),{class:`w-5 h-5`})]),o[9]||=s(`div`,null,[s(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Create Employee Salary `),s(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Add a new salary record for an employee `)],-1)])]),s(`div`,ge,[s(`div`,_e,[s(`div`,ve,[s(`div`,null,[o[10]||=s(`label`,{class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},`Month`,-1),m(s(`select`,{"onUpdate:modelValue":o[0]||=e=>K.value=e,class:`px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500`},[(n(),l(a,null,p(Y,e=>s(`option`,{key:e.value,value:e.value},v(e.label),9,b)),64))],512),[[i,K.value]])]),s(`div`,null,[o[11]||=s(`label`,{class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},`Year`,-1),m(s(`select`,{"onUpdate:modelValue":o[1]||=e=>q.value=e,class:`px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500`},[(n(!0),l(a,null,p(tt.value,e=>(n(),l(`option`,{key:e,value:e},v(e),9,x))),128))],512),[[i,q.value]])])]),o[15]||=s(`div`,{class:`mb-3 text-lg font-semibold text-gray-900 dark:text-gray-100`},`Employees`,-1),s(`table`,S,[o[12]||=s(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[s(`tr`,null,[s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` #`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Employee`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Department`),s(`th`,{class:`px-3 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Action`)])],-1),s(`tbody`,null,[(n(!0),l(a,null,p(nt.value,(e,t)=>(n(),l(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[s(`td`,C,v(t+1),1),s(`td`,w,v(e.name),1),s(`td`,T,v(e.department?.name),1),s(`td`,E,[s(`button`,{onClick:t=>$(e.id),class:`text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200`,title:`View details`},[d(g(oe),{class:`w-4 h-4`})],8,D)])]))),128))])]),I.value&&!H.value?(n(),l(`div`,O,[o[14]||=s(`div`,{class:`mb-3 text-lg py-4 mt-6 border-gray-400 border-t-2 font-semibold text-gray-900 dark:text-gray-100`},` Salary History`,-1),s(`table`,k,[o[13]||=s(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[s(`tr`,null,[s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Month`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Comm.`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Adv.`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Others`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Total`),s(`th`,{class:`px-3 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Act.`)])],-1),s(`tbody`,null,[(n(!0),l(a,null,p(it.value,(e,r)=>(n(),l(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[s(`td`,A,v(e.month)+` / `+v(e.year),1),s(`td`,j,v(e.sub_total),1),s(`td`,M,v(e.advance_payment),1),s(`td`,N,v(e.others),1),s(`td`,P,v(e.final_total),1),s(`td`,F,[s(`button`,{onClick:t=>$(e.id),class:`text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200`,title:`View details`},[d(g(t),{class:`w-4 h-4`})],8,ye)])]))),128))])])])):c(``,!0)]),s(`div`,be,[H.value?(n(),l(`div`,xe,[d(g(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`})])):c(``,!0),I.value&&!H.value?(n(),l(`div`,Se,[s(`div`,Ce,[s(`div`,null,` Employee: `+v(I.value?.business_summary.employee_name),1),s(`div`,we,[s(`div`,null,[s(`label`,Te,`Month: `+v(K.value),1)]),s(`div`,null,[s(`label`,Ee,`Year : `+v(q.value),1)])])])])):c(``,!0),I.value&&!H.value?(n(),l(`div`,De,[s(`div`,null,[d(le,{class:`mt-4`,"commission-data":I.value},null,8,[`commission-data`]),d(ue,{class:`mt-4`,"commission-data":I.value},null,8,[`commission-data`])])])):c(``,!0),I.value&&!H.value?(n(),l(`div`,Oe,[s(`div`,ke,[o[26]||=s(`h2`,{class:`text-xl font-semibold mb-4 pb-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white`},` Employee Salary Summary`,-1),s(`div`,Ae,[s(`div`,je,[o[16]||=s(`strong`,null,`Employee:`,-1),u(` `+v(I.value.business_summary.employee_name),1)]),s(`div`,null,[o[17]||=s(`strong`,null,`Period:`,-1),u(` Month `+v(J.value.month)+` / Year `+v(J.value.year),1)])]),s(`form`,{onSubmit:ee(ut,[`prevent`])},[s(`table`,Me,[s(`tbody`,null,[s(`tr`,null,[o[18]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Sub Total (total commission)`,-1),s(`td`,Ne,[s(`div`,Pe,v(g(y)(I.value?.total_commission)),1)])]),s(`tr`,null,[o[19]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Base Salary`,-1),s(`td`,Fe,[d(f,{type:`number`,onInput:Q,class:`w-full`,modelValue:J.value.base_salary,"onUpdate:modelValue":o[2]||=e=>J.value.base_salary=e},null,8,[`modelValue`])])]),s(`tr`,null,[o[20]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Advance Loan (-)`,-1),s(`td`,Ie,[d(f,{type:`number`,onInput:Q,class:`w-full`,modelValue:J.value.advance_payment,"onUpdate:modelValue":o[3]||=e=>J.value.advance_payment=e},null,8,[`modelValue`])])]),s(`tr`,null,[s(`th`,{class:_([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,J.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other (bonus or deduction)`,2),s(`td`,Le,[d(f,{type:`number`,onInput:Q,class:_([J.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:J.value.others,"onUpdate:modelValue":o[4]||=e=>J.value.others=e},null,8,[`class`,`modelValue`])])]),s(`tr`,null,[s(`th`,{class:_([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,J.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other Notes`,2),s(`td`,Re,[d(f,{type:`text`,class:_([J.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:J.value.others_note,"onUpdate:modelValue":o[5]||=e=>J.value.others_note=e,placeholder:`Other note`},null,8,[`class`,`modelValue`])])]),s(`tr`,ze,[o[21]||=s(`th`,{class:`px-3 py-2 text-left font-bold text-base bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},` Net Total`,-1),s(`td`,Be,[s(`div`,Ve,v(g(y)(J.value.final_total)),1)])]),s(`tr`,null,[o[23]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Account`,-1),s(`td`,He,[m(s(`select`,{id:`account_id`,"onUpdate:modelValue":o[6]||=e=>J.value.account_id=e,disabled:V.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onBlur:o[7]||=()=>ot(`account_id`),required:``},[o[22]||=s(`option`,{value:``},`Select account`,-1),(n(!0),l(a,null,p(rt.value,e=>(n(),l(`option`,{key:e.id,value:e.id},v(e.name),9,We))),128))],40,Ue),[[i,J.value.account_id]])])]),s(`tr`,null,[o[24]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Salary Note`,-1),s(`td`,Ge,[d(f,{type:`text`,class:`w-full`,modelValue:J.value.note,"onUpdate:modelValue":o[8]||=e=>J.value.note=e,placeholder:`Add any notes`},null,8,[`modelValue`])])])])]),at.value?(n(),l(`div`,Ke,[s(`ul`,qe,[(n(!0),l(a,null,p(U.value,e=>(n(),l(`li`,null,v(e),1))),256))])])):c(``,!0),s(`div`,Je,[s(`button`,{type:`button`,onClick:dt,disabled:V.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},` Cancel `,8,Ye),s(`button`,{type:`submit`,disabled:V.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},[V.value?(n(),l(`div`,Ze,o[25]||=[s(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),u(` Creating... `,-1)])):(n(),l(`span`,Qe,`Create Salary`))],8,Xe)])],32)])])):c(``,!0)])])])])}}}),L=I;export{L as default};