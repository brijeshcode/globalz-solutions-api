import{E as e,G as t,Q as n,_ as r,a$ as i,aC as ee,aH as a,aO as o,aS as s,aU as te,aV as c,aX as l,aY as u,a_ as ne,b0 as re,b3 as ie,b5 as d,b6 as f,bc as ae,bd as p,bf as m,bg as h,bh as oe,bj as g,d as se,j as ce,l as le,y as _}from"./index-Bbnq3hOa.js";import"./GlobalConfig-wPgXFcZ5.js";import{b as v}from"./StatCard-DGl5DxXl.js";import{c as ue,f as y}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import{b as de}from"./PageHeader-CnYDPRoq.js";import{b}from"./currencyUtil-CTYSvgFA.js";import{b as fe}from"./customersStore-9ZL_CUww.js";const pe={class:`space-y-6`},me=[`disabled`],he={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},ge={class:`grid grid-cols-1 md:grid-cols-3 gap-4`},_e={class:`md:col-span-2`},ve={class:`relative`},x={key:0,class:`absolute z-10 mt-1 w-full md:w-2/3 bg-white dark:bg-gray-700 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm`},S=[`onClick`],C={class:`flex items-center`},w={class:`font-medium block truncate text-gray-900 dark:text-white`},T={class:`text-gray-500 dark:text-gray-400 ml-2 text-xs block truncate`},E={key:0,class:`flex items-end`},D={class:`w-full p-3 bg-blue-50 dark:bg-blue-900 rounded-md`},O={class:`flex justify-between items-start`},k={class:`text-sm font-medium text-blue-900 dark:text-blue-100`},A={class:`text-xs text-blue-700 dark:text-blue-300`},j={key:0,class:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6`},M={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},N={class:`grid grid-cols-1 md:grid-cols-6 gap-4`},P={class:`md:col-span-2`},F={class:`relative`},ye={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},be={key:0,class:`p-8 text-center`},xe={key:1,class:`p-8 text-center`},Se={class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},Ce={key:2,class:`overflow-x-auto`},we={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Te={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ee={class:`px-4 py-1 whitespace-nowrap`},De={class:`text-sm text-gray-900 dark:text-white`},Oe={class:`px-4 py-1 whitespace-nowrap`},ke={class:`px-4 py-1 whitespace-nowrap`},Ae=[`onClick`],je={key:1,class:`text-sm text-gray-900 dark:text-white`},I={class:`px-4 py-1 whitespace-nowrap`},Me={class:`text-sm text-gray-900 dark:text-white`},Ne={class:`px-4 py-1 whitespace-nowrap text-right`},Pe={class:`text-sm font-medium text-red-600 dark:text-red-400`},Fe={class:`px-4 py-1 whitespace-nowrap text-right`},Ie={class:`text-sm font-medium text-green-600 dark:text-green-400`},Le={class:`px-4 py-1 whitespace-nowrap text-right`},Re={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center`};var L=re({__name:`IndexPage`,setup(re){let L=a(),R=ee(),ze=fe(),z=se(),B=m(!1),V=m([]),H=m({}),U=m(null),W=m(null),G=m(!1),K=m(``),q=m([]),J=m(null),Y=m({search:``,from_date:``,to_date:``,transaction_type:``,withPage:!1}),X=te(()=>J.value?.id);ie(async()=>{try{G.value=!0,await z.fetchCustomers()}catch(e){console.error(`Error loading customers:`,e),R.error(`Failed to load customers list`)}finally{G.value=!1}});let Be=()=>{W.value&&clearTimeout(W.value),W.value=setTimeout(()=>{K.value.length>=2?Ve():q.value=[]},150)},Ve=()=>{let e=K.value.toLowerCase().trim();if(!e){q.value=[];return}let t=z.customers;q.value=t.filter(t=>{let n=t.code?.toLowerCase()||``,r=t.name?.toLowerCase()||``,i=t.city?.toLowerCase()||``;return n.includes(e)||r.includes(e)||i.includes(e)}).slice(0,10)},He=e=>{J.value=e,K.value=`${e.code} - ${e.name}`,q.value=[],Z()},Ue=()=>{J.value=null,K.value=``,V.value=[],H.value={},$()},Z=async()=>{if(X.value)try{B.value=!0;let e=await ze.fetchCustomerStatements(X.value,Y.value);V.value=e.data,H.value=e.stats}catch(e){R.error(`Failed to load customer statements`,{title:`Error`}),console.error(`Error fetching statements:`,e)}finally{B.value=!1}},We=()=>{U.value&&clearTimeout(U.value),U.value=setTimeout(()=>{Z()},300)},Q=()=>{Z()},Ge=e=>{if(!e.id||!e.transaction_type)return;let t={sale:`sales.show`,payment:`customer.payments.show`,credit_debit_note:`customer.notes.show`,customer_returns:`customer.return.show`},n=t[e.transaction_type];if(!n)return;let r=L.resolve({name:n,params:{id:e.id}});window.open(r.href,`_blank`)},$=()=>{Y.value={search:``,from_date:``,to_date:``,transaction_type:``,withPage:!1},J.value&&Z()},Ke=e=>{let t={sales:`Sales`,payments:`Payment`,credit_note:`Credit Note`,debit_note:`Debit Note`,returns:`Return`};return t[e]||e},qe=()=>{X.value&&L.push({name:`customers.statement.preview`,params:{id:X.value},query:{from_date:Y.value.from_date,to_date:Y.value.to_date,search:Y.value.search,transaction_type:Y.value.transaction_type}})};return(ee,a)=>(d(),u(`div`,pe,[i(de,{title:`Customer Statements`,description:`Search and view customer transaction history including sales, payments, and notes`,showCreateButton:!1},{actions:ae(()=>[J.value?(d(),u(`button`,{key:0,onClick:qe,disabled:V.value.length===0,class:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[i(h(t),{class:`w-4 h-4 mr-2`}),a[4]||=ne(` Print Preview `,-1)],8,me)):l(``,!0)]),_:1}),c(`div`,he,[c(`div`,ge,[c(`div`,_e,[a[5]||=c(`label`,{for:`customer-search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Customer (by name or code) `,-1),c(`div`,ve,[p(c(`input`,{id:`customer-search`,"onUpdate:modelValue":a[0]||=e=>K.value=e,type:`text`,placeholder:`Enter customer name or code...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Be},null,544),[[o,K.value]]),i(h(_),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})]),q.value.length>0&&K.value?(d(),u(`div`,x,[(d(!0),u(s,null,f(q.value,e=>(d(),u(`div`,{key:e.id,onClick:t=>He(e),class:`cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100 dark:hover:bg-gray-600`},[c(`div`,C,[c(`span`,w,g(e.code)+` - `+g(e.name),1)]),c(`span`,T,g(e.city),1)],8,S))),128))])):l(``,!0)]),J.value?(d(),u(`div`,E,[c(`div`,D,[c(`div`,O,[c(`div`,null,[c(`p`,k,g(J.value.code)+` - `+g(J.value.name),1),c(`p`,A,g(J.value.city),1)]),c(`button`,{onClick:Ue,class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`},[i(h(ce),{class:`h-4 w-4`})])])])])):l(``,!0)])]),J.value?(d(),u(`div`,j,[i(v,{label:`Balance`,value:h(y)(H.value.balance),icon:h(e),"icon-color":`blue`},null,8,[`value`,`icon`]),i(v,{label:`Credit`,value:h(y)(H.value.total_credit),icon:h(e),"icon-color":`green`},null,8,[`value`,`icon`]),i(v,{label:`Debit`,value:h(y)(H.value.total_debit),icon:h(e),"icon-color":`red`},null,8,[`value`,`icon`])])):l(``,!0),J.value?(d(),u(`div`,M,[c(`div`,N,[c(`div`,P,[a[6]||=c(`label`,{for:`search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Note `,-1),c(`div`,F,[p(c(`input`,{id:`search`,"onUpdate:modelValue":a[1]||=e=>Y.value.search=e,type:`text`,placeholder:`Search note...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:We},null,544),[[o,Y.value.search]]),i(h(_),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})])]),c(`div`,null,[a[7]||=c(`label`,{for:`from_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` From Date `,-1),p(c(`input`,{id:`from_date`,"onUpdate:modelValue":a[2]||=e=>Y.value.from_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[o,Y.value.from_date]])]),c(`div`,null,[a[8]||=c(`label`,{for:`to_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` To Date `,-1),p(c(`input`,{id:`to_date`,"onUpdate:modelValue":a[3]||=e=>Y.value.to_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[o,Y.value.to_date]])]),c(`div`,{class:`flex items-end`},[c(`button`,{onClick:$,class:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200`},` Clear `)])])])):l(``,!0),J.value?(d(),u(`div`,ye,[B.value?(d(),u(`div`,be,[i(h(n),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),a[9]||=c(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading statements...`,-1)])):V.value.length===0?(d(),u(`div`,xe,[i(h(r),{class:`h-12 w-12 mx-auto text-gray-400`}),a[10]||=c(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No statements found `,-1),c(`p`,Se,g(Y.value.search||Y.value.transaction_type?`Try adjusting your search criteria.`:`No transactions available for this customer.`),1)])):(d(),u(`div`,Ce,[c(`table`,we,[a[14]||=c(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[c(`tr`,null,[c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Date `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Type `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Transaction ID `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Note `),c(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Debit `),c(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Credit `),c(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Balance `)])],-1),c(`tbody`,Te,[(d(!0),u(s,null,f(V.value,e=>(d(),u(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200`},[c(`td`,Ee,[c(`div`,De,g(h(ue)(e.date)),1)]),c(`td`,Oe,g(Ke(e.type)),1),c(`td`,ke,[e.code?(d(),u(`div`,{key:0,onClick:t=>Ge(e),class:`text-sm text-blue-600 dark:text-blue-400 cursor-zoom-in hover:underline`},g(e.code),9,Ae)):(d(),u(`div`,je,` - `))]),c(`td`,I,[c(`div`,Me,g(e.note||`-`),1)]),c(`td`,Ne,[c(`div`,Pe,g(e.debit?h(b)(e.debit,!0):`-`),1)]),c(`td`,Fe,[c(`div`,Ie,g(e.credit?h(b)(e.credit,!0):`-`),1)]),c(`td`,Le,[c(`div`,{class:oe([`text-sm font-medium`,e.balance>=0?`text-green-600 dark:text-green-400`:`text-red-600 dark:text-red-400`])},g(h(b)(e.balance,!0)),3)])]))),128)),a[13]||=c(`tr`,null,[c(`td`,{class:`px-4 py-2`,colspan:`7`},`\xA0`)],-1),l(``,!0)])])]))])):(d(),u(`div`,Re,[i(h(le),{class:`h-16 w-16 mx-auto text-gray-400 mb-4`}),a[15]||=c(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Select a Customer `,-1),a[16]||=c(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},` Search and select a customer to view their statement `,-1)]))]))}}),R=L;export{R as default};