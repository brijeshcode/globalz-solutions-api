import{aA as e,aB as t,aG as n,aH as r,aI as i,aU as a,ax as o,ay as s,az as c,bb as l,bf as u}from"./index-Dtcwuetq.js";import{b as d}from"./tableUtils-dXs1kjAL.js";var f=class{baseUrl=`/customers/sale-orders`;async getSaleOrders(e){try{let t=this.buildQueryParams(e),n=await s(`${this.baseUrl}?${t}`,{loadingMessage:`Loading sale orders...`,showLoading:!0});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching sale orders:`,e),e}}async getSaleOrder(e){try{let t=await s(`${this.baseUrl}/${e}`,{loadingMessage:`Loading sale order...`});return t.data.data}catch(e){throw console.error(`Error fetching sale order:`,e),e}}async createSaleOrder(t){try{let n=await e(this.baseUrl,t,{loadingMessage:`Creating sale order...`,showSuccessNotification:!0,successMessage:`Sale order created successfully`});return n.data.data}catch(e){throw console.error(`Error creating sale order:`,e),e}}async updateSaleOrder(e,n){try{let r=await t(`${this.baseUrl}/${e}`,n,{loadingMessage:`Updating sale order...`,showSuccessNotification:!0,successMessage:`Sale order updated successfully`});return r.data.data}catch(e){throw console.error(`Error updating sale order:`,e),e}}async deleteSaleOrder(e){try{await o(`${this.baseUrl}/${e}`,{loadingMessage:`Deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order deleted successfully`})}catch(e){throw console.error(`Error deleting sale order:`,e),e}}async getTrashedSaleOrders(e){try{let t=this.buildQueryParams(e),n=await s(`${this.baseUrl}/trashed?${t}`,{loadingMessage:`Loading trashed sale orders...`});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching trashed sale orders:`,e),e}}async approveSaleOrder(e,t){try{let n=await c(`${this.baseUrl}/${e}/approve`,t,{loadingMessage:`Approving sale order...`,showSuccessNotification:!0,successMessage:`Sale order approved successfully`});return n.data.data}catch(e){throw console.error(`Error approving sale order:`,e),e}}async restoreSaleOrder(e){try{let t=await c(`${this.baseUrl}/${e}/restore`,{},{loadingMessage:`Restoring sale order...`,showSuccessNotification:!0,successMessage:`Sale order restored successfully`});return t.data.data}catch(e){throw console.error(`Error restoring sale order:`,e),e}}async forceDeleteSaleOrder(e){try{await o(`${this.baseUrl}/${e}/force-delete`,{loadingMessage:`Permanently deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order permanently deleted`})}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}}async getSaleOrderStats(){try{let e=await s(`${this.baseUrl}/stats`,{loadingMessage:`Loading sale order statistics...`});return e.data.data}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}}async searchSaleOrders(e){try{let t=await s(`${this.baseUrl}/search?query=${encodeURIComponent(e)}`,{showLoading:!1});return t.data.data}catch(e){throw console.error(`Error searching sale orders:`,e),e}}async getSaleOrdersByCustomer(e){try{let t=await s(`${this.baseUrl}/by-customer/${e}`,{loadingMessage:`Loading customer sale orders...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by customer:`,e),e}}async getSaleOrdersByCurrency(e){try{let t=await s(`${this.baseUrl}/by-currency/${e}`,{loadingMessage:`Loading sale orders by currency...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by currency:`,e),e}}async getSaleOrdersByWarehouse(e){try{let t=await s(`${this.baseUrl}/by-warehouse/${e}`,{loadingMessage:`Loading sale orders by warehouse...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by warehouse:`,e),e}}async getSaleOrdersByPrefix(e){try{let t=await s(`${this.baseUrl}/by-prefix/${e}`,{loadingMessage:`Loading sale orders by prefix...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by prefix:`,e),e}}async getSaleOrdersByDateRange(e,t){try{let n=await s(`${this.baseUrl}/by-date-range?start_date=${e}&end_date=${t}`,{loadingMessage:`Loading sale orders by date range...`});return n.data.data}catch(e){throw console.error(`Error fetching sale orders by date range:`,e),e}}async getSaleOrdersBySalesperson(e){try{let t=await s(`${this.baseUrl}/by-salesperson/${e}`,{loadingMessage:`Loading sale orders by salesperson...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by salesperson:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const p=new f,m=i(`saleOrders`,()=>{let e=r(),t=n(),i=u([]),o=u(null),s=u([]),c=u(d()),f=u(!1),m=u({per_page:50}),h=a(()=>e=>i.value.filter(t=>t.prefix===e)),g=a(()=>e=>i.value.filter(t=>t.customer_id===e)),_=a(()=>e=>i.value.filter(t=>t.currency_id===e)),ee=a(()=>e=>i.value.filter(t=>t.warehouse_id===e)),te=a(()=>e=>i.value.filter(t=>t.salesperson_id===e)),ne=a(()=>e=>i.value.filter(t=>t.status===e)),v=a(()=>i.value.filter(e=>e.status===`Waiting`)),y=a(()=>i.value.filter(e=>e.status===`Shipped`)),b=a(()=>i.value.filter(e=>e.status===`Delivered`)),x=a(()=>i.value.reduce((e,t)=>e+t.total,0)),S=a(()=>i.value.reduce((e,t)=>e+t.total_usd,0)),C=a(()=>i.value.reduce((e,t)=>e+t.total_profit,0)),w=a(()=>(e,t)=>i.value.filter(n=>{let r=new Date(n.date),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),T=a(()=>({total:i.value.length,waiting:v.value.length,shipped:y.value.length,delivered:b.value.length,totalAmount:x.value,totalAmountUSD:S.value,totalProfit:C.value,byPrefix:{INX:h.value(`INX`).length,INV:h.value(`INV`).length}})),E=a(()=>{let e={};return Object.entries(t.query).forEach(([t,n])=>{n&&typeof n==`string`&&(e[t]=n)}),e}),D=async e=>{try{f.value=!0,e&&(m.value={...m.value,...e});let t=await p.getSaleOrders(m.value);i.value=t.data,c.value=t.pagination}catch(e){throw console.error(`Error fetching sale orders:`,e),e}finally{f.value=!1}},O=async e=>{try{let t=await p.getSaleOrder(e);return o.value=t,t}catch(e){throw console.error(`Error fetching sale order:`,e),e}},k=async e=>{try{let t=await p.createSaleOrder(e);return i.value.unshift(t),c.value.total+=1,t}catch(e){throw console.error(`Error creating sale order:`,e),e}},A=async(e,t)=>{try{let n=await p.updateSaleOrder(e,t),r=i.value.findIndex(t=>t.id===e);return r!==-1&&(i.value[r]=n),o.value?.id===e&&(o.value=n),n}catch(e){throw console.error(`Error updating sale order:`,e),e}},j=async e=>{try{await p.deleteSaleOrder(e);let t=i.value.findIndex(t=>t.id===e);t!==-1&&i.value.splice(t,1),--c.value.total,o.value?.id===e&&(o.value=null)}catch(e){throw console.error(`Error deleting sale order:`,e),e}},M=async e=>{try{f.value=!0;let t=e||{},n=await p.getTrashedSaleOrders(t);s.value=n.data}catch(e){throw console.error(`Error fetching trashed orders:`,e),e}finally{f.value=!1}},N=async e=>{try{let t=await p.restoreSaleOrder(e),n=s.value.findIndex(t=>t.id===e);return n!==-1&&s.value.splice(n,1),i.value.unshift(t),c.value.total+=1,t}catch(e){throw console.error(`Error restoring sale order:`,e),e}},P=async e=>{try{await p.forceDeleteSaleOrder(e);let t=s.value.findIndex(t=>t.id===e);t!==-1&&s.value.splice(t,1)}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}},F=async(e,t)=>{try{let n=await p.approveSaleOrder(e,t),r=i.value.findIndex(t=>t.id===e);return r!==-1&&i.value.splice(r,1),--c.value.total,o.value?.id===e&&(o.value=null),n}catch(e){throw console.error(`Error approving sale order:`,e),e}},I=async e=>{try{return await p.searchSaleOrders(e)}catch(e){throw console.error(`Error searching sale orders:`,e),e}},L=async e=>{try{return await p.getSaleOrdersByCustomer(e)}catch(e){throw console.error(`Error fetching orders by customer:`,e),e}},R=async e=>{try{return await p.getSaleOrdersByCurrency(e)}catch(e){throw console.error(`Error fetching orders by currency:`,e),e}},z=async e=>{try{return await p.getSaleOrdersByWarehouse(e)}catch(e){throw console.error(`Error fetching orders by warehouse:`,e),e}},B=async e=>{try{return await p.getSaleOrdersByPrefix(e)}catch(e){throw console.error(`Error fetching orders by prefix:`,e),e}},V=async e=>{try{return await p.getSaleOrdersBySalesperson(e)}catch(e){throw console.error(`Error fetching orders by salesperson:`,e),e}},H=async(e,t)=>{try{return await p.getSaleOrdersByDateRange(e,t)}catch(e){throw console.error(`Error fetching orders by date range:`,e),e}},U=async()=>{try{return await p.getSaleOrderStats()}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}},W=e=>{m.value={...m.value,...e}},G=()=>{m.value={per_page:50}},K=()=>{o.value=null},q=e=>{let t={...m.value,search:e,page:1};m.value=t,Z(t),$(t,!1)},J=(e,t)=>{let n={...m.value,sort_by:e,sort_direction:t,page:1};m.value=n,Z(n),$(n,!1)},Y=e=>{let t={...m.value,page:e};m.value=t,Z(t),$(t,!1)},X=e=>{let t={...m.value,per_page:e,page:1};m.value=t,Z(t),$(t,!1)},Z=(n,r=!1)=>{let i={...t.query};Object.entries(n).forEach(([e,t])=>{t!=null&&t!==``?i[e]=String(t):delete i[e]});let a=r?`replace`:`push`;e[a]({query:i})},re=()=>{e.replace({query:{}})},Q=()=>{let e={per_page:50};m.value={...e,...E.value}},$=async(e,t=!0)=>{t&&e&&Z(e),await D(e)},ie=()=>{i.value=[],o.value=null,s.value=[],c.value=d(),m.value={per_page:50},f.value=!1};return l(()=>t.query,async()=>{if(Q(),t.name&&t.name.toString().includes(`sale-order`))try{await D(m.value)}catch(e){console.error(`Error fetching sale orders on URL change:`,e)}},{immediate:!1,deep:!0}),{saleOrders:i,currentSaleOrder:o,trashedOrders:s,pagination:c,loading:f,filters:m,ordersByPrefix:h,ordersByCustomer:g,ordersByCurrency:_,ordersByWarehouse:ee,ordersBySalesperson:te,ordersByStatus:ne,waitingOrders:v,shippedOrders:y,deliveredOrders:b,totalOrderAmount:x,totalOrderAmountUSD:S,totalOrderProfit:C,ordersByDateRange:w,orderStats:T,urlParams:E,fetchSaleOrders:D,fetchSaleOrder:O,createSaleOrder:k,updateSaleOrder:A,deleteSaleOrder:j,fetchTrashedOrders:M,restoreOrder:N,forceDeleteOrder:P,approveOrder:F,searchOrders:I,getOrdersByCustomer:L,getOrdersByCurrency:R,getOrdersByWarehouse:z,getOrdersByPrefix:B,getOrdersBySalesperson:V,getOrdersByDateRange:H,getOrderStats:U,updateFilters:W,clearFilters:G,clearCurrentOrder:K,setSearch:q,setSort:J,setPage:Y,setPerPage:X,updateUrlParams:Z,clearUrlParams:re,syncFiltersWithUrl:Q,fetchData:$,reset:ie}});export{m as b};