import{G as e,Q as t,a$ as n,aC as r,aG as i,aH as a,aS as o,aU as s,aV as c,aX as l,aY as u,aZ as d,a_ as f,ao as p,b0 as m,b3 as h,b5 as g,b6 as _,bf as v,bg as y,bj as b}from"./index-Bbnq3hOa.js";import"./GlobalConfig-wPgXFcZ5.js";import{c as x}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import{b as S,c as C}from"./currencyUtil-CTYSvgFA.js";import{b as w}from"./companyStore-C60svsbY.js";import{b as T}from"./salesStore-C67KEavV.js";const E={class:`max-w-4xl mx-auto p-8 bg-white text-gray-900 print:h-full print:p-0 print:max-w-none print:mx-0`},D={class:`header`},ee={class:`flex justify-between items-start mb-10 pb-6 border-b-2 border-blue-600 print:border-black print:mb-6`},te={key:0,class:`flex-1`},O={class:`flex items-center mb-3`},k=[`src`,`alt`,`height`,`width`],A={key:1,class:`text-3xl font-bold text-blue-600 print:text-black print:text-2xl`},j={key:0},M={class:`print:text-black`},N={class:`text-right flex-1 mt-4`},P={class:`text-lg font-semibold text-gray-600 print:text-black print:text-base`},F={class:`grid grid-cols-1 md:grid-cols-12 gap-8 mb-10 print:grid-cols-12 print:gap-6 print:mb-6`},I={class:`col-span-12 md:col-span-8 print:col-span-8`},L={class:`space-y-1 print:space-y-0`},R={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},z={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},B={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},V={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},H={key:0,class:`flex gap-5`},U={class:`text-red-600 font-bold print:font-normal print:text-black print:text-xs`},W={class:`col-span-12 md:col-span-4 print:col-span-4`},G={class:`space-y-1 print:space-y-0`},K={class:`flex justify-between print:justify-between`},q={class:`text-gray-900 print:text-black print:text-xs`},J={class:`flex justify-between print:justify-between`},Y={class:`text-gray-900 print:text-black print:text-xs`},X={class:`flex justify-between print:justify-between`},Z={class:`text-gray-900 print:text-black print:text-xs`},Q={key:0,class:`flex justify-between print:justify-between`},ne={class:`text-gray-900 print:text-black print:text-xs`},re={class:`body`},ie={class:`mb-8 print:mb-4`},ae={class:`overflow-x-auto print:overflow-visible`},oe={class:`w-full border-collapse border border-gray-300 print:border-black`},se={class:`bg-gray-100 print:bg-gray-200`},ce={key:0,class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},le={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},ue={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-black print:text-xs`},de={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-black print:text-xs`},fe={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},pe={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},me={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},he={key:0,class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},ge={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-semibold print:border-black print:text-black print:text-xs`},_e={key:0,class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},ve={class:`border-t-2 border-gray-400 print:border-t-2 print:border-black`},ye=[`colspan`],be={class:`flex gap-4 text-sm`},xe={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Se=[`colspan`],Ce={class:`py-0 flex gap-4 text-sm`},we=[`src`,`alt`,`height`,`width`],Te={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Ee={key:0},De={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Oe={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},ke={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Ae=[`colspan`],je={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Me={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-bold text-lg print:border-black print:text-black print:text-xs`},Ne={class:`mt-14`},Pe={class:`text-sm text-gray-600 print:text-xs print:text-black m-auto text-center top-4 w-full print:mb-2`},Fe={class:`footer print:block hidden print:fixed print:bottom-0 print:left-0 print:right-0`},Ie={class:`border-t-2 border-gray-300 print:border-black pt-4 pb-2`},Le={key:0,class:`mt-2 print:mt-1`},Re={class:`flex flex-wrap gap-2 text-sm text-gray-600 print:text-black print:text-xs justify-between`},ze={key:0,class:`flex-1`},Be={key:1,class:`flex-1 text-center`},Ve={key:2,class:`flex-1 text-center`},$={key:3,class:`flex-1 text-right`};var He=m({__name:`SaleInvoice`,props:{saleData:{},customers:{default:()=>[]},warehouses:{default:()=>[]},currencies:{default:()=>[]},salespersons:{default:()=>[]},items:{default:()=>[]}},setup(e,{expose:t}){let n=e,r=w();h(async()=>{try{r.company.name||await r.fetchCompany()}catch(e){console.error(`Failed to fetch company data:`,e)}});let i=s(()=>{let e=n.saleData.items?.length||0,t=20;return e>=t?0:t-e}),a=e=>e?parseFloat(Number(e).toFixed(2)).toString():`0`,p=()=>n.saleData.prefix===`INV`,m=s(()=>!n.saleData.items||n.saleData.items.length===0?0:n.saleData.items.reduce((e,t)=>e+(Number(t.total_weight_kg)||0),0)),v=s(()=>!n.saleData.items||n.saleData.items.length===0?0:n.saleData.items.reduce((e,t)=>e+(Number(t.total_volume_cbm)||0),0)),T=()=>{window.print()};return t({printInvoice:T}),(e,t)=>(g(),u(`div`,E,[c(`section`,D,[c(`div`,ee,[p()?(g(),u(`div`,te,[c(`div`,O,[y(r).company.show_logo&&y(r).company.logo?.preview_url?(g(),u(`img`,{key:0,src:y(r).company.logo.preview_url,alt:y(r).company.name||`Company Logo`,height:y(r).company.logo_height||200,width:y(r).company.logo_width||200,class:`mr-4`},null,8,k)):l(``,!0),y(r).company.logo?.preview_url?l(``,!0):(g(),u(`div`,A,b(y(r).company.name),1))]),y(r).company.tax_number?(g(),u(`div`,j,[c(`p`,M,[c(`b`,null,`Tax Registration #: `+b(y(r).company.tax_number),1)])])):l(``,!0)])):l(``,!0),c(`div`,N,[t[0]||=c(`h1`,{class:`text-2xl font-bold text-blue-600 mb-2 print:text-black print:text-xl`},`SALES INVOICE`,-1),c(`div`,P,b(e.saleData.prefix)+`-`+b(e.saleData.code),1)])]),c(`div`,F,[c(`div`,I,[t[6]||=c(`h3`,{class:`text-lg font-bold text-blue-600 mb-3 print:text-sm border-b border-gray-200 print:text-black print:border-black`},`Customer Information`,-1),c(`div`,L,[c(`table`,null,[c(`thead`,null,[c(`tr`,null,[t[1]||=c(`th`,{class:`text-left`},[c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Customer: `)],-1),c(`td`,null,[c(`span`,R,b(e.saleData.customer?.code)+`, `+b(e.saleData.customer?.name||`Unknown Customer`),1)])]),c(`tr`,null,[t[2]||=c(`th`,{class:`text-left align-top`},[c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Address: `)],-1),c(`td`,null,[c(`span`,z,b(e.saleData.customer?.address)+`, `+b(e.saleData.customer?.city),1)])]),c(`tr`,null,[t[3]||=c(`th`,{class:`text-left`},[c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Phone:`)],-1),c(`td`,null,[c(`span`,B,b(e.saleData.customer?.mobile),1)])]),c(`tr`,null,[t[4]||=c(`th`,{class:`text-left`},[c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Tax #:`)],-1),c(`td`,null,[c(`span`,V,b(e.saleData.customer?.mof_tax_number),1)])])])]),e.saleData.outStanding_balance&&Number(e.saleData.outStanding_balance)>0?(g(),u(`div`,H,[t[5]||=c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Outstanding Balance:`,-1),c(`span`,U,b(y(S)(e.saleData.outStanding_balance,!0)),1)])):l(``,!0)])]),c(`div`,W,[t[11]||=c(`h3`,{class:`text-lg font-bold text-blue-600 mb-3 print:text-sm border-b border-gray-200 print:text-black print:border-black`},`Invoice Details`,-1),c(`div`,G,[c(`div`,K,[t[7]||=c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Date:`,-1),c(`span`,q,b(y(x)(e.saleData.date)),1)]),c(`div`,J,[t[8]||=c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Value Date:`,-1),c(`span`,Y,b(y(x)(e.saleData.value_date)),1)]),c(`div`,X,[t[9]||=c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Currency:`,-1),c(`span`,Z,b(e.saleData.currency?.code||`N/A`),1)]),e.saleData.salesperson?(g(),u(`div`,Q,[t[10]||=c(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Salesperson:`,-1),c(`span`,ne,b(e.saleData.salesperson?.name||`Not assigned`),1)])):l(``,!0)])])])]),c(`section`,re,[c(`div`,ie,[c(`div`,ae,[c(`table`,oe,[c(`thead`,null,[c(`tr`,se,[t[13]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`#`,-1),t[14]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-left font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Item Code`,-1),t[15]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-left font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Description`,-1),t[16]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Price`,-1),t[17]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},[c(`abbr`,{title:`Discount Percentage`},`Dis. %`)],-1),t[18]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},[c(`abbr`,{title:`Total Quantity`},`QTY`)],-1),e.saleData.prefix==`INV`?(g(),u(`th`,ce,t[12]||=[c(`abbr`,{title:`Tax Percentage`},`Tax`,-1)])):l(``,!0),t[19]||=c(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Total`,-1)])]),c(`tbody`,null,[(g(!0),u(o,null,_(e.saleData.items,(t,n)=>(g(),u(`tr`,{key:n,class:`even:bg-gray-50 print:even:bg-gray-100`},[c(`td`,le,b(n+1),1),c(`td`,ue,b(t.item_code||``),1),c(`td`,de,b(t.item?.description||`Unknown Item`),1),c(`td`,fe,b(y(S)(t.price)),1),c(`td`,pe,b(a(t.discount_percent))+`%`,1),c(`td`,me,b(a(t.quantity)),1),e.saleData.prefix==`INV`?(g(),u(`td`,he,b(t.tax_label),1)):l(``,!0),c(`td`,ge,b(y(S)(t.total_price-t.tax_amount*t.quantity)),1)]))),128)),(g(!0),u(o,null,_(i.value,n=>(g(),u(`tr`,{key:`empty-`+n,class:`even:bg-gray-50 print:even:bg-gray-100`},[t[20]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),t[21]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-xs`},`\xA0`,-1),t[22]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-xs`},`\xA0`,-1),t[23]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),t[24]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),t[25]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),e.saleData.prefix==`INV`?(g(),u(`td`,_e,`\xA0`)):l(``,!0),t[26]||=c(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1)]))),128)),c(`tr`,ve,[c(`td`,{colspan:e.saleData.prefix==`INV`?4:3},[c(`div`,be,[t[27]||=c(`div`,null,`Volume CBM`,-1),c(`div`,null,b(a(v.value)),1)])],8,ye),t[28]||=c(`td`,{colspan:`2`,class:`print:border-black`},null,-1),t[29]||=c(`td`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},`Sub Total`,-1),c(`td`,xe,b(y(S)(e.saleData.sub_total-e.saleData.total_tax_amount)),1)]),c(`tr`,null,[c(`td`,{colspan:e.saleData.prefix==`INV`?6:5,class:`print:border-black text-center relative`},[c(`div`,Ce,[t[30]||=c(`div`,null,`Weight KG`,-1),c(`div`,null,b(a(m.value)),1)]),y(r).company.show_stamp&&y(r).company.stamp?.preview_url&&p()?(g(),u(`img`,{key:0,src:y(r).company.stamp.preview_url,alt:y(r).company.name||`Company Stamp`,height:y(r).company.stamp_height||200,width:y(r).company.stamp_width||200,class:`mr-4 absolute left-1/4 -bottom-1/4`},null,8,we)):l(``,!0)],8,Se),t[31]||=c(`td`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},`Add. Discount`,-1),c(`td`,Te,b(y(S)(e.saleData.discount_amount)),1)]),e.saleData.prefix==`INV`?(g(),u(`tr`,Ee,[t[32]||=c(`td`,{colspan:`3`,class:`print:border-black`},null,-1),t[33]||=c(`td`,{colspan:`2`,class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},[c(`span`,null,`TVA 11% LL`)],-1),c(`td`,De,b(y(S)(y(C)(e.saleData.total_tax_amount_usd,e.saleData.local_curreny_rate,`divide`))),1),c(`td`,Oe,b(e.saleData.invoice_tax_label),1),c(`td`,ke,b(y(S)(e.saleData.total_tax_amount)),1)])):l(``,!0),c(`tr`,null,[t[35]||=c(`td`,{colspan:`3`,class:`print:border-black`},null,-1),c(`td`,{colspan:e.saleData.prefix==`INV`?2:1,class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},t[34]||=[c(`span`,null,`Net Total LL`,-1)],8,Ae),c(`td`,je,[c(`span`,null,b(y(S)(y(C)(e.saleData.total_usd,e.saleData.local_curreny_rate,`divide`))),1)]),t[36]||=c(`td`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},`Net Total`,-1),c(`td`,Me,b(y(S)(e.saleData.total)),1)])])])])]),t[39]||=d(`<div class="flex justify-between items-center mb-6 print:mb-3 mt-8 print:mt-6"><div class="flex-1 text-center"><p class="font-semibold text-gray-700 print:text-black print:text-xs">Received By</p><div class="border-b border-gray-400 print:border-black mt-8 print:mt-4"></div></div><div class="flex-1 text-center ml-8"><p class="font-semibold text-gray-700 print:text-black print:text-xs">Signature</p><div class="border-b border-gray-400 print:border-black mt-8 print:mt-4"></div></div></div>`,1),c(`div`,Ne,[c(`div`,Pe,[f(b(e.saleData.invoice_nb1)+` `,1),t[37]||=c(`br`,null,null,-1),t[38]||=c(`br`,null,null,-1),f(` `+b(e.saleData.invoice_nb2),1)])])]),c(`section`,Fe,[c(`div`,Ie,[p()?(g(),u(`div`,Le,[c(`div`,Re,[y(r).company.address?(g(),u(`p`,ze,b(y(r).company.address),1)):l(``,!0),y(r).company.phone?(g(),u(`p`,Be,b(y(r).company.phone),1)):l(``,!0),y(r).company.email?(g(),u(`p`,Ve,b(y(r).company.email),1)):l(``,!0),y(r).company.website?(g(),u(`p`,$,b(y(r).company.website),1)):l(``,!0)])])):l(``,!0)])])]))}}),Ue=He;const We={class:`min-h-screen bg-gray-50 print:bg-white`},Ge={class:`bg-white shadow-sm border-b print:hidden`},Ke={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8`},qe={class:`flex items-center justify-between h-16`},Je={class:`flex items-center space-x-4`},Ye={class:`text-sm text-gray-500`},Xe={class:`flex items-center space-x-3`},Ze={key:0,class:`flex items-center justify-center min-h-screen`},Qe={class:`text-center`},$e={key:1,class:`py-8 print:py-0`},et={class:`max-w-6xl mx-auto print:max-w-none`};var tt=m({__name:`InvoicePreviewPage`,setup(o){let s=a(),l=i(),d=r(),m=T(),_=parseInt(l.params.id),x=v(!0),S=v({}),C=v(null),w=()=>{let e=l.query.from===`view`;e?s.push({name:`sales.show`,params:{id:_.toString()}}):s.push({name:`sales.index`})},E=async()=>{if(C.value)try{await C.value.printInvoice()}catch(e){console.error(`Failed to print invoice:`,e),d.error(`Failed to print invoice`)}},D=async()=>{try{S.value=await m.fetchSale(_)}catch(e){console.error(`Error loading sale:`,e),d.error(`Failed to load sale details`),s.push({name:`sales.index`})}};return h(async()=>{try{x.value=!0,await Promise.all([D()])}catch(e){console.error(`Error initializing invoice preview:`,e)}finally{x.value=!1}}),(r,i)=>(g(),u(`div`,We,[c(`div`,Ge,[c(`div`,Ke,[c(`div`,qe,[c(`div`,Je,[c(`button`,{onClick:w,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100 transition-colors`},[n(y(p),{class:`w-5 h-5`})]),c(`div`,null,[i[0]||=c(`h1`,{class:`text-lg font-semibold text-gray-900`},`Invoice Preview`,-1),c(`p`,Ye,b(S.value.prefix)+`-`+b(S.value.code),1)])]),c(`div`,Xe,[c(`button`,{onClick:E,class:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`},[n(y(e),{class:`w-4 h-4 mr-2`}),i[1]||=f(` Print Invoice `,-1)])])])])]),x.value?(g(),u(`div`,Ze,[c(`div`,Qe,[n(y(t),{class:`w-8 h-8 animate-spin mx-auto text-blue-600`}),i[2]||=c(`p`,{class:`mt-2 text-gray-600`},`Loading invoice...`,-1)])])):(g(),u(`div`,$e,[c(`div`,et,[n(Ue,{ref_key:`saleInvoiceRef`,ref:C,"sale-data":S.value},null,8,[`sale-data`])])]))]))}}),nt=tt;export{nt as default};