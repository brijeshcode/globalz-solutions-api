import{K as e,a6 as t,a7 as n,a8 as r,a9 as i,aA as a,aE as o,aK as s,aL as c,aM as l,aO as u,aP as d,aS as f,ab as ee,af as te,ag as p,ah as m,am as ne,ap as h,as as g,at as _,au as re,av as v,aw as y,ay as b,az as x}from"./index-stkS_7oq.js";import{b as S}from"./useAuth-DETex2od.js";import{b as C}from"./tableUtils-BvWofAYZ.js";import{b as w,c as T}from"./common-BPa_8IsB.js";import{b as ie}from"./Modal-QXqnb7lZ.js";var E=class{baseUrl=`/customers/returns`;async getCustomerReturns(e){try{let t=this.buildQueryParams(e),r=await n(`${this.baseUrl}?${t}`,{loadingMessage:`Loading customer returns...`,showLoading:!0});return{data:r.data.data,pagination:r.data.pagination}}catch(e){throw console.error(`Error fetching customer returns:`,e),e}}async getCustomerReturn(e){try{let t=await n(`${this.baseUrl}/${e}`,{loadingMessage:`Loading customer return...`});return t.data.data}catch(e){throw console.error(`Error fetching customer return:`,e),e}}async createCustomerReturn(e){try{let t=await i(this.baseUrl,e,{loadingMessage:`Creating customer return...`,showSuccessNotification:!0,successMessage:`Customer return created and approved successfully`});return t.data.data}catch(e){throw console.error(`Error creating customer return:`,e),e}}async getTrashedReturns(e){try{let t=this.buildQueryParams(e),r=await n(`${this.baseUrl}/trashed?${t}`,{loadingMessage:`Loading trashed returns...`});return{data:r.data.data,pagination:r.data.pagination}}catch(e){throw console.error(`Error fetching trashed returns:`,e),e}}async restoreReturn(e){try{let t=await r(`${this.baseUrl}/${e}/restore`,{},{loadingMessage:`Restoring return...`,showSuccessNotification:!0,successMessage:`Return restored successfully`});return t.data.data}catch(e){throw console.error(`Error restoring return:`,e),e}}async forceDeleteReturn(e){try{await t(`${this.baseUrl}/${e}/force-delete`,{loadingMessage:`Permanently deleting return...`,showSuccessNotification:!0,successMessage:`Return permanently deleted`})}catch(e){throw console.error(`Error permanently deleting return:`,e),e}}async getReturnStats(){try{let e=await n(`${this.baseUrl}/stats`,{loadingMessage:`Loading return statistics...`});return e.data.data}catch(e){throw console.error(`Error fetching return statistics:`,e),e}}async getReturnsForSelect(){try{let e=await n(`${this.baseUrl}`,{showLoading:!1}),t=e.data.data;return t.map(e=>({value:e.id,label:`${e.return_code} - ${e.total}`,disabled:!1}))}catch(e){throw console.error(`Error fetching returns for select:`,e),e}}async searchReturns(e){try{let t=await n(`${this.baseUrl}/search?query=${encodeURIComponent(e)}`,{showLoading:!1});return t.data.data}catch(e){throw console.error(`Error searching returns:`,e),e}}async getReturnsByCustomer(e){try{let t=await n(`${this.baseUrl}/by-customer/${e}`,{loadingMessage:`Loading customer returns...`});return t.data.data}catch(e){throw console.error(`Error fetching returns by customer:`,e),e}}async getReturnsByCurrency(e){try{let t=await n(`${this.baseUrl}/by-currency/${e}`,{loadingMessage:`Loading returns by currency...`});return t.data.data}catch(e){throw console.error(`Error fetching returns by currency:`,e),e}}async getReturnsByWarehouse(e){try{let t=await n(`${this.baseUrl}/by-warehouse/${e}`,{loadingMessage:`Loading returns by warehouse...`});return t.data.data}catch(e){throw console.error(`Error fetching returns by warehouse:`,e),e}}async getReturnsBySalesperson(e){try{let t=await n(`${this.baseUrl}/by-salesperson/${e}`,{loadingMessage:`Loading returns by salesperson...`});return t.data.data}catch(e){throw console.error(`Error fetching returns by salesperson:`,e),e}}async getReturnsByPrefix(e){try{let t=await n(`${this.baseUrl}/by-prefix/${e}`,{loadingMessage:`Loading returns by prefix...`});return t.data.data}catch(e){throw console.error(`Error fetching returns by prefix:`,e),e}}async getReturnsByDateRange(e,t){try{let r=await n(`${this.baseUrl}/by-date-range?start_date=${e}&end_date=${t}`,{loadingMessage:`Loading returns by date range...`});return r.data.data}catch(e){throw console.error(`Error fetching returns by date range:`,e),e}}async getReturnsByStatus(e){try{let t=await n(`${this.baseUrl}/by-status/${e}`,{loadingMessage:`Loading ${e} returns...`});return t.data.data}catch(e){throw console.error(`Error fetching returns by status:`,e),e}}async getReceivedReturns(e){try{let t={...e,status:`received`};return await this.getCustomerReturns(t)}catch(e){throw console.error(`Error fetching received returns:`,e),e}}async markReturnReceived(e,t){try{let n=await r(`${this.baseUrl}/${e}/mark-received`,t,{loadingMessage:`Marking return as received...`,showSuccessNotification:!0,successMessage:`Return marked as received successfully`});return n.data.data}catch(e){throw console.error(`Error marking return as received:`,e),e}}async getNotReceivedReturns(e){try{let t={...e,status:`not_received`};return await this.getCustomerReturns(t)}catch(e){throw console.error(`Error fetching not received returns:`,e),e}}async getReturnsByApprovalDateRange(e,t){try{let r=await n(`${this.baseUrl}/by-approval-date-range?approved_at_from=${e}&approved_at_to=${t}`,{loadingMessage:`Loading returns by approval date range...`});return r.data.data}catch(e){throw console.error(`Error fetching returns by approval date range:`,e),e}}async getReturnsByReceivedDateRange(e,t){try{let r=await n(`${this.baseUrl}/by-received-date-range?return_received_at_from=${e}&return_received_at_to=${t}`,{loadingMessage:`Loading returns by received date range...`});return r.data.data}catch(e){throw console.error(`Error fetching returns by received date range:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const D=new E,O=m(`customerReturns`,()=>{let e=p(),t=te(),n=u([]),r=u(null),i=u([]),a=u([]),o=u([]),c=u(C()),l=u(!1),d=u({per_page:50}),f=g(()=>e=>n.value.filter(t=>t.prefix===e)),ee=g(()=>e=>n.value.filter(t=>t.customer_id===e)),m=g(()=>e=>n.value.filter(t=>t.currency_id===e)),ne=g(()=>e=>n.value.filter(t=>t.warehouse_id===e)),h=g(()=>e=>n.value.filter(t=>t.salesperson_id===e)),_=g(()=>e=>n.value.filter(t=>t.approved_by===e)),re=g(()=>e=>n.value.filter(t=>t.return_received_by===e)),v=g(()=>n.value.filter(e=>e.is_received)),y=g(()=>n.value.filter(e=>e.is_approved&&!e.is_received)),b=g(()=>n.value.map(e=>({value:e.id,label:`${e.return_code} - ${e.total}`,disabled:!1}))),x=g(()=>n.value.reduce((e,t)=>e+t.total,0)),S=g(()=>n.value.reduce((e,t)=>e+t.total_usd,0)),w=g(()=>(e,t)=>n.value.filter(n=>{let r=new Date(n.date),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),T=g(()=>(e,t)=>n.value.filter(n=>{if(!n.approved_at)return!1;let r=new Date(n.approved_at),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),ie=g(()=>(e,t)=>n.value.filter(n=>{if(!n.return_received_at)return!1;let r=new Date(n.return_received_at),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),E=g(()=>({total:n.value.length,received:v.value.length,notReceived:y.value.length,totalAmount:x.value,totalAmountUSD:S.value,byPrefix:{RTX:f.value(`RTX`).length,RTV:f.value(`RTV`).length}})),O=g(()=>{let e={};return Object.entries(t.query).forEach(([t,n])=>{n&&typeof n==`string`&&(e[t]=n)}),e}),k=async e=>{try{l.value=!0,e&&(d.value={...d.value,...e});let t=await D.getCustomerReturns(d.value);n.value=t.data,c.value=t.pagination}catch(e){throw console.error(`Error fetching returns:`,e),e}finally{l.value=!1}},A=async e=>{try{let t=await D.getCustomerReturn(e);return r.value=t,t}catch(e){throw console.error(`Error fetching return:`,e),e}},j=async e=>{try{let t=await D.createCustomerReturn(e);return n.value.unshift(t),c.value.total+=1,t}catch(e){throw console.error(`Error creating return:`,e),e}},M=async e=>{try{l.value=!0;let t={...e,status:`received`},n=await D.getReceivedReturns(t);i.value=n.data,c.value=n.pagination}catch(e){throw console.error(`Error fetching received returns:`,e),e}finally{l.value=!1}},N=async e=>{try{l.value=!0;let t={...e,status:`not_received`},n=await D.getNotReceivedReturns(t);a.value=n.data,c.value=n.pagination}catch(e){throw console.error(`Error fetching not received returns:`,e),e}finally{l.value=!1}},P=async e=>{try{l.value=!0;let t=e||{},n=await D.getTrashedReturns(t);o.value=n.data}catch(e){throw console.error(`Error fetching trashed returns:`,e),e}finally{l.value=!1}},F=async e=>{try{let t=await D.restoreReturn(e),r=o.value.findIndex(t=>t.id===e);return r!==-1&&o.value.splice(r,1),n.value.unshift(t),c.value.total+=1,t}catch(e){throw console.error(`Error restoring return:`,e),e}},I=async e=>{try{await D.forceDeleteReturn(e);let t=o.value.findIndex(t=>t.id===e);t!==-1&&o.value.splice(t,1)}catch(e){throw console.error(`Error permanently deleting return:`,e),e}},L=async e=>{try{return await D.searchReturns(e)}catch(e){throw console.error(`Error searching returns:`,e),e}},R=async()=>{try{return await D.getReturnsForSelect()}catch(e){return console.error(`Error fetching returns for select:`,e),[]}},z=async e=>{try{return await D.getReturnsByCustomer(e)}catch(e){throw console.error(`Error fetching returns by customer:`,e),e}},B=async e=>{try{return await D.getReturnsByCurrency(e)}catch(e){throw console.error(`Error fetching returns by currency:`,e),e}},V=async(e,t)=>{try{let o=await D.markReturnReceived(e,t),s=n.value.findIndex(t=>t.id===e);s!==-1&&(n.value[s]=o);let c=a.value.findIndex(t=>t.id===e);return c!==-1&&a.value.splice(c,1),i.value.unshift(o),r.value?.id===e&&(r.value=o),o}catch(e){throw console.error(`Error marking return order as received:`,e),e}},H=async e=>{try{return await D.getReturnsByWarehouse(e)}catch(e){throw console.error(`Error fetching returns by warehouse:`,e),e}},U=async e=>{try{return await D.getReturnsByPrefix(e)}catch(e){throw console.error(`Error fetching returns by prefix:`,e),e}},W=async e=>{try{return await D.getReturnsBySalesperson(e)}catch(e){throw console.error(`Error fetching returns by salesperson:`,e),e}},G=async(e,t)=>{try{return await D.getReturnsByDateRange(e,t)}catch(e){throw console.error(`Error fetching returns by date range:`,e),e}},K=async e=>{try{return await D.getReturnsByStatus(e)}catch(e){throw console.error(`Error fetching returns by status:`,e),e}},q=async(e,t)=>{try{return await D.getReturnsByApprovalDateRange(e,t)}catch(e){throw console.error(`Error fetching returns by approval date range:`,e),e}},J=async(e,t)=>{try{return await D.getReturnsByReceivedDateRange(e,t)}catch(e){throw console.error(`Error fetching returns by received date range:`,e),e}},Y=async()=>{try{return await D.getReturnStats()}catch(e){throw console.error(`Error fetching return statistics:`,e),e}},X=e=>{d.value={...d.value,...e}},ae=()=>{d.value={}},Z=()=>{r.value=null},oe=e=>{let t={...d.value,search:e,page:1};d.value=t,Q(t),$(t,!1)},se=(e,t)=>{let n={...d.value,sort_by:e,sort_direction:t,page:1};d.value=n,Q(n),$(n,!1)},ce=e=>{let t={...d.value,page:e};d.value=t,Q(t),$(t,!1)},le=e=>{let t={...d.value,per_page:e,page:1};d.value=t,Q(t),$(t,!1)},Q=(n,r=!1)=>{let i={...t.query};Object.entries(n).forEach(([e,t])=>{t!=null&&t!==``?i[e]=String(t):delete i[e]});let a=r?`replace`:`push`;e[a]({query:i})},ue=()=>{e.replace({query:{}})},de=()=>{let e={per_page:50};d.value={...e,...O.value}},$=async(e,t=!0)=>{t&&e&&Q(e),await k(e)},fe=()=>{n.value=[],r.value=null,i.value=[],a.value=[],o.value=[],c.value=C(),d.value={},l.value=!1};return s(()=>t.query,async()=>{if(de(),t.name&&t.name.toString().includes(`return`)&&!t.name.toString().includes(`return-order`))try{await k(d.value)}catch(e){console.error(`Error fetching returns on URL change:`,e)}},{immediate:!1,deep:!0}),{returns:n,currentReturn:r,receivedReturns:i,notReceivedReturns:a,trashedReturns:o,pagination:c,loading:l,filters:d,returnsByPrefix:f,returnsByCustomer:ee,returnsByCurrency:m,returnsByWarehouse:ne,returnsBySalesperson:h,returnsByApprovedBy:_,returnsByReceivedBy:re,receivedReturnsOnly:v,notReceivedReturnsOnly:y,returnsForSelect:b,totalReturnAmount:x,totalReturnAmountUSD:S,returnsByDateRange:w,returnsByApprovalDateRange:T,returnsByReceivedDateRange:ie,returnStats:E,urlParams:O,fetchReturns:k,fetchReturn:A,createReturn:j,fetchReceivedReturns:M,fetchNotReceivedReturns:N,fetchTrashedReturns:P,restoreReturn:F,forceDeleteReturn:I,searchReturns:L,fetchReturnsForSelect:R,getReturnsByCustomer:z,getReturnsByCurrency:B,getReturnsByWarehouse:H,getReturnsByPrefix:U,getReturnsBySalesperson:W,getReturnsByDateRange:G,getReturnsByStatus:K,getReturnsByApprovalDateRange:q,getReturnsByReceivedDateRange:J,getReturnStats:Y,updateFilters:X,clearFilters:ae,clearCurrentReturn:Z,setSearch:oe,setSort:se,setPage:ce,setPerPage:le,updateUrlParams:Q,clearUrlParams:ue,syncFiltersWithUrl:de,fetchData:$,markOrderReceived:V,reset:fe}}),k={key:0,class:`space-y-6`},A={class:`bg-gray-50 dark:bg-gray-700 rounded-lg p-4`},j={class:`grid grid-cols-1 md:grid-cols-2 gap-4 text-sm`},M={class:`ml-2 font-medium text-gray-900 dark:text-white`},N={class:`ml-2 font-medium text-gray-900 dark:text-white`},P={class:`ml-2 font-medium text-gray-900 dark:text-white`},F={class:`ml-2 font-medium text-gray-900 dark:text-white`},I={class:`ml-2 font-medium text-gray-900 dark:text-white`},L={key:0},R={class:`ml-2 font-medium text-gray-900 dark:text-white`},z={key:0,class:`mt-3`},B={class:`mt-1 text-sm text-gray-900 dark:text-white`},V=[`disabled`],H={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},U={class:`flex items-center justify-end space-x-3`},W=[`disabled`],G=[`disabled`],K={key:0,class:`flex items-center`},q={key:1,class:`flex items-center`};var J=a({__name:`CustomerReturnMarkReceived`,props:{show:{type:Boolean},returnOrder:{}},emits:[`update:show`,`marked-received`],setup(t,{emit:n}){let r=t,i=n,a=O(),{user:te}=S(),p=ee(),m=u(!1),C=u({}),E=u({return_received_note:``}),D=g({get:()=>r.show,set:e=>i(`update:show`,e)}),J=g(()=>!0),Y=()=>{m.value||(X(),i(`update:show`,!1))},X=()=>{E.value={return_received_note:``},C.value={}},ae=()=>(C.value={},!0),Z=async()=>{if(!(!r.returnOrder||!ae()))try{m.value=!0;let e={return_received_note:E.value.return_received_note||void 0},t=await a.markOrderReceived(r.returnOrder.id,e);p.success(`Return order marked as received successfully`),i(`marked-received`,t),Y()}catch(e){console.error(`Error marking return order as received:`,e),e.response?.data?.errors?C.value=e.response.data.errors:p.error(e.response?.data?.message||`Failed to mark return order as received`)}finally{m.value=!1}};return s(()=>r.show,e=>{e&&X()}),(t,n)=>(o(),re(ie,{modelValue:D.value,"onUpdate:modelValue":n[1]||=e=>D.value=e,title:`Mark Return Order as Received`,size:`lg`,loading:m.value,onClose:Y},{footer:c(()=>[_(`div`,U,[_(`button`,{type:`button`,onClick:Y,class:`inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 transition-colors duration-200`,disabled:m.value},` Cancel `,8,W),_(`button`,{type:`submit`,onClick:Z,class:`inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md shadow-sm hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-900 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed`,disabled:m.value||!J.value},[m.value?(o(),y(`div`,K,n[11]||=[_(`svg`,{class:`animate-spin -ml-1 mr-2 h-4 w-4 text-white`,xmlns:`http://www.w3.org/2000/svg`,fill:`none`,viewBox:`0 0 24 24`},[_(`circle`,{class:`opacity-25`,cx:`12`,cy:`12`,r:`10`,stroke:`currentColor`,"stroke-width":`4`}),_(`path`,{class:`opacity-75`,fill:`currentColor`,d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z`})],-1),b(` Marking as Received... `,-1)])):(o(),y(`div`,q,[x(d(e),{class:`h-4 w-4 mr-2`}),n[12]||=b(` Mark as Received `,-1)]))],8,G)])]),default:c(()=>[t.returnOrder?(o(),y(`div`,k,[_(`div`,A,[n[9]||=_(`h4`,{class:`text-sm font-medium text-gray-900 dark:text-white mb-3`},`Return Order Details`,-1),_(`div`,j,[_(`div`,null,[n[2]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Return Code:`,-1),_(`span`,M,f(t.returnOrder.return_code),1)]),_(`div`,null,[n[3]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Date:`,-1),_(`span`,N,f(d(T)(t.returnOrder.date)),1)]),_(`div`,null,[n[4]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Customer:`,-1),_(`span`,P,f(t.returnOrder.customer?.name||`N/A`),1)]),_(`div`,null,[n[5]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Total:`,-1),_(`span`,F,f(d(w)(t.returnOrder.total,t.returnOrder.currency?.code)),1)]),_(`div`,null,[n[6]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Total USD:`,-1),_(`span`,I,f(d(w)(t.returnOrder.total_usd,`USD`)),1)]),t.returnOrder.currency_rate?(o(),y(`div`,L,[n[7]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Currency Rate:`,-1),_(`span`,R,f(t.returnOrder.currency_rate),1)])):v(``,!0)]),t.returnOrder.note?(o(),y(`div`,z,[n[8]||=_(`span`,{class:`text-gray-500 dark:text-gray-400`},`Note:`,-1),_(`p`,B,f(t.returnOrder.note),1)])):v(``,!0)]),_(`form`,{onSubmit:h(Z,[`prevent`]),class:`space-y-4`},[_(`div`,null,[n[10]||=_(`label`,{for:`return_received_note`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Receive Note `,-1),l(_(`textarea`,{id:`return_received_note`,"onUpdate:modelValue":n[0]||=e=>E.value.return_received_note=e,rows:`3`,class:`block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 sm:text-sm`,placeholder:`Optional receive note...`,disabled:m.value},null,8,V),[[ne,E.value.return_received_note]]),C.value.return_received_note?(o(),y(`p`,H,f(C.value.return_received_note),1)):v(``,!0)])],32)])):v(``,!0)]),_:1},8,[`modelValue`,`loading`]))}}),Y=J;export{Y as b,O as c};