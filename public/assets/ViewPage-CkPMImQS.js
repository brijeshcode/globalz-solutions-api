import{H as e,L as ee,a8 as te,aD as ne,aE as t,aK as re,aL as n,aO as r,aP as i,aR as a,aS as o,aT as ie,aU as s,aV as c,aX as l,aY as u,aZ as ae,al as oe,az as se,b0 as ce,b2 as d,b3 as f,b9 as p,ba as m,bc as h,bd as g,bg as _,d as le,j as ue,s as v,v as y}from"./index-C0meH5qn.js";import{b as de}from"./useAuth-DRHh4S2I.js";import"./GlobalConfig-wPgXFcZ5.js";import{b as fe,d as pe}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import{b}from"./ConfirmationModal-BlfKGQuh.js";import{b as x}from"./DataItems-Dx820Y2u.js";import{b as me,c as he}from"./SystemInfoCard-DVXGawty.js";import{b as ge}from"./priceListStore-CLsIwU2i.js";const _e={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},ve={class:`mb-8`},ye={class:`flex items-center justify-between`},be={class:`flex items-center space-x-4`},xe={class:`text-3xl font-bold text-gray-900 dark:text-gray-100`},Se={class:`text-sm text-gray-600 dark:text-gray-400 mt-1`},Ce={class:`flex items-center space-x-3`},we={key:0,class:`flex items-center justify-center py-12`},Te={key:1,class:`bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6`},Ee={class:`flex items-center`},S={class:`text-red-600 dark:text-red-400 mt-1`},C={key:2,class:`space-y-8`},w={class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300`},T={class:`bg-white dark:bg-gray-800 shadow rounded-lg`},E={class:`px-6 py-5 border-b border-gray-200 dark:border-gray-700`},D={class:`flex items-center justify-between`},De={key:0,class:`px-6 py-8 text-center`},Oe={key:1,class:`overflow-x-auto`},ke={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Ae={class:`bg-gray-50 dark:bg-gray-700`},je={key:0,class:`px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},Me={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ne={class:`px-6 py-4 whitespace-nowrap`},Pe={class:`text-sm font-medium text-gray-900 dark:text-white`},Fe={class:`px-6 py-4`},Ie={class:`text-sm text-gray-900 dark:text-white`},Le={class:`px-6 py-4 whitespace-nowrap`},Re={class:`text-sm font-medium text-gray-900 dark:text-white`},ze={key:0,class:`px-6 py-4 whitespace-nowrap text-right text-sm font-medium`},Be={class:`flex items-center justify-end space-x-2`},Ve=[`onClick`],He=[`onClick`],Ue={key:2,class:`px-6 py-8 text-center`},We={class:`relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white dark:bg-gray-800`},Ge={class:`flex items-center justify-between mb-4 border-b border-gray-200 dark:border-gray-700 pb-4`},Ke={class:`text-lg font-medium text-gray-900 dark:text-white`},O={key:0},qe={key:1},Je=[`disabled`],Ye=[`value`],Xe={key:2,class:`bg-gray-50 dark:bg-gray-900 p-4 rounded-md space-y-2`},Ze={class:`flex justify-between`},Qe={class:`text-sm text-gray-900 dark:text-white`},$e={class:`flex justify-between`},et={class:`text-sm text-gray-900 dark:text-white`},tt={class:`flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700`},nt=[`disabled`],rt=[`disabled`],it={key:0,class:`flex items-center`},at={key:1};var k=ae({__name:`ViewPage`,setup(ae){let k=t(),A=ne(),j=a(()=>parseInt(A.params.id)),M=ge(),N=le(),P=se(),{isSuperAdmin:F}=de(),I=h(null);h([]);let L=h(!1),ot=h(!1),R=h(!1),z=h(``),B=h(!1),V=h(!1),H=h(!1),U=h(!1),W=h(!1),G=h(!1),K=h(!1),q=h(null),J=h({item_code:``,item_id:null,item_description:``,sell_price:0}),Y=a(()=>N.items||[]),X=a(()=>(G.value||J.value.item_code&&J.value.item_id)&&J.value.sell_price>=0),st=async()=>{try{L.value=!0,z.value=``,I.value=await M.fetchPriceList(j.value),I.value&&(I.value.price_list_items=I.value.items)}catch(e){z.value=e.message||`Failed to load price list details`,console.error(`Error loading price list:`,e),P.error(`Failed to load price list details`)}finally{L.value=!1}},ct=()=>{k.push({name:`price-lists.index`})},lt=()=>{k.push({name:`price-lists.edit`,params:{id:j.value.toString()}})},ut=()=>{B.value=!0},dt=async()=>{try{V.value=!0,await M.deletePriceList(j.value),P.success(`Price list deleted successfully`),k.push({name:`price-lists.index`})}catch(e){console.error(`Error deleting price list:`,e),P.error(`Failed to delete price list`)}finally{V.value=!1,B.value=!1}},Z=()=>{J.value={item_code:``,item_id:null,item_description:``,sell_price:0}},Q=()=>{W.value=!1,G.value=!1,q.value=null,Z()},ft=()=>{let e=Y.value.find(e=>e.code===J.value.item_code);e&&(J.value.item_id=e.id,J.value.item_description=e.description,J.value.sell_price=e.base_sell||0)},pt=()=>{if(J.value.item_id){let e=Y.value.find(e=>e.id===J.value.item_id);e&&(J.value.item_code=e.code,J.value.item_description=e.description,J.value.sell_price=e.base_sell||0)}},$=()=>{G.value=!1,Z(),W.value=!0},mt=e=>{G.value=!0,q.value=e,J.value={item_code:e.item_code,item_id:e.item_id,item_description:e.item_description,sell_price:e.sell_price},W.value=!0},ht=e=>{q.value=e,H.value=!0},gt=async()=>{if(X.value)try{if(K.value=!0,G.value&&q.value?.id){if(await M.updatePriceListItem(j.value,q.value.id,{sell_price:J.value.sell_price}),P.success(`Item price updated successfully`),I.value?.price_list_items){let e=I.value.price_list_items.findIndex(e=>e.id===q.value?.id);e!==-1&&(I.value.price_list_items[e].sell_price=J.value.sell_price)}}else await M.addPriceListItem(j.value,{item_code:J.value.item_code,item_id:J.value.item_id,item_description:J.value.item_description,sell_price:J.value.sell_price}),P.success(`Item added to price list`);Q()}catch(e){console.error(`Error saving item:`,e),P.error(G.value?`Failed to update item`:`Failed to add item`)}finally{K.value=!1}},_t=async()=>{if(q.value?.id)try{if(U.value=!0,await M.deletePriceListItem(q.value.id),P.success(`Item removed from price list`),I.value?.price_list_items){let e=I.value.price_list_items.findIndex(e=>e.id===q.value?.id);e!==-1&&(I.value.price_list_items.splice(e,1),I.value.item_count=Math.max(0,(I.value.item_count||0)-1))}}catch(e){console.error(`Error deleting item:`,e),P.error(`Failed to remove item`)}finally{U.value=!1,H.value=!1,q.value=null}};return ce(async()=>{j.value&&st();try{R.value=!0,N.items.length===0&&await N.fetchItems()}catch(e){console.error(`Error loading items:`,e)}finally{R.value=!1}}),(ne,t)=>(d(),c(`div`,_e,[o(`div`,ve,[o(`div`,ye,[o(`div`,be,[o(`button`,{onClick:ct,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[u(g(oe),{class:`w-5 h-5`})]),o(`div`,null,[o(`h1`,xe,_(I.value?.code||`Price List Details`),1),o(`p`,Se,_(I.value?.description),1)])]),o(`div`,Ce,[g(F)?(d(),c(`button`,{key:0,onClick:lt,class:`inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700`},[u(g(y),{class:`w-4 h-4 mr-2`}),t[7]||=l(` Edit `,-1)])):s(``,!0),g(F)?(d(),c(`button`,{key:1,onClick:ut,class:`inline-flex items-center px-4 py-2 border border-red-300 dark:border-red-600 rounded-md shadow-sm text-sm font-medium text-red-700 dark:text-red-300 bg-white dark:bg-gray-800 hover:bg-red-50 dark:hover:bg-red-900/20`},[u(g(v),{class:`w-4 h-4 mr-2`}),t[8]||=l(` Delete `,-1)])):s(``,!0)])])]),L.value?(d(),c(`div`,we,t[9]||=[o(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-4`},null,-1),o(`span`,{class:`text-gray-600 dark:text-gray-400`},`Loading price list details...`,-1)])):z.value?(d(),c(`div`,Te,[o(`div`,Ee,[u(g(te),{class:`w-6 h-6 text-red-500 mr-3`}),o(`div`,null,[t[10]||=o(`h3`,{class:`text-lg font-medium text-red-800 dark:text-red-300`},`Error Loading Price List`,-1),o(`p`,S,_(z.value),1)])])])):I.value?(d(),c(`div`,C,[u(he,{title:`General Information`},{default:p(()=>[u(x,{label:`Price List Code`,value:I.value.code},null,8,[`value`]),u(x,{label:`Description`,value:I.value.description},null,8,[`value`]),u(x,{label:`Item Count`},{default:p(()=>[o(`span`,w,_(I.value.item_count)+` items `,1)]),_:1}),u(x,{label:`Note`,value:I.value.note||`-`},null,8,[`value`])]),_:1}),g(F)?(d(),ie(me,{key:0,item:I.value,formatDateTime:g(pe)},null,8,[`item`,`formatDateTime`])):s(``,!0),o(`div`,T,[o(`div`,E,[o(`div`,D,[t[12]||=o(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-gray-100`},` Price List Items `,-1),g(F)?(d(),c(`button`,{key:0,onClick:$,class:`inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700`},[u(g(e),{class:`w-4 h-4 mr-2`}),t[11]||=l(` Add Items `,-1)])):s(``,!0)])]),ot.value?(d(),c(`div`,De,t[13]||=[o(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-2`},null,-1),o(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},`Loading items...`,-1)])):I.value.price_list_items&&I.value.price_list_items.length>0?(d(),c(`div`,Oe,[o(`table`,ke,[o(`thead`,Ae,[o(`tr`,null,[t[14]||=o(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Item Code `,-1),t[15]||=o(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Description `,-1),t[16]||=o(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Sell Price `,-1),g(F)?(d(),c(`th`,je,` Actions `)):s(``,!0)])]),o(`tbody`,Me,[(d(!0),c(i,null,f(I.value.price_list_items,e=>(d(),c(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[o(`td`,Ne,[o(`div`,Pe,_(e.item_code),1)]),o(`td`,Fe,[o(`div`,Ie,_(e.item_description),1)]),o(`td`,Le,[o(`div`,Re,_(g(fe)(e.sell_price)),1)]),g(F)?(d(),c(`td`,ze,[o(`div`,Be,[o(`button`,{onClick:ee=>mt(e),class:`text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300`,title:`Edit item price`},[u(g(y),{class:`w-4 h-4`})],8,Ve),o(`button`,{onClick:ee=>ht(e),class:`text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300`,title:`Remove from price list`},[u(g(v),{class:`w-4 h-4`})],8,He)])])):s(``,!0)]))),128))])])])):(d(),c(`div`,Ue,[u(g(ee),{class:`mx-auto h-12 w-12 text-gray-400`}),t[18]||=o(`h3`,{class:`mt-4 text-sm font-medium text-gray-900 dark:text-gray-100`},`No items`,-1),t[19]||=o(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},` No items have been added to this price list yet. `,-1),g(F)?(d(),c(`button`,{key:0,onClick:$,class:`mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700`},[u(g(e),{class:`w-4 h-4 mr-2`}),t[17]||=l(` Add First Item `,-1)])):s(``,!0)]))])])):s(``,!0),u(b,{show:B.value,"onUpdate:show":t[0]||=e=>B.value=e,type:`delete`,title:`Delete Price List`,message:`Are you sure you want to delete price list '${I.value?.code}'? This action can be undone by restoring from trash.`,"confirm-text":`Delete Price List`,"loading-text":`Deleting...`,loading:V.value,onConfirm:dt,onCancel:t[1]||=e=>B.value=!1},null,8,[`show`,`message`,`loading`]),u(b,{show:H.value,"onUpdate:show":t[2]||=e=>H.value=e,type:`delete`,title:`Remove Item`,message:`Are you sure you want to remove '${q.value?.item_code}' from this price list?`,"confirm-text":`Remove Item`,"loading-text":`Removing...`,loading:U.value,onConfirm:_t,onCancel:t[3]||=e=>H.value=!1},null,8,[`show`,`message`,`loading`]),W.value?(d(),c(`div`,{key:3,class:`fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50`,onClick:r(Q,[`self`])},[o(`div`,We,[o(`div`,Ge,[o(`h3`,Ke,_(G.value?`Edit Item Price`:`Add Item to Price List`),1),o(`button`,{onClick:Q,class:`text-gray-400 hover:text-gray-600 dark:hover:text-gray-300`},[u(g(ue),{class:`w-5 h-5`})])]),o(`form`,{onSubmit:r(gt,[`prevent`]),class:`space-y-4`},[G.value?s(``,!0):(d(),c(`div`,O,[t[20]||=o(`label`,{class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Item Code `,-1),m(o(`input`,{"onUpdate:modelValue":t[4]||=e=>J.value.item_code=e,type:`text`,placeholder:`Enter item code`,onInput:ft,required:``,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm transition-colors duration-200 bg-white dark:bg-gray-800`},null,544),[[n,J.value.item_code]])])),G.value?s(``,!0):(d(),c(`div`,qe,[t[22]||=o(`label`,{class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Item `,-1),m(o(`select`,{"onUpdate:modelValue":t[5]||=e=>J.value.item_id=e,required:``,onChange:pt,disabled:R.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`},[t[21]||=o(`option`,{value:``},`Select Item`,-1),(d(!0),c(i,null,f(Y.value,e=>(d(),c(`option`,{key:e.id,value:e.id},_(e.description),9,Ye))),128))],40,Je),[[re,J.value.item_id]])])),G.value?(d(),c(`div`,Xe,[o(`div`,Ze,[t[23]||=o(`span`,{class:`text-sm font-medium text-gray-600 dark:text-gray-400`},`Item Code:`,-1),o(`span`,Qe,_(J.value.item_code),1)]),o(`div`,$e,[t[24]||=o(`span`,{class:`text-sm font-medium text-gray-600 dark:text-gray-400`},`Description:`,-1),o(`span`,et,_(J.value.item_description),1)])])):s(``,!0),o(`div`,null,[t[25]||=o(`label`,{class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Sell Price `,-1),m(o(`input`,{"onUpdate:modelValue":t[6]||=e=>J.value.sell_price=e,type:`number`,step:`0.01`,min:`0`,placeholder:`0.00`,required:``,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm transition-colors duration-200 bg-white dark:bg-gray-800`},null,512),[[n,J.value.sell_price,void 0,{number:!0}]])]),o(`div`,tt,[o(`button`,{type:`button`,onClick:Q,disabled:K.value,class:`px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed`},` Cancel `,8,nt),o(`button`,{type:`submit`,disabled:K.value||!X.value,class:`px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed`},[K.value?(d(),c(`div`,it,[t[26]||=o(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),l(` `+_(G.value?`Updating...`:`Adding...`),1)])):(d(),c(`span`,at,_(G.value?`Update Price`:`Add Item`),1))],8,rt)])],32)])])):s(``,!0)]))}}),A=k;export{A as default};