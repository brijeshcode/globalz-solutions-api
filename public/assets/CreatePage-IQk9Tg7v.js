import{F as e,J as t,P as n,a$ as r,aC as i,aI as a,aJ as o,aM as s,aN as c,aP as l,aQ as u,aS as d,aT as f,aU as ee,aV as p,aW as m,aX as te,aZ as ne,aj as re,ax as ie,b0 as h,b7 as g,b9 as _,ba as v,bb as ae,bd as y,d as oe,f as b,i as se,m as ce}from"./index-DgfcCRz4.js";import"./GlobalConfig-wPgXFcZ5.js";import"./tableUtils-ylneqlK-.js";import"./Modal-CMGr9AMb.js";import{b as le}from"./ImportModal-BfEvHVzh.js";import{b as ue}from"./priceListStore-DQLFeG4m.js";const de={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},fe={class:`max-w-4xl mx-auto`},pe={class:`mb-8`},me={class:`flex items-center space-x-4 mb-2`},he={class:`bg-white dark:bg-gray-800 shadow rounded-lg`},ge={class:`px-6 py-8`},_e={class:`grid grid-cols-1 gap-6`},ve={class:`md:max-w-md`},ye={key:0,class:`mt-1 text-xs text-gray-500`},x={class:`border-b border-gray-200 dark:border-gray-700 pb-6`},S={class:`flex justify-between items-center mb-4`},C={class:`flex space-x-2`},w={key:0,class:`text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg`},T={class:`mt-6`},E={key:1,class:`overflow-x-auto`},D={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},O={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},k={class:`px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white`},A={class:`px-3 py-4 whitespace-nowrap`},j=[`onUpdate:modelValue`,`disabled`,`onInput`],M={class:`px-3 py-4`},N=[`onUpdate:modelValue`,`disabled`,`onChange`],P=[`value`],be={class:`px-3 py-4 whitespace-nowrap`},xe=[`value`],Se={class:`px-3 py-4 whitespace-nowrap`},Ce=[`onUpdate:modelValue`,`disabled`],we={class:`px-3 py-4 whitespace-nowrap text-right text-sm font-medium`},Te=[`onClick`],Ee=[`disabled`],De={class:`flex justify-between items-center mt-1`},Oe={key:0,class:`text-sm text-red-600 dark:text-red-400`},ke={class:`text-xs text-gray-500 ml-auto`},Ae={class:`flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700`},je=[`disabled`],Me=[`disabled`],Ne={key:0,class:`flex items-center justify-center`},Pe={key:1},Fe={class:`mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4`},Ie={class:`flex`},Le={class:`flex-shrink-0`};var F=te({__name:`CreatePage`,setup(te){let F=i(),I=ue(),L=oe(),R=ie(),z=_(!1),B=_(!1),V=_({}),H=_(!1),U=_(!1),W=_(null),Re={item_code:``,item_id:null,item_description:``,sell_price:0},G=_({code:``,description:``,note:``}),K=_([]),q=l(()=>L.items||[]),ze=l(()=>{let e=[`ring-gray-300 dark:ring-gray-600`,`focus:ring-indigo-600 dark:focus:ring-indigo-400`];return J(`note`)?[`ring-red-300 dark:ring-red-500`,`focus:ring-red-500 dark:focus:ring-red-400`].join(` `):z.value?[...e,`disabled:cursor-not-allowed`,`disabled:bg-gray-50 dark:disabled:bg-gray-800`,`disabled:text-gray-500 dark:disabled:text-gray-400`].join(` `):e.join(` `)}),Be=l(()=>Object.keys(V.value).length>0),Ve=l(()=>G.value.description.trim().length>0&&G.value.description.length<=255&&(G.value.code?.length||0)<=255&&(G.value.note?.length||0)<=1e3),J=e=>V.value[e]||``,Y=e=>{V.value[e]&&delete V.value[e]},He=e=>{V.value={},Object.entries(e).forEach(([e,t])=>{V.value[e]=t[0]})},X=()=>{V.value={}},Z=()=>{G.value={code:``,description:``,note:``},K.value=[],X()},Q=()=>{K.value.push({...Re})},Ue=e=>{K.value.splice(e,1)},We=e=>{let t=K.value[e];if(t&&t.item_id){let e=q.value.find(e=>e.id===t.item_id);e&&(t.item_code=e.code,t.item_description=e.description,t.sell_price=e.base_sell||0)}},Ge=e=>{let t=K.value[e],n=q.value.find(e=>e.code===t.item_code);n&&(t.item_id=n.id,t.item_description=n.description,t.sell_price=n.base_sell||0)},Ke=e=>{if(!e)return``;let t=q.value.find(t=>t.id===e);return t?.item_unit?.name||``},qe=async()=>{if(X(),!G.value.description.trim()){V.value.description=`Description is required`;return}if(K.value.length===0){R.error(`Please add at least one item to the price list`);return}let e=K.value.some(e=>!e.item_code||!e.item_id||e.sell_price<0);if(e){R.error(`Please ensure all items have valid code, item selection, and sell price`);return}try{z.value=!0;let e={...G.value,items:K.value},t=await I.createPriceList(e);Z(),R.success(`Price list created successfully`),F.push({name:`price-lists.view`,params:{id:t.id.toString()}})}catch(e){e.response?.status===422&&e.response?.data?.errors?He(e.response.data.errors):R.error(`Failed to create price list`)}finally{z.value=!1}},$=()=>{Z(),F.push({name:`price-lists.index`})},Je=()=>{F.push({name:`price-lists.index`})},Ye=e=>{let t=e.split(/\r?\n/).filter(e=>e.trim());if(t.length<2)return[];let n=e=>{let t=[],n=``,r=!1;for(let i=0;i<e.length;i++){let a=e[i],o=e[i+1];a===`"`?r&&o===`"`?(n+=`"`,i++):r=!r:a===`,`&&!r?(t.push(n.trim()),n=``):n+=a}return t.push(n.trim()),t},r=n(t[0]),i=[];for(let e=1;e<t.length;e++){let a=n(t[e]),o={};r.forEach((e,t)=>{o[e]=a[t]||``}),i.push(o)}return i},Xe=async e=>{try{U.value=!0,W.value=null;let t=new FileReader;t.onload=async e=>{try{let t=e.target?.result,n=Ye(t);if(n.length===0){R.error(`CSV file is empty`),U.value=!1;return}let r=0,i=0,a=[];for(let e=0;e<n.length;e++){let t=n[e],o=e+2,s=(t.item_code||t.Item_Code||t[`Item Code`]||``).toString().trim();(t.description||t.Description||``).toString().trim();let c=parseFloat(t.sell_price||t.Sell_Price||t[`Sell Price`]||0);if(!s){a.push({row:o,error:`Missing item code`}),i++;continue}let l=q.value.find(e=>e.code?.toString().trim().toLowerCase()===s.toLowerCase());if(!l){a.push({row:o,error:`Item with code '${s}' not found in system`}),i++;continue}let u=K.value.find(e=>e.item_code===s);if(u){a.push({row:o,error:`Item '${s}' already exists in the price list`}),i++;continue}K.value.push({item_code:s,item_id:l.id,item_description:l.description,sell_price:c||l.base_sell||0}),r++}W.value={message:`Import completed: ${r} successful, ${i} failed`,data:{total:n.length,imported:r,updated:0,skipped:i,errors:a}},r>0&&R.success(`Successfully imported ${r} items`),i>0&&R.warning(`${i} items failed to import. Check the import results for details.`)}catch(e){console.error(`Error parsing CSV file:`,e),R.error(`Failed to parse CSV file. Please ensure it has the correct format.`)}finally{U.value=!1}},t.onerror=()=>{R.error(`Failed to read file`),U.value=!1},t.readAsText(e)}catch(e){console.error(`Error importing items:`,e),R.error(`Failed to import items`),U.value=!1}},Ze=()=>{let e=[`item_code`,`description`,`sell_price`],t=[[`ITEM001`,`Sample Item 1`,`100.00`],[`ITEM002`,`Sample Item 2`,`200.00`]],n=[e.join(`,`),...t.map(e=>e.join(`,`))].join(`
`),r=new Blob([n],{type:`text/csv;charset=utf-8;`}),i=window.URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.download=`price_list_items_template_${new Date().getTime()}.csv`,a.click(),window.URL.revokeObjectURL(i),R.success(`Template downloaded successfully`)};return ne(async()=>{Z();try{B.value=!0,L.items.length===0&&await L.fetchItems()}catch(e){console.error(`Error loading items:`,e),R.error(`Failed to load items`)}finally{B.value=!1}}),(i,l)=>(r(),f(c,null,[u(`div`,de,[u(`div`,fe,[u(`div`,pe,[u(`div`,me,[u(`button`,{onClick:Je,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[m(v(re),{class:`w-5 h-5`})]),l[9]||=u(`div`,null,[u(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Create Price List `),u(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Add a new price list for managing item prices `)],-1)])]),u(`div`,he,[u(`div`,ge,[u(`form`,{onSubmit:s(qe,[`prevent`]),class:`space-y-8`},[u(`div`,null,[l[11]||=u(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-gray-100 mb-4`},` Basic Information `,-1),u(`div`,_e,[u(`div`,ve,[m(b,{type:`text`,maxlength:255,disabled:z.value,onBlur:l[0]||=()=>Y(`code`),modelValue:G.value.code,"onUpdate:modelValue":l[1]||=e=>G.value.code=e,placeholder:`Leave empty for auto-generation`,error:J(`code`),label:`Price List Code`},null,8,[`disabled`,`modelValue`,`error`]),l[10]||=u(`p`,{class:`mt-1 text-xs text-gray-500`},` Optional - System will auto-generate if left empty `,-1)]),u(`div`,null,[m(b,{type:`text`,maxlength:255,disabled:z.value,onBlur:l[2]||=()=>Y(`description`),modelValue:G.value.description,"onUpdate:modelValue":l[3]||=e=>G.value.description=e,placeholder:`Enter price list description`,error:J(`description`),required:``,label:`Description`},null,8,[`disabled`,`modelValue`,`error`]),G.value.description.length>0?(r(),f(`p`,ye,y(G.value.description.length)+`/255 characters `,1)):d(``,!0)])])]),u(`div`,x,[u(`div`,S,[l[14]||=u(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white`},` Price List Items `,-1),u(`div`,C,[u(`button`,{type:`button`,onClick:l[4]||=e=>H.value=!0,class:`inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm leading-4 font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200`},[m(v(ce),{class:`h-4 w-4 mr-2`}),l[12]||=p(` Import CSV `,-1)]),u(`button`,{type:`button`,onClick:Q,class:`inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-700 dark:hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200`},[m(v(e),{class:`h-4 w-4 mr-2`}),l[13]||=p(` Add Item `,-1)])])]),K.value.length<1?(r(),f(`div`,w,[m(v(t),{class:`h-12 w-12 mx-auto text-gray-400`}),l[16]||=u(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},`No items added`,-1),l[17]||=u(`p`,{class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},`Get started by adding items to this price list.`,-1),u(`div`,T,[u(`button`,{type:`button`,onClick:Q,class:`inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-700 dark:hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200`},[m(v(e),{class:`h-4 w-4 mr-2`}),l[15]||=p(` Add First Item `,-1)])])])):(r(),f(`div`,E,[u(`table`,D,[l[19]||=u(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[u(`tr`,null,[u(`th`,{class:`px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-12`},` # `),u(`th`,{class:`px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Item Code `),u(`th`,{class:`px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Item `),u(`th`,{class:`px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Unit `),u(`th`,{class:`px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Sell Price `),u(`th`,{class:`px-3 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-12`},` Actions `)])],-1),u(`tbody`,O,[(r(!0),f(c,null,h(K.value,(e,t)=>(r(),f(`tr`,{key:t,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[u(`td`,k,y(t+1),1),u(`td`,A,[g(u(`input`,{"onUpdate:modelValue":t=>e.item_code=t,type:`text`,placeholder:`Item code`,disabled:z.value,onInput:e=>Ge(t),required:``,class:`block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-800`},null,40,j),[[o,e.item_code]])]),u(`td`,M,[g(u(`select`,{"onUpdate:modelValue":t=>e.item_id=t,required:``,disabled:z.value||B.value,onChange:e=>We(t),class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`},[l[18]||=u(`option`,{value:``},`Select Item`,-1),(r(!0),f(c,null,h(q.value,e=>(r(),f(`option`,{key:e.id,value:e.id},y(e.description),9,P))),128))],40,N),[[a,e.item_id]])]),u(`td`,be,[u(`input`,{value:Ke(e.item_id),type:`text`,disabled:!0,class:`block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-gray-50 dark:bg-gray-700`},null,8,xe)]),u(`td`,Se,[g(u(`input`,{"onUpdate:modelValue":t=>e.sell_price=t,type:`number`,step:`0.01`,min:`0`,placeholder:`0.00`,disabled:z.value,required:``,class:`block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-800`},null,8,Ce),[[o,e.sell_price,void 0,{number:!0}]])]),u(`td`,we,[u(`button`,{type:`button`,onClick:e=>Ue(t),class:`text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 transition-colors duration-200`,title:`Remove item`},[m(v(se),{class:`h-5 w-5`})],8,Te)])]))),128))])])]))]),u(`div`,null,[l[21]||=u(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-gray-100 mb-4`},` Additional Information `,-1),u(`div`,null,[l[20]||=u(`label`,{for:`note`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Note `,-1),g(u(`textarea`,{id:`note`,"onUpdate:modelValue":l[5]||=e=>G.value.note=e,rows:`4`,placeholder:`Enter additional notes about this price list (optional)`,disabled:z.value,class:ae([ze.value,`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-800 resize-vertical`]),onBlur:l[6]||=()=>Y(`note`),maxlength:`1000`},null,42,Ee),[[o,G.value.note]]),u(`div`,De,[J(`note`)?(r(),f(`p`,Oe,y(J(`note`)),1)):d(``,!0),u(`p`,ke,y(G.value.note?.length||0)+`/1000 characters `,1)])])]),u(`div`,Ae,[u(`button`,{type:`button`,onClick:$,disabled:z.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},` Cancel `,8,je),u(`button`,{type:`submit`,disabled:z.value||Be.value||!Ve.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},[z.value?(r(),f(`div`,Ne,l[22]||=[u(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),p(` Creating... `,-1)])):(r(),f(`span`,Pe,`Create Price List`))],8,Me)])],32)])]),u(`div`,Fe,[u(`div`,Ie,[u(`div`,Le,[m(v(n),{class:`h-5 w-5 text-blue-400`})]),l[23]||=ee(`<div class="ml-3"><h3 class="text-sm font-medium text-blue-800 dark:text-blue-300"> About Price Lists </h3><div class="mt-2 text-sm text-blue-700 dark:text-blue-400"><p class="mb-2"> Price lists allow you to manage different pricing strategies for your items: </p><ul class="list-disc list-inside space-y-1"><li>Create multiple price lists for different customer segments</li><li>Define specific prices for items in each list</li><li>Track the number of items included in each price list</li><li>Add notes for special pricing conditions or terms</li></ul></div></div>`,1)])])])]),m(le,{modelValue:H.value,"onUpdate:modelValue":l[7]||=e=>H.value=e,title:`Import Price List Items`,description:`Upload a CSV file to import items with their prices.`,"accept-types":`.csv`,"accept-types-label":`CSV files (max 10MB)`,"import-result":W.value,instructions:[`CSV file should contain columns: item_code, description, sell_price`,`First row should be the header`,`Maximum file size: 10MB`],loading:U.value,onImport:Xe,onDownloadTemplate:Ze,onClearResult:l[8]||=e=>W.value=null},null,8,[`modelValue`,`import-result`,`loading`])],64))}}),I=F;export{I as default};