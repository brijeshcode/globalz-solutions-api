import{aA as e,aM as t,ap as n,aq as r,ar as i,as as a,at as o,ay as s,az as c,b2 as ee,b6 as l}from"./index-BuHiL7JP.js";import{b as u}from"./tableUtils-jdfVzp2e.js";var d=class{baseUrl=`/customers/sale-orders`;async getSaleOrders(e){try{let t=this.buildQueryParams(e),n=await r(`${this.baseUrl}?${t}`,{loadingMessage:`Loading sale orders...`,showLoading:!0});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching sale orders:`,e),e}}async getSaleOrder(e){try{let t=await r(`${this.baseUrl}/${e}`,{loadingMessage:`Loading sale order...`});return t.data.data}catch(e){throw console.error(`Error fetching sale order:`,e),e}}async createSaleOrder(e){try{let t=await a(this.baseUrl,e,{loadingMessage:`Creating sale order...`,showSuccessNotification:!0,successMessage:`Sale order created successfully`});return t.data.data}catch(e){throw console.error(`Error creating sale order:`,e),e}}async updateSaleOrder(e,t){try{let n=await o(`${this.baseUrl}/${e}`,t,{loadingMessage:`Updating sale order...`,showSuccessNotification:!0,successMessage:`Sale order updated successfully`});return n.data.data}catch(e){throw console.error(`Error updating sale order:`,e),e}}async deleteSaleOrder(e){try{await n(`${this.baseUrl}/${e}`,{loadingMessage:`Deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order deleted successfully`})}catch(e){throw console.error(`Error deleting sale order:`,e),e}}async getTrashedSaleOrders(e){try{let t=this.buildQueryParams(e),n=await r(`${this.baseUrl}/trashed?${t}`,{loadingMessage:`Loading trashed sale orders...`});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching trashed sale orders:`,e),e}}async approveSaleOrder(e,t){try{let n=await i(`${this.baseUrl}/${e}/approve`,t,{loadingMessage:`Approving sale order...`,showSuccessNotification:!0,successMessage:`Sale order approved successfully`});return n.data.data}catch(e){throw console.error(`Error approving sale order:`,e),e}}async restoreSaleOrder(e){try{let t=await i(`${this.baseUrl}/${e}/restore`,{},{loadingMessage:`Restoring sale order...`,showSuccessNotification:!0,successMessage:`Sale order restored successfully`});return t.data.data}catch(e){throw console.error(`Error restoring sale order:`,e),e}}async forceDeleteSaleOrder(e){try{await n(`${this.baseUrl}/${e}/force-delete`,{loadingMessage:`Permanently deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order permanently deleted`})}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}}async getSaleOrderStats(){try{let e=await r(`${this.baseUrl}/stats`,{loadingMessage:`Loading sale order statistics...`});return e.data.data}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}}async searchSaleOrders(e){try{let t=await r(`${this.baseUrl}/search?query=${encodeURIComponent(e)}`,{showLoading:!1});return t.data.data}catch(e){throw console.error(`Error searching sale orders:`,e),e}}async getSaleOrdersByCustomer(e){try{let t=await r(`${this.baseUrl}/by-customer/${e}`,{loadingMessage:`Loading customer sale orders...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by customer:`,e),e}}async getSaleOrdersByCurrency(e){try{let t=await r(`${this.baseUrl}/by-currency/${e}`,{loadingMessage:`Loading sale orders by currency...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by currency:`,e),e}}async getSaleOrdersByWarehouse(e){try{let t=await r(`${this.baseUrl}/by-warehouse/${e}`,{loadingMessage:`Loading sale orders by warehouse...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by warehouse:`,e),e}}async getSaleOrdersByPrefix(e){try{let t=await r(`${this.baseUrl}/by-prefix/${e}`,{loadingMessage:`Loading sale orders by prefix...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by prefix:`,e),e}}async getSaleOrdersByDateRange(e,t){try{let n=await r(`${this.baseUrl}/by-date-range?start_date=${e}&end_date=${t}`,{loadingMessage:`Loading sale orders by date range...`});return n.data.data}catch(e){throw console.error(`Error fetching sale orders by date range:`,e),e}}async getSaleOrdersBySalesperson(e){try{let t=await r(`${this.baseUrl}/by-salesperson/${e}`,{loadingMessage:`Loading sale orders by salesperson...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by salesperson:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const f=new d,p=e(`saleOrders`,()=>{let e=c(),n=s(),r=l([]),i=l(null),a=l([]),o=l(u()),d=l(!1),p=l({per_page:50}),m=t(()=>e=>r.value.filter(t=>t.prefix===e)),te=t(()=>e=>r.value.filter(t=>t.customer_id===e)),h=t(()=>e=>r.value.filter(t=>t.currency_id===e)),g=t(()=>e=>r.value.filter(t=>t.warehouse_id===e)),_=t(()=>e=>r.value.filter(t=>t.salesperson_id===e)),v=t(()=>e=>r.value.filter(t=>t.status===e)),y=t(()=>r.value.filter(e=>e.status===`Waiting`)),b=t(()=>r.value.filter(e=>e.status===`Shipped`)),x=t(()=>r.value.filter(e=>e.status===`Delivered`)),S=t(()=>r.value.reduce((e,t)=>e+t.total,0)),C=t(()=>r.value.reduce((e,t)=>e+t.total_usd,0)),w=t(()=>r.value.reduce((e,t)=>e+t.total_profit,0)),T=t(()=>(e,t)=>r.value.filter(n=>{let r=new Date(n.date),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),E=t(()=>({total:r.value.length,waiting:y.value.length,shipped:b.value.length,delivered:x.value.length,totalAmount:S.value,totalAmountUSD:C.value,totalProfit:w.value,byPrefix:{INX:m.value(`INX`).length,INV:m.value(`INV`).length}})),D=t(()=>{let e={};return Object.entries(n.query).forEach(([t,n])=>{n&&typeof n==`string`&&(e[t]=n)}),e}),O=async e=>{try{d.value=!0,e&&(p.value={...p.value,...e});let t=await f.getSaleOrders(p.value);r.value=t.data,o.value=t.pagination}catch(e){throw console.error(`Error fetching sale orders:`,e),e}finally{d.value=!1}},k=async e=>{try{let t=await f.getSaleOrder(e);return i.value=t,t}catch(e){throw console.error(`Error fetching sale order:`,e),e}},A=async e=>{try{let t=await f.createSaleOrder(e);return r.value.unshift(t),o.value.total+=1,t}catch(e){throw console.error(`Error creating sale order:`,e),e}},j=async(e,t)=>{try{let n=await f.updateSaleOrder(e,t),a=r.value.findIndex(t=>t.id===e);return a!==-1&&(r.value[a]=n),i.value?.id===e&&(i.value=n),n}catch(e){throw console.error(`Error updating sale order:`,e),e}},M=async e=>{try{await f.deleteSaleOrder(e);let t=r.value.findIndex(t=>t.id===e);t!==-1&&r.value.splice(t,1),--o.value.total,i.value?.id===e&&(i.value=null)}catch(e){throw console.error(`Error deleting sale order:`,e),e}},N=async e=>{try{d.value=!0;let t=e||{},n=await f.getTrashedSaleOrders(t);a.value=n.data}catch(e){throw console.error(`Error fetching trashed orders:`,e),e}finally{d.value=!1}},P=async e=>{try{let t=await f.restoreSaleOrder(e),n=a.value.findIndex(t=>t.id===e);return n!==-1&&a.value.splice(n,1),r.value.unshift(t),o.value.total+=1,t}catch(e){throw console.error(`Error restoring sale order:`,e),e}},F=async e=>{try{await f.forceDeleteSaleOrder(e);let t=a.value.findIndex(t=>t.id===e);t!==-1&&a.value.splice(t,1)}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}},I=async(e,t)=>{try{let n=await f.approveSaleOrder(e,t),a=r.value.findIndex(t=>t.id===e);return a!==-1&&r.value.splice(a,1),--o.value.total,i.value?.id===e&&(i.value=null),n}catch(e){throw console.error(`Error approving sale order:`,e),e}},L=async e=>{try{return await f.searchSaleOrders(e)}catch(e){throw console.error(`Error searching sale orders:`,e),e}},R=async e=>{try{return await f.getSaleOrdersByCustomer(e)}catch(e){throw console.error(`Error fetching orders by customer:`,e),e}},ne=async e=>{try{return await f.getSaleOrdersByCurrency(e)}catch(e){throw console.error(`Error fetching orders by currency:`,e),e}},z=async e=>{try{return await f.getSaleOrdersByWarehouse(e)}catch(e){throw console.error(`Error fetching orders by warehouse:`,e),e}},B=async e=>{try{return await f.getSaleOrdersByPrefix(e)}catch(e){throw console.error(`Error fetching orders by prefix:`,e),e}},V=async e=>{try{return await f.getSaleOrdersBySalesperson(e)}catch(e){throw console.error(`Error fetching orders by salesperson:`,e),e}},H=async(e,t)=>{try{return await f.getSaleOrdersByDateRange(e,t)}catch(e){throw console.error(`Error fetching orders by date range:`,e),e}},U=async()=>{try{return await f.getSaleOrderStats()}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}},W=e=>{p.value={...p.value,...e}},G=()=>{p.value={per_page:50}},K=()=>{i.value=null},q=e=>{let t={...p.value,search:e,page:1};p.value=t,Z(t),$(t,!1)},J=(e,t)=>{let n={...p.value,sort_by:e,sort_direction:t,page:1};p.value=n,Z(n),$(n,!1)},Y=e=>{let t={...p.value,page:e};p.value=t,Z(t),$(t,!1)},X=e=>{let t={...p.value,per_page:e,page:1};p.value=t,Z(t),$(t,!1)},Z=(t,r=!1)=>{let i={...n.query};Object.entries(t).forEach(([e,t])=>{t!=null&&t!==``?i[e]=String(t):delete i[e]});let a=r?`replace`:`push`;e[a]({query:i})},re=()=>{e.replace({query:{}})},Q=()=>{let e={per_page:50};p.value={...e,...D.value}},$=async(e,t=!0)=>{t&&e&&Z(e),await O(e)},ie=()=>{r.value=[],i.value=null,a.value=[],o.value=u(),p.value={per_page:50},d.value=!1};return ee(()=>n.query,async()=>{if(Q(),n.name&&n.name.toString().includes(`sale-order`))try{await O(p.value)}catch(e){console.error(`Error fetching sale orders on URL change:`,e)}},{immediate:!1,deep:!0}),{saleOrders:r,currentSaleOrder:i,trashedOrders:a,pagination:o,loading:d,filters:p,ordersByPrefix:m,ordersByCustomer:te,ordersByCurrency:h,ordersByWarehouse:g,ordersBySalesperson:_,ordersByStatus:v,waitingOrders:y,shippedOrders:b,deliveredOrders:x,totalOrderAmount:S,totalOrderAmountUSD:C,totalOrderProfit:w,ordersByDateRange:T,orderStats:E,urlParams:D,fetchSaleOrders:O,fetchSaleOrder:k,createSaleOrder:A,updateSaleOrder:j,deleteSaleOrder:M,fetchTrashedOrders:N,restoreOrder:P,forceDeleteOrder:F,approveOrder:I,searchOrders:L,getOrdersByCustomer:R,getOrdersByCurrency:ne,getOrdersByWarehouse:z,getOrdersByPrefix:B,getOrdersBySalesperson:V,getOrdersByDateRange:H,getOrderStats:U,updateFilters:W,clearFilters:G,clearCurrentOrder:K,setSearch:q,setSort:J,setPage:Y,setPerPage:X,updateUrlParams:Z,clearUrlParams:re,syncFiltersWithUrl:Q,fetchData:$,reset:ie}});export{p as b};