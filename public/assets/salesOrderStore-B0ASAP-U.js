import{aA as e,aS as t,aW as n,ad as r,ae as i,af as a,ag as o,ah as s,am as c,an as l,ao as u}from"./index-7--PgFgh.js";import{b as d}from"./tableUtils-jdfVzp2e.js";var f=class{baseUrl=`/customers/sale-orders`;async getSaleOrders(e){try{let t=this.buildQueryParams(e),n=await i(`${this.baseUrl}?${t}`,{loadingMessage:`Loading sale orders...`,showLoading:!0});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching sale orders:`,e),e}}async getSaleOrder(e){try{let t=await i(`${this.baseUrl}/${e}`,{loadingMessage:`Loading sale order...`});return t.data.data}catch(e){throw console.error(`Error fetching sale order:`,e),e}}async createSaleOrder(e){try{let t=await o(this.baseUrl,e,{loadingMessage:`Creating sale order...`,showSuccessNotification:!0,successMessage:`Sale order created successfully`});return t.data.data}catch(e){throw console.error(`Error creating sale order:`,e),e}}async updateSaleOrder(e,t){try{let n=await s(`${this.baseUrl}/${e}`,t,{loadingMessage:`Updating sale order...`,showSuccessNotification:!0,successMessage:`Sale order updated successfully`});return n.data.data}catch(e){throw console.error(`Error updating sale order:`,e),e}}async deleteSaleOrder(e){try{await r(`${this.baseUrl}/${e}`,{loadingMessage:`Deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order deleted successfully`})}catch(e){throw console.error(`Error deleting sale order:`,e),e}}async getTrashedSaleOrders(e){try{let t=this.buildQueryParams(e),n=await i(`${this.baseUrl}/trashed?${t}`,{loadingMessage:`Loading trashed sale orders...`});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching trashed sale orders:`,e),e}}async approveSaleOrder(e,t){try{let n=await a(`${this.baseUrl}/${e}/approve`,t,{loadingMessage:`Approving sale order...`,showSuccessNotification:!0,successMessage:`Sale order approved successfully`});return n.data.data}catch(e){throw console.error(`Error approving sale order:`,e),e}}async restoreSaleOrder(e){try{let t=await a(`${this.baseUrl}/${e}/restore`,{},{loadingMessage:`Restoring sale order...`,showSuccessNotification:!0,successMessage:`Sale order restored successfully`});return t.data.data}catch(e){throw console.error(`Error restoring sale order:`,e),e}}async forceDeleteSaleOrder(e){try{await r(`${this.baseUrl}/${e}/force-delete`,{loadingMessage:`Permanently deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order permanently deleted`})}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}}async getSaleOrderStats(){try{let e=await i(`${this.baseUrl}/stats`,{loadingMessage:`Loading sale order statistics...`});return e.data.data}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}}async searchSaleOrders(e){try{let t=await i(`${this.baseUrl}/search?query=${encodeURIComponent(e)}`,{showLoading:!1});return t.data.data}catch(e){throw console.error(`Error searching sale orders:`,e),e}}async getSaleOrdersByCustomer(e){try{let t=await i(`${this.baseUrl}/by-customer/${e}`,{loadingMessage:`Loading customer sale orders...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by customer:`,e),e}}async getSaleOrdersByCurrency(e){try{let t=await i(`${this.baseUrl}/by-currency/${e}`,{loadingMessage:`Loading sale orders by currency...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by currency:`,e),e}}async getSaleOrdersByWarehouse(e){try{let t=await i(`${this.baseUrl}/by-warehouse/${e}`,{loadingMessage:`Loading sale orders by warehouse...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by warehouse:`,e),e}}async getSaleOrdersByPrefix(e){try{let t=await i(`${this.baseUrl}/by-prefix/${e}`,{loadingMessage:`Loading sale orders by prefix...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by prefix:`,e),e}}async getSaleOrdersByDateRange(e,t){try{let n=await i(`${this.baseUrl}/by-date-range?start_date=${e}&end_date=${t}`,{loadingMessage:`Loading sale orders by date range...`});return n.data.data}catch(e){throw console.error(`Error fetching sale orders by date range:`,e),e}}async getSaleOrdersBySalesperson(e){try{let t=await i(`${this.baseUrl}/by-salesperson/${e}`,{loadingMessage:`Loading sale orders by salesperson...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by salesperson:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const p=new f,m=u(`saleOrders`,()=>{let r=l(),i=c(),a=n([]),o=n(null),s=n([]),u=n(d()),f=n(!1),m=n({per_page:50}),h=e(()=>e=>a.value.filter(t=>t.prefix===e)),g=e(()=>e=>a.value.filter(t=>t.customer_id===e)),ee=e(()=>e=>a.value.filter(t=>t.currency_id===e)),te=e(()=>e=>a.value.filter(t=>t.warehouse_id===e)),_=e(()=>e=>a.value.filter(t=>t.salesperson_id===e)),v=e(()=>e=>a.value.filter(t=>t.status===e)),y=e(()=>a.value.filter(e=>e.status===`Waiting`)),b=e(()=>a.value.filter(e=>e.status===`Shipped`)),x=e(()=>a.value.filter(e=>e.status===`Delivered`)),S=e(()=>a.value.reduce((e,t)=>e+t.total,0)),C=e(()=>a.value.reduce((e,t)=>e+t.total_usd,0)),w=e(()=>a.value.reduce((e,t)=>e+t.total_profit,0)),T=e(()=>(e,t)=>a.value.filter(n=>{let r=new Date(n.date),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),E=e(()=>({total:a.value.length,waiting:y.value.length,shipped:b.value.length,delivered:x.value.length,totalAmount:S.value,totalAmountUSD:C.value,totalProfit:w.value,byPrefix:{INX:h.value(`INX`).length,INV:h.value(`INV`).length}})),D=e(()=>{let e={};return Object.entries(i.query).forEach(([t,n])=>{n&&typeof n==`string`&&(e[t]=n)}),e}),O=async e=>{try{f.value=!0,e&&(m.value={...m.value,...e});let t=await p.getSaleOrders(m.value);a.value=t.data,u.value=t.pagination}catch(e){throw console.error(`Error fetching sale orders:`,e),e}finally{f.value=!1}},k=async e=>{try{let t=await p.getSaleOrder(e);return o.value=t,t}catch(e){throw console.error(`Error fetching sale order:`,e),e}},A=async e=>{try{let t=await p.createSaleOrder(e);return a.value.unshift(t),u.value.total+=1,t}catch(e){throw console.error(`Error creating sale order:`,e),e}},j=async(e,t)=>{try{let n=await p.updateSaleOrder(e,t),r=a.value.findIndex(t=>t.id===e);return r!==-1&&(a.value[r]=n),o.value?.id===e&&(o.value=n),n}catch(e){throw console.error(`Error updating sale order:`,e),e}},M=async e=>{try{await p.deleteSaleOrder(e);let t=a.value.findIndex(t=>t.id===e);t!==-1&&a.value.splice(t,1),--u.value.total,o.value?.id===e&&(o.value=null)}catch(e){throw console.error(`Error deleting sale order:`,e),e}},N=async e=>{try{f.value=!0;let t=e||{},n=await p.getTrashedSaleOrders(t);s.value=n.data}catch(e){throw console.error(`Error fetching trashed orders:`,e),e}finally{f.value=!1}},P=async e=>{try{let t=await p.restoreSaleOrder(e),n=s.value.findIndex(t=>t.id===e);return n!==-1&&s.value.splice(n,1),a.value.unshift(t),u.value.total+=1,t}catch(e){throw console.error(`Error restoring sale order:`,e),e}},F=async e=>{try{await p.forceDeleteSaleOrder(e);let t=s.value.findIndex(t=>t.id===e);t!==-1&&s.value.splice(t,1)}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}},I=async(e,t)=>{try{let n=await p.approveSaleOrder(e,t),r=a.value.findIndex(t=>t.id===e);return r!==-1&&a.value.splice(r,1),--u.value.total,o.value?.id===e&&(o.value=null),n}catch(e){throw console.error(`Error approving sale order:`,e),e}},L=async e=>{try{return await p.searchSaleOrders(e)}catch(e){throw console.error(`Error searching sale orders:`,e),e}},R=async e=>{try{return await p.getSaleOrdersByCustomer(e)}catch(e){throw console.error(`Error fetching orders by customer:`,e),e}},z=async e=>{try{return await p.getSaleOrdersByCurrency(e)}catch(e){throw console.error(`Error fetching orders by currency:`,e),e}},ne=async e=>{try{return await p.getSaleOrdersByWarehouse(e)}catch(e){throw console.error(`Error fetching orders by warehouse:`,e),e}},B=async e=>{try{return await p.getSaleOrdersByPrefix(e)}catch(e){throw console.error(`Error fetching orders by prefix:`,e),e}},V=async e=>{try{return await p.getSaleOrdersBySalesperson(e)}catch(e){throw console.error(`Error fetching orders by salesperson:`,e),e}},H=async(e,t)=>{try{return await p.getSaleOrdersByDateRange(e,t)}catch(e){throw console.error(`Error fetching orders by date range:`,e),e}},U=async()=>{try{return await p.getSaleOrderStats()}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}},W=e=>{m.value={...m.value,...e}},G=()=>{m.value={per_page:50}},K=()=>{o.value=null},q=e=>{let t={...m.value,search:e,page:1};m.value=t,Z(t),$(t,!1)},J=(e,t)=>{let n={...m.value,sort_by:e,sort_direction:t,page:1};m.value=n,Z(n),$(n,!1)},Y=e=>{let t={...m.value,page:e};m.value=t,Z(t),$(t,!1)},X=e=>{let t={...m.value,per_page:e,page:1};m.value=t,Z(t),$(t,!1)},Z=(e,t=!1)=>{let n={...i.query};Object.entries(e).forEach(([e,t])=>{t!=null&&t!==``?n[e]=String(t):delete n[e]});let a=t?`replace`:`push`;r[a]({query:n})},re=()=>{r.replace({query:{}})},Q=()=>{let e={per_page:50};m.value={...e,...D.value}},$=async(e,t=!0)=>{t&&e&&Z(e),await O(e)},ie=()=>{a.value=[],o.value=null,s.value=[],u.value=d(),m.value={per_page:50},f.value=!1};return t(()=>i.query,async()=>{if(Q(),i.name&&i.name.toString().includes(`sale-order`))try{await O(m.value)}catch(e){console.error(`Error fetching sale orders on URL change:`,e)}},{immediate:!1,deep:!0}),{saleOrders:a,currentSaleOrder:o,trashedOrders:s,pagination:u,loading:f,filters:m,ordersByPrefix:h,ordersByCustomer:g,ordersByCurrency:ee,ordersByWarehouse:te,ordersBySalesperson:_,ordersByStatus:v,waitingOrders:y,shippedOrders:b,deliveredOrders:x,totalOrderAmount:S,totalOrderAmountUSD:C,totalOrderProfit:w,ordersByDateRange:T,orderStats:E,urlParams:D,fetchSaleOrders:O,fetchSaleOrder:k,createSaleOrder:A,updateSaleOrder:j,deleteSaleOrder:M,fetchTrashedOrders:N,restoreOrder:P,forceDeleteOrder:F,approveOrder:I,searchOrders:L,getOrdersByCustomer:R,getOrdersByCurrency:z,getOrdersByWarehouse:ne,getOrdersByPrefix:B,getOrdersBySalesperson:V,getOrdersByDateRange:H,getOrderStats:U,updateFilters:W,clearFilters:G,clearCurrentOrder:K,setSearch:q,setSort:J,setPage:Y,setPerPage:X,updateUrlParams:Z,clearUrlParams:re,syncFiltersWithUrl:Q,fetchData:$,reset:ie}});export{m as b};