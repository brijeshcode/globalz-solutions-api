import{M as e,Y as t,a$ as n,aC as ee,aI as r,aM as te,aN as i,aP as a,aQ as o,aS as s,aT as c,aV as l,aW as u,aX as d,aZ as ne,aj as re,ax as ie,b0 as f,b2 as ae,b7 as p,b9 as m,ba as h,bb as g,bd as _,d as oe,h as se}from"./index-B7MxqLx6.js";import{b as ce}from"./GlobalConfig-wPgXFcZ5.js";import"./tableUtils-ylneqlK-.js";import{f as v}from"./common-qdv5PS_C.js";import"./currencyUtil-RxbIuVsu.js";import{b as le}from"./salaryStore-BTlc9ju-.js";import{b as ue,c as de,d as fe}from"./EmployeeDailyBusinessBreadDown-De_LL46T.js";const pe={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},me={class:`mx-auto`},he={class:`mb-8`},ge={class:`flex items-center space-x-4 mb-2`},_e={class:`grid grid-cols-12 gap-4`},y={class:`col-span-4`},b={class:`flex items-center gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-4`},x=[`value`],S=[`value`],C={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},w={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},T={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},E={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},D={class:`px-3 py-2 text-center border border-gray-300 dark:border-gray-600`},O=[`onClick`],k={key:0},A={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},j={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},M={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},N={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},P={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},F={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},I={class:`px-3 py-2 text-center border border-gray-300 dark:border-gray-600`},ve=[`onClick`],ye={class:`col col-span-8`},be={key:0,class:`text-lg`},xe={key:1},Se={class:`flex items-center justify-between gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md`},Ce={class:`flex gap-3`},we={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},Te={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},Ee={key:2},De={key:3,class:`bg-white mt-4 dark:bg-gray-800 shadow rounded-lg`},Oe={class:`p-6`},ke={class:`mb-4 text-sm text-gray-700 dark:text-gray-300`},Ae={class:`mb-1`},je={class:`w-full border-collapse mb-4`},Me={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ne={class:`px-3 py-2 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100`},Pe={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Fe={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ie={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Le={class:`bg-gray-100 dark:bg-gray-700`},Re={class:`px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`},ze={class:`px-3 py-2 rounded-md bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 font-semibold text-gray-900 dark:text-gray-100`},Be={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ve=[`disabled`],He=[`value`],Ue={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},We={class:`flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700`},Ge=[`disabled`],Ke=[`disabled`],qe={key:0,class:`flex items-center justify-center`},Je={key:1};var L=d({__name:`CreatePage`,setup(d){let L=m(null),R=ee(),z=le(),B=oe(),{showSuccess:Ye,showError:Xe}=ie(),V=m(!1),H=m(!1),U=m({}),W=new Date,Ze=W.getMonth()+1,G=W.getFullYear(),K=m(Ze),q=m(G),J=m({date:new Date().toISOString().split(`T`)[0],employee_id:0,account_id:0,month:new Date().getMonth()+1,year:new Date().getFullYear(),sub_total:0,advance_payment:0,others:0,final_total:0,others_note:``,note:``}),Y=[{value:1,label:`January`},{value:2,label:`February`},{value:3,label:`March`},{value:4,label:`April`},{value:5,label:`May`},{value:6,label:`June`},{value:7,label:`July`},{value:8,label:`August`},{value:9,label:`September`},{value:10,label:`October`},{value:11,label:`November`},{value:12,label:`December`}],Qe=a(()=>{let e=[];for(let t=ce.commissionStartYear;t<=G;t++)e.push(t);return e.reverse()});a(()=>{let e=new Date().getFullYear(),t=[];for(let n=e-5;n<=e+1;n++)t.push(n);return t.reverse()});let $e=a(()=>B.employees),et=a(()=>B.accounts||[]),tt=a(()=>z.salaries),nt=a(()=>z.pendingLoan),rt=a(()=>Object.keys(U.value).length>0),it=a(()=>J.value.date&&J.value.employee_id>0&&J.value.account_id>0&&J.value.month>0&&J.value.year>0&&J.value.sub_total>=0&&J.value.advance_payment>=0&&J.value.others!==void 0);a(()=>J.value.month>0&&J.value.month<=12?Y[J.value.month-1]:``);let X=e=>{U.value[e]&&delete U.value[e]},at=e=>{U.value={};for(let[t,n]of Object.entries(e))n&&n.length>0&&(U.value[t]=n[0])},Z=()=>{U.value={}},Q=()=>{let e=Number(J.value.sub_total)||0,t=Number(J.value.advance_payment)||0,n=Number(J.value.others)||0;J.value.final_total=e-t+n},ot=()=>{J.value={date:new Date().toISOString().split(`T`)[0],employee_id:0,account_id:0,month:new Date().getMonth()+1,year:new Date().getFullYear(),sub_total:0,advance_payment:0,others:0,final_total:0,others_note:``,note:``},Z()},st=()=>{Z();let e={};return J.value.date||(e.date=`Date is required`),(!J.value.employee_id||J.value.employee_id<=0)&&(e.employee_id=`Employee is required`),(!J.value.account_id||J.value.account_id<=0)&&(e.account_id=`Account is required`),(!J.value.month||J.value.month<1||J.value.month>12)&&(e.month=`Valid month is required`),(!J.value.year||J.value.year<2e3||J.value.year>2100)&&(e.year=`Valid year is required`),(J.value.sub_total===void 0||J.value.sub_total<0)&&(e.sub_total=`Sub total must be 0 or greater`),(J.value.advance_payment===void 0||J.value.advance_payment<0)&&(e.advance_payment=`Advance payment must be 0 or greater`),J.value.others===void 0&&(e.others=`Others amount is required`),J.value.others_note&&J.value.others_note.length>500&&(e.others_note=`Others note cannot exceed 500 characters`),J.value.note&&J.value.note.length>1e3&&(e.note=`Notes cannot exceed 1000 characters`),U.value=e,Object.keys(e).length===0},ct=async()=>{if(st())try{V.value=!0,await z.createSalary(J.value),ot(),Ye(`Salary created successfully`),R.push({name:`employees.salaries.index`})}catch(e){e.response?.status===422&&e.response?.data?.errors?at(e.response.data.errors):Xe(e.response?.data?.message||`Failed to create salary`)}finally{V.value=!1}},lt=()=>{R.push({name:`employees.salaries.index`})},ut=()=>{R.go(-1)},$=async e=>{try{H.value=!0;let t=await fe.getMonthlyCommission({employee_id:e,month:K.value,year:q.value});L.value=t,await z.fetchPendingLoan(e),await dt(e),J.value.employee_id=e,J.value.month=K.value,J.value.year=q.value,J.value.sub_total=L.value.total_commission,J.value.advance_payment=nt?.value||0,Q()}catch(e){console.error(`Error fetching commission data:`,e)}finally{H.value=!1}},dt=async e=>{await z.fetchSalaries({employee_id:e})},ft=async()=>{try{B.employees.length===0&&await B.fetchListData(`employees`)}catch(e){console.error(`Failed to load employees:`,e)}},pt=async()=>{try{B.accounts.length===0&&await B.fetchListData(`accounts`)}catch(e){console.error(`Failed to load accounts:`,e)}};return ne(async()=>{await Promise.all([ft(),pt()])}),(ee,a)=>{let d=ae(`Input`);return n(),c(`div`,pe,[o(`div`,me,[o(`div`,he,[o(`div`,ge,[o(`button`,{onClick:ut,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[u(h(re),{class:`w-5 h-5`})]),a[8]||=o(`div`,null,[o(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Create Employee Salary `),o(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Add a new salary record for an employee `)],-1)])]),o(`div`,_e,[o(`div`,y,[o(`div`,b,[o(`div`,null,[a[9]||=o(`label`,{class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},`Month`,-1),p(o(`select`,{"onUpdate:modelValue":a[0]||=e=>K.value=e,class:`px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500`},[(n(),c(i,null,f(Y,e=>o(`option`,{key:e.value,value:e.value},_(e.label),9,x)),64))],512),[[r,K.value]])]),o(`div`,null,[a[10]||=o(`label`,{class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},`Year`,-1),p(o(`select`,{"onUpdate:modelValue":a[1]||=e=>q.value=e,class:`px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500`},[(n(!0),c(i,null,f(Qe.value,e=>(n(),c(`option`,{key:e,value:e},_(e),9,S))),128))],512),[[r,q.value]])])]),a[14]||=o(`div`,{class:`mb-3 text-lg font-semibold text-gray-900 dark:text-gray-100`},`Employees`,-1),o(`table`,C,[a[11]||=o(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[o(`tr`,null,[o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`#`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Employee`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Department`),o(`th`,{class:`px-3 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Action`)])],-1),o(`tbody`,null,[(n(!0),c(i,null,f($e.value,(e,t)=>(n(),c(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[o(`td`,w,_(t+1),1),o(`td`,T,_(e.name),1),o(`td`,E,_(e.department?.name),1),o(`td`,D,[o(`button`,{onClick:t=>$(e.id),class:`text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200`,title:`View details`},[u(h(se),{class:`w-4 h-4`})],8,O)])]))),128))])]),L.value&&!H.value?(n(),c(`div`,k,[a[13]||=o(`div`,{class:`mb-3 text-lg py-4 mt-6 border-gray-400 border-t-2 font-semibold text-gray-900 dark:text-gray-100`},`Salary History`,-1),o(`table`,A,[a[12]||=o(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[o(`tr`,null,[o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Month`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Comm.`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Adv.`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Others`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Total`),o(`th`,{class:`px-3 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Act.`)])],-1),o(`tbody`,null,[(n(!0),c(i,null,f(tt.value,(e,ee)=>(n(),c(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[o(`td`,j,_(e.month)+` / `+_(e.year),1),o(`td`,M,_(e.sub_total),1),o(`td`,N,_(e.advance_payment),1),o(`td`,P,_(e.others),1),o(`td`,F,_(e.final_total),1),o(`td`,I,[o(`button`,{onClick:t=>$(e.id),class:`text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200`,title:`View details`},[u(h(t),{class:`w-4 h-4`})],8,ve)])]))),128))])])])):s(``,!0)]),o(`div`,ye,[H.value?(n(),c(`div`,be,[u(h(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`})])):s(``,!0),L.value&&!H.value?(n(),c(`div`,xe,[o(`div`,Se,[o(`div`,null,` Employee: `+_(L.value?.business_summary.employee_name),1),o(`div`,Ce,[o(`div`,null,[o(`label`,we,`Month: `+_(K.value),1)]),o(`div`,null,[o(`label`,Te,`Year : `+_(q.value),1)])])])])):s(``,!0),L.value&&!H.value?(n(),c(`div`,Ee,[o(`div`,null,[u(ue,{class:`mt-4`,"commission-data":L.value},null,8,[`commission-data`]),u(de,{class:`mt-4`,"commission-data":L.value},null,8,[`commission-data`])])])):s(``,!0),L.value&&!H.value?(n(),c(`div`,De,[o(`div`,Oe,[a[24]||=o(`h2`,{class:`text-xl font-semibold mb-4 pb-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white`},`Employee Salary Summary`,-1),o(`div`,ke,[o(`div`,Ae,[a[15]||=o(`strong`,null,`Employee:`,-1),l(` `+_(L.value.business_summary.employee_name),1)]),o(`div`,null,[a[16]||=o(`strong`,null,`Period:`,-1),l(` Month `+_(J.value.month)+` / Year `+_(J.value.year),1)])]),o(`form`,{onSubmit:te(ct,[`prevent`])},[o(`table`,je,[o(`tr`,null,[a[17]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},`Sub Total (total commission)`,-1),o(`td`,Me,[o(`div`,Ne,_(h(v)(L.value?.total_commission)),1)])]),o(`tr`,null,[a[18]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Advance Loan (-)`,-1),o(`td`,Pe,[u(d,{type:`number`,onInput:Q,class:`w-full`,modelValue:J.value.advance_payment,"onUpdate:modelValue":a[2]||=e=>J.value.advance_payment=e},null,8,[`modelValue`])])]),o(`tr`,null,[o(`th`,{class:g([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,J.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},`Other (bonus or deduction)`,2),o(`td`,Fe,[u(d,{type:`number`,onInput:Q,class:g([J.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:J.value.others,"onUpdate:modelValue":a[3]||=e=>J.value.others=e},null,8,[`class`,`modelValue`])])]),o(`tr`,null,[o(`th`,{class:g([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,J.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},`Other Notes`,2),o(`td`,Ie,[u(d,{type:`text`,class:g([J.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:J.value.others_note,"onUpdate:modelValue":a[4]||=e=>J.value.others_note=e,placeholder:`Other note`},null,8,[`class`,`modelValue`])])]),o(`tr`,Le,[a[19]||=o(`th`,{class:`px-3 py-2 text-left font-bold text-base bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},`Net Total`,-1),o(`td`,Re,[o(`div`,ze,_(h(v)(J.value.final_total)),1)])]),o(`tr`,null,[a[21]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Account`,-1),o(`td`,Be,[p(o(`select`,{id:`account_id`,"onUpdate:modelValue":a[5]||=e=>J.value.account_id=e,disabled:V.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onBlur:a[6]||=()=>X(`account_id`),required:``},[a[20]||=o(`option`,{value:``},`Select account`,-1),(n(!0),c(i,null,f(et.value,e=>(n(),c(`option`,{key:e.id,value:e.id},_(e.name),9,He))),128))],40,Ve),[[r,J.value.account_id]])])]),o(`tr`,null,[a[22]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},`Salary Note`,-1),o(`td`,Ue,[u(d,{type:`text`,class:`w-full`,modelValue:J.value.note,"onUpdate:modelValue":a[7]||=e=>J.value.note=e,placeholder:`Add any notes`},null,8,[`modelValue`])])])]),o(`div`,We,[o(`button`,{type:`button`,onClick:lt,disabled:V.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},` Cancel `,8,Ge),o(`button`,{type:`submit`,disabled:V.value||rt.value||!it.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},[V.value?(n(),c(`div`,qe,a[23]||=[o(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),l(` Creating... `,-1)])):(n(),c(`span`,Je,`Create Salary`))],8,Ke)])],32)])])):s(``,!0)])])])])}}}),R=L;export{R as default};