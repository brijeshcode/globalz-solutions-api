import{E as e,a6 as t,aA as n,aB as r,aD as i,aE as a,aF as o,aG as s,aH as c,aI as l,aK as u,aM as d,aN as f,aW as p,aX as m,a_ as h,ai as g,am as _,an as v,ay as y,v as b}from"./index-7--PgFgh.js";import"./GlobalConfig-Dep5CV3r.js";import"./tableUtils-jdfVzp2e.js";import{b as x}from"./companyStore-CloSjscQ.js";import{b as S}from"./currencyUtil-5HU7ExxM.js";import{b as C}from"./salesStore-BP4UKXK9.js";const w={class:`max-w-4xl mx-auto p-8 bg-white text-gray-900 print:h-full print:p-0 print:max-w-none print:mx-0`},T={class:`header`},E={class:`flex justify-between items-start mb-10 pb-6 border-b-2 border-blue-600 print:border-black print:mb-6`},D={key:0,class:`flex-1`},ee={class:`flex items-center mb-3`},te=[`src`,`alt`],ne={key:1,class:`text-3xl font-bold text-blue-600 print:text-black print:text-2xl`},re={key:0},O={class:`print:text-black`},k={class:`text-right flex-1 mt-4`},A={class:`text-lg font-semibold text-gray-600 print:text-black print:text-base`},j={class:`grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 print:grid-cols-2 print:gap-6 print:mb-6`},M={class:`space-y-1 print:space-y-0`},N={class:`flex justify-between print:justify-between`},P={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},F={class:`flex justify-between print:justify-between`},I={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},L={key:0,class:`flex justify-between print:justify-between`},R={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},z={key:1,class:`flex justify-between print:justify-between`},B={class:`text-gray-900 font-semibold print:font-normal print:text-black print:text-xs`},V={key:2,class:`flex justify-between print:justify-between`},H={class:`text-red-600 font-bold print:font-normal print:text-black print:text-xs`},U={class:`space-y-1 print:space-y-0`},W={class:`flex justify-between print:justify-between`},G={class:`text-gray-900 print:text-black print:text-xs`},K={class:`flex justify-between print:justify-between`},q={class:`text-gray-900 print:text-black print:text-xs`},J={class:`flex justify-between print:justify-between`},Y={class:`text-gray-900 print:text-black print:text-xs`},X={key:0,class:`flex justify-between print:justify-between`},ie={class:`text-gray-900 print:text-black print:text-xs`},ae={class:`body`},oe={class:`mb-8 print:mb-4`},se={class:`overflow-x-auto print:overflow-visible`},ce={class:`w-full border-collapse border border-gray-300 print:border-black`},le={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},ue={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-black print:text-xs`},de={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-black print:text-xs`},fe={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},pe={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},me={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},he={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-black print:text-xs`},ge={class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-semibold print:border-black print:text-black print:text-xs`},_e={class:`border-t-2 border-gray-400 print:border-t-2 print:border-black`},ve={colspan:`4`},ye={class:`flex gap-4 text-sm`},be={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},xe={colspan:`6`,class:`print:border-black text-center relative`},Se={class:`py-0 flex gap-4 text-sm`},Ce=[`src`,`alt`],we={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Te={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Ee={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},De={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},Oe={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-semibold print:border-black print:text-black print:text-xs`},ke={class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-bold text-lg print:border-black print:text-black print:text-xs`},Ae={class:`mt-14`},je={class:`text-sm text-gray-600 print:text-xs print:text-black m-auto text-center top-4 w-full print:mb-2`},Me={class:`footer print:block hidden print:fixed print:bottom-0 print:left-0 print:right-0`},Ne={class:`border-t-2 border-gray-300 print:border-black pt-4 pb-2`},Pe={key:0,class:`mt-2 print:mt-1`},Fe={class:`flex flex-wrap gap-2 text-sm text-gray-600 print:text-black print:text-xs justify-between`},Ie={key:0,class:`flex-1`},Le={key:1,class:`flex-1 text-center`},Re={key:2,class:`flex-1 text-center`},ze={key:3,class:`flex-1 text-right`};var Z=l({__name:`SaleInvoice`,props:{saleData:{},customers:{default:()=>[]},warehouses:{default:()=>[]},currencies:{default:()=>[]},salespersons:{default:()=>[]},items:{default:()=>[]}},setup(e,{expose:t}){let c=e,l=x();u(async()=>{try{l.company.name||await l.fetchCompany()}catch(e){console.error(`Failed to fetch company data:`,e)}});let p=n(()=>{let e=c.saleData.items?.length||0,t=20;return e>=t?0:t-e}),g=e=>e?parseFloat(Number(e).toFixed(2)).toString():`0`,_=()=>c.saleData.prefix===`INV`,v=e=>e?Number(e).toLocaleString(`en-US`,{minimumFractionDigits:2,maximumFractionDigits:2}):`0.00`,b=e=>{if(!e)return`-`;let t=new Date(e);return t.toLocaleDateString(`en-US`,{year:`numeric`,month:`long`,day:`numeric`})},C=n(()=>!c.saleData.items||c.saleData.items.length===0?0:c.saleData.items.reduce((e,t)=>e+(Number(t.total_weight_kg)||0),0)),Z=n(()=>!c.saleData.items||c.saleData.items.length===0?0:c.saleData.items.reduce((e,t)=>e+(Number(t.total_volume_cbm)||0),0)),Q=()=>{window.print()};return t({printInvoice:Q}),(e,t)=>(d(),a(`div`,w,[r(`section`,T,[r(`div`,E,[_()?(d(),a(`div`,D,[r(`div`,ee,[m(l).company.logo?.preview_url?(d(),a(`img`,{key:0,src:m(l).company.logo.preview_url,alt:m(l).company.name||`Company Logo`,class:`h-24 w-auto mr-4 print:h-12`},null,8,te)):i(``,!0),m(l).company.logo?.preview_url?i(``,!0):(d(),a(`div`,ne,h(m(l).company.name),1))]),m(l).company.tax_number?(d(),a(`div`,re,[r(`p`,O,[r(`b`,null,`Tax Registration #: `+h(m(l).company.tax_number),1)])])):i(``,!0)])):i(``,!0),r(`div`,k,[t[0]||=r(`h1`,{class:`text-2xl font-bold text-blue-600 mb-2 print:text-black print:text-xl`},`SALES INVOICE`,-1),r(`div`,A,h(e.saleData.prefix)+`-`+h(e.saleData.code),1)])]),r(`div`,j,[r(`div`,null,[t[6]||=r(`h3`,{class:`text-lg font-bold text-blue-600 mb-3 print:text-sm border-b border-gray-200 print:text-black print:border-black`},`Customer Information`,-1),r(`div`,M,[r(`div`,N,[t[1]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Customer:`,-1),r(`span`,P,h(e.saleData.customer?.code)+`, `+h(e.saleData.customer?.name||`Unknown Customer`),1)]),r(`div`,F,[t[2]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Address:`,-1),r(`span`,I,h(e.saleData.customer?.address)+`, `+h(e.saleData.customer?.city),1)]),e.saleData.customer?.mobile?(d(),a(`div`,L,[t[3]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Phone:`,-1),r(`span`,R,h(e.saleData.customer?.mobile),1)])):i(``,!0),e.saleData.customer?.mof_tax_number?(d(),a(`div`,z,[t[4]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Tax #:`,-1),r(`span`,B,h(e.saleData.customer?.mof_tax_number),1)])):i(``,!0),e.saleData.outStanding_balance&&Number(e.saleData.outStanding_balance)>0?(d(),a(`div`,V,[t[5]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Outstanding Balance:`,-1),r(`span`,H,h(v(e.saleData.outStanding_balance)),1)])):i(``,!0)])]),r(`div`,null,[t[11]||=r(`h3`,{class:`text-lg font-bold text-blue-600 mb-3 print:text-sm border-b border-gray-200 print:text-black print:border-black`},`Invoice Details`,-1),r(`div`,U,[r(`div`,W,[t[7]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Date:`,-1),r(`span`,G,h(b(e.saleData.date)),1)]),r(`div`,K,[t[8]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Value Date:`,-1),r(`span`,q,h(b(e.saleData.value_date)),1)]),r(`div`,J,[t[9]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Currency:`,-1),r(`span`,Y,h(e.saleData.currency?.code||`N/A`),1)]),e.saleData.salesperson?(d(),a(`div`,X,[t[10]||=r(`span`,{class:`font-semibold text-gray-700 print:text-black`},`Salesperson:`,-1),r(`span`,ie,h(e.saleData.salesperson?.name||`Not assigned`),1)])):i(``,!0)])])])]),r(`section`,ae,[r(`div`,oe,[r(`div`,se,[r(`table`,ce,[t[23]||=r(`thead`,null,[r(`tr`,{class:`bg-gray-100 print:bg-gray-200`},[r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`#`),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-left font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Item Code`),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-left font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Description`),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Price`),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},[r(`abbr`,{title:`Discount Percentage`},`Dis. %`)]),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},[r(`abbr`,{title:`Total Quantity`},`QTY`)]),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center font-bold text-gray-700 print:border-black print:text-black print:text-xs`},[r(`abbr`,{title:`Tax Percentage`},`Tax`)]),r(`th`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 text-right font-bold text-gray-700 print:border-black print:text-black print:text-xs`},`Total`)])],-1),r(`tbody`,null,[(d(!0),a(y,null,f(e.saleData.items,(e,t)=>(d(),a(`tr`,{key:t,class:`even:bg-gray-50 print:even:bg-gray-100`},[r(`td`,le,h(t+1),1),r(`td`,ue,h(e.item_code||``),1),r(`td`,de,h(e.item?.description||`Unknown Item`),1),r(`td`,fe,h(v(e.price)),1),r(`td`,pe,h(g(e.discount_percent))+`%`,1),r(`td`,me,h(g(e.quantity)),1),r(`td`,he,h(e.tax_label),1),r(`td`,ge,h(v(e.total_price-e.tax_amount*e.quantity)),1)]))),128)),(d(!0),a(y,null,f(p.value,e=>(d(),a(`tr`,{key:`empty-`+e,class:`even:bg-gray-50 print:even:bg-gray-100`},t[12]||=[r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1),r(`td`,{class:`border-r border-gray-300 px-3 py-1 print:px-1 print:py-0 text-center print:border-black print:text-xs`},`\xA0`,-1)]))),128)),r(`tr`,_e,[r(`td`,ve,[r(`div`,ye,[t[13]||=r(`div`,null,`Volume CBM`,-1),r(`div`,null,h(g(Z.value)),1)])]),t[14]||=r(`td`,{colspan:`2`,class:`print:border-black`},null,-1),t[15]||=r(`td`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},`Sub Total`,-1),r(`td`,be,h(v(e.saleData.sub_total-e.saleData.total_tax_amount)),1)]),r(`tr`,null,[r(`td`,xe,[r(`div`,Se,[t[16]||=r(`div`,null,`Weight KG`,-1),r(`div`,null,h(g(C.value)),1)]),m(l).company.stamp?.preview_url&&_()?(d(),a(`img`,{key:0,src:m(l).company.stamp.preview_url,alt:m(l).company.name||`Company Stamp`,class:`h-16 w-auto mr-4 print:h-10 absolute left-1/4 -bottom-1/4`},null,8,Ce)):i(``,!0)]),t[17]||=r(`td`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},`Add. Discount`,-1),r(`td`,we,h(v(e.saleData.discount_amount)),1)]),r(`tr`,null,[t[18]||=r(`td`,{colspan:`3`,class:`print:border-black`},null,-1),t[19]||=r(`td`,{colspan:`2`,class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},[r(`span`,null,`TVA 11% in LL`)],-1),r(`td`,Te,h(v(m(S)(e.saleData.total_tax_amount_usd,e.saleData.local_curreny_rate,`divide`))),1),r(`td`,Ee,h(e.saleData.invoice_tax_label),1),r(`td`,De,h(v(e.saleData.total_tax_amount)),1)]),r(`tr`,null,[t[20]||=r(`td`,{colspan:`3`,class:`print:border-black`},null,-1),t[21]||=r(`td`,{colspan:`2`,class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},[r(`span`,null,`Net Total LL`)],-1),r(`td`,Oe,[r(`span`,null,h(v(m(S)(e.saleData.total_usd,e.saleData.local_curreny_rate,`divide`))),1)]),t[22]||=r(`td`,{class:`border border-gray-300 px-3 py-1 print:px-1 print:py-0 font-bold print:border-black print:text-black print:text-xs`},`Net Total`,-1),r(`td`,ke,h(v(e.saleData.total)),1)])])])])]),t[26]||=o(`<div class="flex justify-between items-center mb-6 print:mb-3 mt-8 print:mt-6"><div class="flex-1 text-center"><p class="font-semibold text-gray-700 print:text-black print:text-xs">Received By</p><div class="border-b border-gray-400 print:border-black mt-8 print:mt-4"></div></div><div class="flex-1 text-center ml-8"><p class="font-semibold text-gray-700 print:text-black print:text-xs">Signature</p><div class="border-b border-gray-400 print:border-black mt-8 print:mt-4"></div></div></div>`,1),r(`div`,Ae,[r(`div`,je,[s(h(e.saleData.invoice_nb1)+` `,1),t[24]||=r(`br`,null,null,-1),t[25]||=r(`br`,null,null,-1),s(` `+h(e.saleData.invoice_nb2),1)])])]),r(`section`,Me,[r(`div`,Ne,[_()?(d(),a(`div`,Pe,[r(`div`,Fe,[m(l).company.address?(d(),a(`p`,Ie,h(m(l).company.address),1)):i(``,!0),m(l).company.phone?(d(),a(`p`,Le,h(m(l).company.phone),1)):i(``,!0),m(l).company.email?(d(),a(`p`,Re,h(m(l).company.email),1)):i(``,!0),m(l).company.website?(d(),a(`p`,ze,h(m(l).company.website),1)):i(``,!0)])])):i(``,!0)])])]))}}),Q=Z;const Be={class:`min-h-screen bg-gray-50 print:bg-white`},Ve={class:`bg-white shadow-sm border-b print:hidden`},He={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8`},Ue={class:`flex items-center justify-between h-16`},We={class:`flex items-center space-x-4`},$={class:`text-sm text-gray-500`},Ge={class:`flex items-center space-x-3`},Ke={key:0,class:`flex items-center justify-center min-h-screen`},qe={class:`text-center`},Je={key:1,class:`py-8 print:py-0`},Ye={class:`max-w-6xl mx-auto print:max-w-none`};var Xe=l({__name:`InvoicePreviewPage`,setup(n){let i=v(),o=_(),l=g(),f=C(),y=parseInt(o.params.id),x=p(!0),S=p({}),w=p(null),T=()=>{let e=o.query.from===`view`;e?i.push({name:`sales.show`,params:{id:y.toString()}}):i.push({name:`sales.index`})},E=async()=>{if(w.value)try{await w.value.printInvoice()}catch(e){console.error(`Failed to print invoice:`,e),l.error(`Failed to print invoice`)}},D=async()=>{try{S.value=await f.fetchSale(y)}catch(e){console.error(`Error loading sale:`,e),l.error(`Failed to load sale details`),i.push({name:`sales.index`})}};return u(async()=>{try{x.value=!0,await Promise.all([D()])}catch(e){console.error(`Error initializing invoice preview:`,e)}finally{x.value=!1}}),(n,i)=>(d(),a(`div`,Be,[r(`div`,Ve,[r(`div`,He,[r(`div`,Ue,[r(`div`,We,[r(`button`,{onClick:T,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100 transition-colors`},[c(m(t),{class:`w-5 h-5`})]),r(`div`,null,[i[0]||=r(`h1`,{class:`text-lg font-semibold text-gray-900`},`Invoice Preview`,-1),r(`p`,$,h(S.value.prefix)+`-`+h(S.value.code),1)])]),r(`div`,Ge,[r(`button`,{onClick:E,class:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`},[c(m(b),{class:`w-4 h-4 mr-2`}),i[1]||=s(` Print Invoice `,-1)])])])])]),x.value?(d(),a(`div`,Ke,[r(`div`,qe,[c(m(e),{class:`w-8 h-8 animate-spin mx-auto text-blue-600`}),i[2]||=r(`p`,{class:`mt-2 text-gray-600`},`Loading invoice...`,-1)])])):(d(),a(`div`,Je,[r(`div`,Ye,[c(Q,{ref_key:`saleInvoiceRef`,ref:w,"sale-data":S.value},null,8,[`sale-data`])])]))]))}}),Ze=Xe;export{Ze as default};