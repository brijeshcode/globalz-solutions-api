import{Q as e,a$ as t,a1 as n,aC as r,aH as i,aN as a,aR as ee,aS as o,aU as s,aV as c,aX as l,aY as u,a_ as d,ao as te,b0 as ne,b3 as re,b5 as f,b6 as p,b8 as ie,bd as m,bf as h,bg as g,bh as _,bj as v,d as ae,i as oe}from"./index-Dij-yAxd.js";import{b as se}from"./GlobalConfig-wPgXFcZ5.js";import{f as y}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import"./currencyUtil-tD8MCbKo.js";import{b as ce}from"./salaryStore-BJb6Yxtr.js";import{b as le,c as ue,d as de}from"./EmployeeDailyBusinessBreadDown-BGh7Ec75.js";const fe={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},pe={class:`mx-auto`},me={class:`mb-8`},he={class:`flex items-center space-x-4 mb-2`},ge={class:`grid grid-cols-12 gap-4`},_e={class:`col-span-4`},ve={class:`flex items-center gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-4`},b=[`value`],x=[`value`],S={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},C={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},w={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},T={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},E={class:`px-3 py-2 text-center border border-gray-300 dark:border-gray-600`},D=[`onClick`],O={key:0},k={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},A={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},j={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},M={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},N={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},P={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},F={class:`px-3 py-2 text-center border border-gray-300 dark:border-gray-600`},ye=[`onClick`],be={class:`col col-span-8`},xe={key:0,class:`text-lg`},Se={key:1},Ce={class:`flex items-center justify-between gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md`},we={class:`flex gap-3`},Te={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},Ee={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},De={key:2},Oe={key:3,class:`bg-white mt-4 dark:bg-gray-800 shadow rounded-lg`},ke={class:`p-6`},Ae={class:`mb-4 text-sm text-gray-700 dark:text-gray-300`},je={class:`mb-1`},Me={class:`w-full border-collapse mb-4`},Ne={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Pe={class:`px-3 py-2 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100`},Fe={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ie={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Le={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Re={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},ze={class:`bg-gray-100 dark:bg-gray-700`},Be={class:`px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`},Ve={class:`px-3 py-2 rounded-md bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 font-semibold text-gray-900 dark:text-gray-100`},He={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ue=[`disabled`],We=[`value`],Ge={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ke={key:0,class:`border-1 rounded bg-red-500/10 p-2`},qe={class:`text-red-800`},Je={class:`flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700`},Ye=[`disabled`],Xe=[`disabled`],Ze={key:0,class:`flex items-center justify-center`},Qe={key:1};var I=ne({__name:`CreatePage`,setup(ne){let I=h(null),L=i(),R=ce(),z=ae(),{showSuccess:$e,showError:B}=r(),V=h(!1),H=h(!1),U=h({}),W=new Date,et=W.getMonth()+1,G=W.getFullYear(),K=h(et),q=h(G),J=h({date:new Date().toISOString().split(`T`)[0],employee_id:0,account_id:0,month:new Date().getMonth()+1,year:new Date().getFullYear(),sub_total:0,advance_payment:0,base_salary:0,others:0,final_total:0,others_note:``,note:``}),Y=[{value:1,label:`January`},{value:2,label:`February`},{value:3,label:`March`},{value:4,label:`April`},{value:5,label:`May`},{value:6,label:`June`},{value:7,label:`July`},{value:8,label:`August`},{value:9,label:`September`},{value:10,label:`October`},{value:11,label:`November`},{value:12,label:`December`}],tt=s(()=>{let e=[];for(let t=se.commissionStartYear;t<=G;t++)e.push(t);return e.reverse()});s(()=>{let e=new Date().getFullYear(),t=[];for(let n=e-5;n<=e+1;n++)t.push(n);return t.reverse()});let nt=s(()=>z.employees),rt=s(()=>z.accounts||[]),it=s(()=>R.salaries),X=s(()=>R.pendingLoan),at=s(()=>Object.keys(U.value).length>0);s(()=>J.value.month>0&&J.value.month<=12?Y[J.value.month-1]:``);let ot=e=>{U.value[e]&&delete U.value[e]},st=e=>{U.value={};for(let[t,n]of Object.entries(e))n&&n.length>0&&(U.value[t]=n[0])},Z=()=>{U.value={}},Q=()=>{let e=Number(J.value.sub_total)||0,t=Number(J.value.advance_payment)||0,n=Number(J.value.base_salary)||0,r=Number(J.value.others)||0;J.value.final_total=e-t+r+n},ct=()=>{J.value={date:new Date().toISOString().split(`T`)[0],employee_id:0,account_id:0,month:new Date().getMonth()+1,year:new Date().getFullYear(),sub_total:0,advance_payment:0,base_salary:0,others:0,final_total:0,others_note:``,note:``},Z()},lt=()=>{Z();let e={};if(J.value.date||(e.date=`Date is required`),(!J.value.employee_id||J.value.employee_id<=0)&&(e.employee_id=`Employee is required`),(!J.value.account_id||J.value.account_id<=0)&&(e.account_id=`Account is required`),(!J.value.month||J.value.month<1||J.value.month>12)&&(e.month=`Valid month is required`),(!J.value.year||J.value.year<2e3||J.value.year>2100)&&(e.year=`Valid year is required`),(J.value.sub_total===void 0||J.value.sub_total<0)&&(e.sub_total=`Sub total must be 0 or greater`),(J.value.advance_payment===void 0||J.value.advance_payment<0)&&(e.advance_payment=`Advance payment must be 0 or greater`),J.value.others===void 0&&(e.others=`Others amount is required`),J.value.others_note&&J.value.others_note.length>500&&(e.others_note=`Others note cannot exceed 500 characters`),J.value.note&&J.value.note.length>1e3&&(e.note=`Notes cannot exceed 1000 characters`),U.value=e,Object.keys(e).length>0){let t=Object.values(e).join(`, `);B(`Validation failed: ${t}`)}return Object.keys(e).length===0},ut=async()=>{if(lt())try{V.value=!0,await R.createSalary(J.value),ct(),$e(`Salary created successfully`),L.push({name:`employees.salaries.index`})}catch(e){e.response?.status===422&&e.response?.data?.errors?st(e.response.data.errors):B(e.response?.data?.message||`Failed to create salary`)}finally{V.value=!1}},dt=()=>{L.push({name:`employees.salaries.index`})},ft=()=>{L.go(-1)},$=async e=>{try{H.value=!0;let t=await de.getMonthlyCommission({employee_id:e,month:K.value,year:q.value});I.value=t,await R.fetchPendingLoan(e),await pt(e),J.value.employee_id=e,J.value.month=K.value,J.value.year=q.value,J.value.sub_total=I.value.total_commission,J.value.advance_payment=X?.value||0,J.value.base_salary=I.value.business_summary.base_salary,Q()}catch(e){console.error(`Error fetching commission data:`,e)}finally{H.value=!1}},pt=async e=>{await R.fetchSalaries({employee_id:e})},mt=async()=>{try{z.employees.length===0&&await z.fetchListData(`employees`)}catch(e){console.error(`Failed to load employees:`,e)}},ht=async()=>{try{z.accounts.length===0&&await z.fetchListData(`accounts`)}catch(e){console.error(`Failed to load accounts:`,e)}};return re(async()=>{await Promise.all([mt(),ht()])}),(r,i)=>{let s=ie(`Input`);return f(),u(`div`,fe,[c(`div`,pe,[c(`div`,me,[c(`div`,he,[c(`button`,{onClick:ft,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[t(g(te),{class:`w-5 h-5`})]),i[9]||=c(`div`,null,[c(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Create Employee Salary `),c(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Add a new salary record for an employee `)],-1)])]),c(`div`,ge,[c(`div`,_e,[c(`div`,ve,[c(`div`,null,[i[10]||=c(`label`,{class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},`Month`,-1),m(c(`select`,{"onUpdate:modelValue":i[0]||=e=>K.value=e,class:`px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500`},[(f(),u(o,null,p(Y,e=>c(`option`,{key:e.value,value:e.value},v(e.label),9,b)),64))],512),[[a,K.value]])]),c(`div`,null,[i[11]||=c(`label`,{class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},`Year`,-1),m(c(`select`,{"onUpdate:modelValue":i[1]||=e=>q.value=e,class:`px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500`},[(f(!0),u(o,null,p(tt.value,e=>(f(),u(`option`,{key:e,value:e},v(e),9,x))),128))],512),[[a,q.value]])])]),i[15]||=c(`div`,{class:`mb-3 text-lg font-semibold text-gray-900 dark:text-gray-100`},`Employees`,-1),c(`table`,S,[i[12]||=c(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[c(`tr`,null,[c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` #`),c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Employee`),c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Department`),c(`th`,{class:`px-3 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Action`)])],-1),c(`tbody`,null,[(f(!0),u(o,null,p(nt.value,(e,n)=>(f(),u(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[c(`td`,C,v(n+1),1),c(`td`,w,v(e.name),1),c(`td`,T,v(e.department?.name),1),c(`td`,E,[c(`button`,{onClick:t=>$(e.id),class:`text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200`,title:`View details`},[t(g(oe),{class:`w-4 h-4`})],8,D)])]))),128))])]),I.value&&!H.value?(f(),u(`div`,O,[i[14]||=c(`div`,{class:`mb-3 text-lg py-4 mt-6 border-gray-400 border-t-2 font-semibold text-gray-900 dark:text-gray-100`},` Salary History`,-1),c(`table`,k,[i[13]||=c(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[c(`tr`,null,[c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Month`),c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Comm.`),c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Adv.`),c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Others`),c(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Total`),c(`th`,{class:`px-3 py-2 text-center text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Act.`)])],-1),c(`tbody`,null,[(f(!0),u(o,null,p(it.value,(e,r)=>(f(),u(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[c(`td`,A,v(e.month)+` / `+v(e.year),1),c(`td`,j,v(e.sub_total),1),c(`td`,M,v(e.advance_payment),1),c(`td`,N,v(e.others),1),c(`td`,P,v(e.final_total),1),c(`td`,F,[c(`button`,{onClick:t=>$(e.id),class:`text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 transition-colors duration-200`,title:`View details`},[t(g(n),{class:`w-4 h-4`})],8,ye)])]))),128))])])])):l(``,!0)]),c(`div`,be,[H.value?(f(),u(`div`,xe,[t(g(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`})])):l(``,!0),I.value&&!H.value?(f(),u(`div`,Se,[c(`div`,Ce,[c(`div`,null,` Employee: `+v(I.value?.business_summary.employee_name),1),c(`div`,we,[c(`div`,null,[c(`label`,Te,`Month: `+v(K.value),1)]),c(`div`,null,[c(`label`,Ee,`Year : `+v(q.value),1)])])])])):l(``,!0),I.value&&!H.value?(f(),u(`div`,De,[c(`div`,null,[t(le,{class:`mt-4`,"commission-data":I.value},null,8,[`commission-data`]),t(ue,{class:`mt-4`,"commission-data":I.value},null,8,[`commission-data`])])])):l(``,!0),I.value&&!H.value?(f(),u(`div`,Oe,[c(`div`,ke,[i[26]||=c(`h2`,{class:`text-xl font-semibold mb-4 pb-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white`},` Employee Salary Summary`,-1),c(`div`,Ae,[c(`div`,je,[i[16]||=c(`strong`,null,`Employee:`,-1),d(` `+v(I.value.business_summary.employee_name),1)]),c(`div`,null,[i[17]||=c(`strong`,null,`Period:`,-1),d(` Month `+v(J.value.month)+` / Year `+v(J.value.year),1)])]),c(`form`,{onSubmit:ee(ut,[`prevent`])},[c(`table`,Me,[c(`tbody`,null,[c(`tr`,null,[i[18]||=c(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Sub Total (total commission)`,-1),c(`td`,Ne,[c(`div`,Pe,v(g(y)(I.value?.total_commission)),1)])]),c(`tr`,null,[i[19]||=c(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Base Salary`,-1),c(`td`,Fe,[t(s,{type:`number`,onInput:Q,class:`w-full`,modelValue:J.value.base_salary,"onUpdate:modelValue":i[2]||=e=>J.value.base_salary=e},null,8,[`modelValue`])])]),c(`tr`,null,[i[20]||=c(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Advance Loan (-)`,-1),c(`td`,Ie,[t(s,{type:`number`,onInput:Q,class:`w-full`,modelValue:J.value.advance_payment,"onUpdate:modelValue":i[3]||=e=>J.value.advance_payment=e},null,8,[`modelValue`])])]),c(`tr`,null,[c(`th`,{class:_([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,J.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other (bonus or deduction)`,2),c(`td`,Le,[t(s,{type:`number`,onInput:Q,class:_([J.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:J.value.others,"onUpdate:modelValue":i[4]||=e=>J.value.others=e},null,8,[`class`,`modelValue`])])]),c(`tr`,null,[c(`th`,{class:_([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,J.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other Notes`,2),c(`td`,Re,[t(s,{type:`text`,class:_([J.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:J.value.others_note,"onUpdate:modelValue":i[5]||=e=>J.value.others_note=e,placeholder:`Other note`},null,8,[`class`,`modelValue`])])]),c(`tr`,ze,[i[21]||=c(`th`,{class:`px-3 py-2 text-left font-bold text-base bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},` Net Total`,-1),c(`td`,Be,[c(`div`,Ve,v(g(y)(J.value.final_total)),1)])]),c(`tr`,null,[i[23]||=c(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Account`,-1),c(`td`,He,[m(c(`select`,{id:`account_id`,"onUpdate:modelValue":i[6]||=e=>J.value.account_id=e,disabled:V.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onBlur:i[7]||=()=>ot(`account_id`),required:``},[i[22]||=c(`option`,{value:``},`Select account`,-1),(f(!0),u(o,null,p(rt.value,e=>(f(),u(`option`,{key:e.id,value:e.id},v(e.name),9,We))),128))],40,Ue),[[a,J.value.account_id]])])]),c(`tr`,null,[i[24]||=c(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Salary Note`,-1),c(`td`,Ge,[t(s,{type:`text`,class:`w-full`,modelValue:J.value.note,"onUpdate:modelValue":i[8]||=e=>J.value.note=e,placeholder:`Add any notes`},null,8,[`modelValue`])])])])]),at.value?(f(),u(`div`,Ke,[c(`ul`,qe,[(f(!0),u(o,null,p(U.value,e=>(f(),u(`li`,null,v(e),1))),256))])])):l(``,!0),c(`div`,Je,[c(`button`,{type:`button`,onClick:dt,disabled:V.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},` Cancel `,8,Ye),c(`button`,{type:`submit`,disabled:V.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},[V.value?(f(),u(`div`,Ze,i[25]||=[c(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),d(` Creating... `,-1)])):(f(),u(`span`,Qe,`Create Salary`))],8,Xe)])],32)])])):l(``,!0)])])])])}}}),L=I;export{L as default};