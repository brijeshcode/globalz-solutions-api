import{M as e,a$ as t,aB as n,aC as r,aI as ee,aM as te,aN as i,aP as a,aQ as o,aS as s,aT as c,aV as l,aW as u,aX as ne,aZ as re,aj as ie,ax as ae,b0 as d,b2 as oe,b5 as se,b7 as ce,b9 as f,ba as p,bb as m,bd as h}from"./index-CO1aexQm.js";import"./GlobalConfig-wPgXFcZ5.js";import"./tableUtils-ylneqlK-.js";import{f as g}from"./common-qdv5PS_C.js";import{b as le}from"./accountsStore-CmOpRqjS.js";import"./currencyUtil-BjbNFFmz.js";import{b as ue}from"./employeesStore-C_e2WTwP.js";import{b as de}from"./salaryStore-BV9Y33BE.js";import{b as fe,c as pe,d as me}from"./EmployeeDailyBusinessBreadDown-BuKyhVZz.js";const he={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},ge={class:`mx-auto`},_e={class:`mb-8`},_={class:`flex items-center space-x-4 mb-2`},v={key:0,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-8`},y={key:1,class:`grid grid-cols-12 gap-4`},b={class:`col-span-4`},x={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},S={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},C={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},w={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},T={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},E={class:`col-span-8`},D={key:0,class:`text-lg`},O={key:1},k={class:`flex items-center justify-between gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md`},A={class:`flex gap-3`},j={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},M={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},N={key:2},P={key:3,class:`bg-white mt-4 dark:bg-gray-800 shadow rounded-lg`},F={class:`p-6`},I={class:`mb-4 text-sm text-gray-700 dark:text-gray-300`},ve={class:`mb-1`},ye={class:`mb-1`},be={class:`mb-1`},xe={class:`w-full border-collapse mb-4`},Se={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ce={class:`px-3 py-2 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100`},we={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Te={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ee={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},De={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Oe={class:`bg-gray-100 dark:bg-gray-700`},ke={class:`px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`},Ae={class:`px-3 py-2 rounded-md bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 font-semibold text-gray-900 dark:text-gray-100`},je={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Me=[`disabled`],Ne=[`value`],Pe={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Fe={class:`flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700`},Ie=[`disabled`],Le=[`disabled`],Re={key:0,class:`flex items-center justify-center`},ze={key:1};var L=ne({__name:`EditPage`,setup(ne){let L=r(),R=n(),{showSuccess:Be,showError:z}=ae(),B=a(()=>parseInt(R.params.id)),V=de(),H=ue(),U=le(),W=f(!1),G=f(!1),K=f(!1),q=f(null),J=f({}),Y=f({date:``,salary_code:``,employee_id:0,account_id:0,month:0,base_salary:0,year:0,sub_total:0,advance_payment:0,others:0,final_total:0,others_note:``,note:``});a(()=>{let e=new Date().getFullYear(),t=[];for(let n=e-5;n<=e+1;n++)t.push(n);return t.reverse()});let Ve=a(()=>H.activeEmployees||[]),He=a(()=>U.activeAccounts||[]),Ue=a(()=>V.salaries);a(()=>Object.keys(J.value).length>0);let We=a(()=>{let e=Ve.value.find(e=>e.id===Y.value.employee_id);return e?e.name:``}),X=e=>{J.value={};for(let[t,n]of Object.entries(e))n&&n.length>0&&(J.value[t]=n[0])},Z=()=>{J.value={}},Q=()=>{let e=Number(Y.value.sub_total)||0,t=Number(Y.value.advance_payment)||0,n=Number(Y.value.others)||0,r=Number(Y.value.base_salary)||0;Y.value.final_total=e-t+n+r},$=async()=>{try{G.value=!0;let e=await V.fetchSalary(B.value);e&&(Y.value={date:e.date||``,salary_code:e.salary_code||``,employee_id:e.employee_id||0,base_salary:e.base_salary,account_id:e.account_id||0,month:e.month||0,year:e.year||0,sub_total:e.sub_total||0,advance_payment:e.advance_payment||0,others:e.others||0,final_total:e.final_total||0,others_note:e.others_note||``,note:e.note||``},Z(),e.employee_id&&(await Ge(e.employee_id),await Ke(e.employee_id,e.month,e.year)))}catch(e){console.error(`Error loading salary:`,e),z(`Failed to load salary record`)}finally{G.value=!1}},Ge=async e=>{try{await V.fetchSalaries({employee_id:e})}catch(e){console.error(`Failed to load salary history:`,e)}},Ke=async(e,t,n)=>{try{K.value=!0;let r=await me.getMonthlyCommission({employee_id:e,month:t,year:n});q.value=r}catch(e){console.error(`Failed to load commission data:`,e)}finally{K.value=!1}},qe=()=>{Z();let e={};return Y.value.date||(e.date=`Date is required`),(!Y.value.employee_id||Y.value.employee_id<=0)&&(e.employee_id=`Employee is required`),(!Y.value.account_id||Y.value.account_id<=0)&&(e.account_id=`Account is required`),(!Y.value.month||Y.value.month<1||Y.value.month>12)&&(e.month=`Valid month is required`),(!Y.value.year||Y.value.year<2e3||Y.value.year>2100)&&(e.year=`Valid year is required`),(Y.value.sub_total===void 0||Y.value.sub_total<0)&&(e.sub_total=`Sub total must be 0 or greater`),(Y.value.advance_payment===void 0||Y.value.advance_payment<0)&&(e.advance_payment=`Advance payment must be 0 or greater`),Y.value.others===void 0&&(e.others=`Others amount is required`),Y.value.others_note&&Y.value.others_note.length>500&&(e.others_note=`Others note cannot exceed 500 characters`),Y.value.note&&Y.value.note.length>1e3&&(e.note=`Notes cannot exceed 1000 characters`),J.value=e,Object.keys(e).length===0},Je=async()=>{if(qe())try{W.value=!0;let e={date:Y.value.date,employee_id:Y.value.employee_id,account_id:Y.value.account_id,base_salary:Y.value.base_salary,month:Y.value.month,year:Y.value.year,sub_total:Y.value.sub_total,advance_payment:Y.value.advance_payment,others:Y.value.others,final_total:Y.value.final_total,others_note:Y.value.others_note||void 0,note:Y.value.note||void 0};await V.updateSalary(B.value,e),Be(`Salary updated successfully`),L.push({name:`employees.salaries.index`})}catch(e){e.response?.status===422&&e.response?.data?.errors?X(e.response.data.errors):z(e.response?.data?.message||`Failed to update salary`)}finally{W.value=!1}},Ye=()=>{L.push({name:`employees.salaries.index`})},Xe=()=>{L.push({name:`employees.salaries.index`})},Ze=async()=>{try{await H.fetchEmployees({is_active:!0})}catch(e){console.error(`Failed to load employees:`,e)}},Qe=async()=>{try{await U.fetchAccounts({is_active:!0})}catch(e){console.error(`Failed to load accounts:`,e)}};return re(async()=>{try{G.value=!0,await Promise.all([Ze(),Qe()])}catch(e){console.error(`Error loading dropdown data:`,e)}finally{G.value=!1}await $()}),se(()=>B.value,()=>{B.value&&$()}),(n,r)=>{let a=oe(`Input`);return t(),c(`div`,he,[o(`div`,ge,[o(`div`,_e,[o(`div`,_,[o(`button`,{onClick:Xe,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[u(p(ie),{class:`w-5 h-5`})]),r[6]||=o(`div`,null,[o(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Edit Employee Salary `),o(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Update salary record information and details `)],-1)])]),G.value?(t(),c(`div`,v,r[7]||=[o(`div`,{class:`flex items-center justify-center`},[o(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-4`}),o(`span`,{class:`text-gray-600 dark:text-gray-400`},`Loading salary...`)],-1)])):Y.value?(t(),c(`div`,y,[o(`div`,b,[r[9]||=o(`div`,{class:`mb-3 text-lg font-semibold text-gray-900 dark:text-gray-100`},`Salary History`,-1),o(`table`,x,[r[8]||=o(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[o(`tr`,null,[o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Month`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Comm.`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Adv.`),o(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Total`)])],-1),o(`tbody`,null,[(t(!0),c(i,null,d(Ue.value,e=>(t(),c(`tr`,{key:e.id,class:m([`hover:bg-gray-50 dark:hover:bg-gray-700`,{"bg-blue-50 dark:bg-blue-900/20":e.id===B.value}])},[o(`td`,S,h(e.month)+`/`+h(e.year),1),o(`td`,C,h(p(g)(e.sub_total)),1),o(`td`,w,h(p(g)(e.advance_payment)),1),o(`td`,T,h(p(g)(e.final_total)),1)],2))),128))])])]),o(`div`,E,[K.value?(t(),c(`div`,D,[u(p(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`})])):s(``,!0),q.value&&!K.value?(t(),c(`div`,O,[o(`div`,k,[o(`div`,null,` Employee: `+h(q.value?.business_summary.employee_name),1),o(`div`,A,[o(`div`,null,[o(`label`,j,`Month: `+h(Y.value.month),1)]),o(`div`,null,[o(`label`,M,`Year: `+h(Y.value.year),1)])])])])):s(``,!0),q.value&&!K.value?(t(),c(`div`,N,[o(`div`,null,[u(fe,{class:`mt-4`,"commission-data":q.value},null,8,[`commission-data`]),u(pe,{class:`mt-4`,"commission-data":q.value},null,8,[`commission-data`])])])):s(``,!0),q.value&&!K.value?(t(),c(`div`,P,[o(`div`,F,[r[21]||=o(`h2`,{class:`text-xl font-semibold mb-4 pb-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white`},` Employee Salary Summary`,-1),o(`div`,I,[o(`div`,ve,[r[10]||=o(`strong`,null,`Employee:`,-1),l(` `+h(We.value),1)]),o(`div`,ye,[r[11]||=o(`strong`,null,`Period:`,-1),l(` Month `+h(Y.value.month)+` / Year `+h(Y.value.year),1)]),o(`div`,be,[r[12]||=o(`strong`,null,`Salary Code:`,-1),l(` `+h(Y.value.salary_code),1)])]),o(`form`,{onSubmit:te(Je,[`prevent`])},[o(`table`,xe,[o(`tbody`,null,[o(`tr`,null,[r[13]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Sub Total (total commission)`,-1),o(`td`,Se,[o(`div`,Ce,h(p(g)(Y.value.sub_total)),1)])]),o(`tr`,null,[r[14]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Base Salary`,-1),o(`td`,we,[u(a,{type:`number`,onInput:Q,class:`w-full`,modelValue:Y.value.base_salary,"onUpdate:modelValue":r[0]||=e=>Y.value.base_salary=e},null,8,[`modelValue`])])]),o(`tr`,null,[r[15]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Advance Loan (-)`,-1),o(`td`,Te,[u(a,{type:`number`,onInput:Q,class:`w-full`,modelValue:Y.value.advance_payment,"onUpdate:modelValue":r[1]||=e=>Y.value.advance_payment=e},null,8,[`modelValue`])])]),o(`tr`,null,[o(`th`,{class:m([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other (bonus or deduction)`,2),o(`td`,Ee,[u(a,{type:`number`,onInput:Q,class:m([Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:Y.value.others,"onUpdate:modelValue":r[2]||=e=>Y.value.others=e},null,8,[`class`,`modelValue`])])]),o(`tr`,null,[o(`th`,{class:m([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other Notes`,2),o(`td`,De,[u(a,{type:`text`,class:m([Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:Y.value.others_note,"onUpdate:modelValue":r[3]||=e=>Y.value.others_note=e,placeholder:`Other note`},null,8,[`class`,`modelValue`])])]),o(`tr`,Oe,[r[16]||=o(`th`,{class:`px-3 py-2 text-left font-bold text-base bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},` Net Total`,-1),o(`td`,ke,[o(`div`,Ae,h(p(g)(Y.value.final_total)),1)])]),o(`tr`,null,[r[18]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Account`,-1),o(`td`,je,[ce(o(`select`,{id:`account_id`,"onUpdate:modelValue":r[4]||=e=>Y.value.account_id=e,disabled:W.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,required:``},[r[17]||=o(`option`,{value:``},`Select account`,-1),(t(!0),c(i,null,d(He.value,e=>(t(),c(`option`,{key:e.id,value:e.id},h(e.name),9,Ne))),128))],8,Me),[[ee,Y.value.account_id]])])]),o(`tr`,null,[r[19]||=o(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Salary Note`,-1),o(`td`,Pe,[u(a,{type:`text`,class:`w-full`,modelValue:Y.value.note,"onUpdate:modelValue":r[5]||=e=>Y.value.note=e,placeholder:`Add any notes`},null,8,[`modelValue`])])])])]),o(`div`,Fe,[o(`button`,{type:`button`,onClick:Ye,disabled:W.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},` Cancel `,8,Ie),o(`button`,{type:`submit`,disabled:W.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},[W.value?(t(),c(`div`,Re,r[20]||=[o(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),l(` Updating... `,-1)])):(t(),c(`span`,ze,`Update Salary`))],8,Le)])],32)])])):s(``,!0)])])):s(``,!0)])])}}}),R=L;export{R as default};