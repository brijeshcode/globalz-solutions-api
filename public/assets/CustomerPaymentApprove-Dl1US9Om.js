import{a$ as e,aC as t,aN as ee,aO as te,aR as ne,aS as n,aU as r,aV as i,aW as a,aX as o,aY as s,a_ as c,ag as re,b0 as l,b3 as ie,b5 as u,b6 as ae,bb as oe,bc as d,bd as f,bf as p,bg as m,bj as h,d as se}from"./index-Dtcwuetq.js";import{b as ce}from"./useAuth-D6NhwC1E.js";import{c as le}from"./common-CZbH6H1Z.js";import{b as ue}from"./Modal-dX9S2DoC.js";import{b as g}from"./currencyUtil-DOYhMuUb.js";import{b as de}from"./customerPaymentOrdersStore-DkG83Mpj.js";import{b as fe}from"./usersStore-DCM-_pJ2.js";const pe={key:0,class:`space-y-6`},_={class:`bg-gray-50 dark:bg-gray-700 rounded-lg p-4`},v={class:`grid grid-cols-1 md:grid-cols-2 gap-4 text-sm`},y={class:`ml-2 font-medium text-gray-900 dark:text-white`},b={class:`ml-2 font-medium text-gray-900 dark:text-white`},x={class:`ml-2 font-medium text-gray-900 dark:text-white`},S={class:`ml-2 font-medium text-gray-900 dark:text-white`},C={class:`ml-2 font-medium text-gray-900 dark:text-white`},w={class:`ml-2 font-medium text-gray-900 dark:text-white`},T={key:0,class:`mt-3`},E={class:`mt-1 text-sm text-gray-900 dark:text-white`},D={key:0},O={class:`font-bold uppercase text-green-400`},k={class:`grid grid-cols-1 gap-4`},A=[`disabled`],j=[`value`],M={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},N=[`disabled`],P={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},F={class:`flex items-center justify-end space-x-3`},I=[`disabled`],me=[`disabled`],L={key:0,class:`flex items-center`},R={key:1,class:`flex items-center`};var z=l({__name:`CustomerPaymentApprove`,props:{show:{type:Boolean},paymentOrder:{}},emits:[`update:show`,`approved`],setup(l,{emit:z}){let B=l,V=z,he=de(),H=se(),U=fe(),{user:W}=ce(),G=t(),K=p(!1),q=p({}),J=p({account_id:null,approved_by:null,approve_note:``}),Y=r({get:()=>B.show,set:e=>V(`update:show`,e)}),ge=r(()=>H.accounts);r(()=>U.users);let X=r(()=>ge.value.filter(e=>e.currency_id==B.paymentOrder?.currency_id)),_e=r(()=>J.value.account_id&&J.value.approved_by),Z=()=>{K.value||(Q(),V(`update:show`,!1))},Q=()=>{J.value={account_id:null,approved_by:W.value?.id||null,approve_note:``},q.value={}},ve=()=>(q.value={},J.value.account_id||(q.value.account_id=`Account is required`),J.value.approved_by||(q.value.approved_by=`Approved by user is required`),Object.keys(q.value).length===0),$=async()=>{if(!(!B.paymentOrder||!ve()))try{K.value=!0;let e={account_id:J.value.account_id,approve_note:J.value.approve_note||void 0},t=await he.approveOrder(B.paymentOrder.id,e);G.success(`Payment approved successfully`),V(`approved`,t),Z()}catch(e){console.error(`Error approving payment:`,e),e.response?.data?.errors?q.value=e.response.data.errors:G.error(e.response?.data?.message||`Failed to approve payment`)}finally{K.value=!1}},ye=async()=>{try{await Promise.all([H.fetchAccounts(),U.fetchUsers()])}catch(e){console.error(`Error loading required data:`,e)}};return oe(()=>B.show,e=>{e&&(Q(),ye())}),ie(()=>{W.value&&(J.value.approved_by=W.value.id)}),(t,r)=>(u(),a(ue,{modelValue:Y.value,"onUpdate:modelValue":r[3]||=e=>Y.value=e,title:`Approve Payment`,size:`lg`,loading:K.value,onClose:Z},{footer:d(()=>[i(`div`,F,[i(`button`,{type:`button`,onClick:Z,class:`inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 transition-colors duration-200`,disabled:K.value},` Cancel `,8,I),i(`button`,{type:`submit`,onClick:$,class:`inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md shadow-sm hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-900 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed`,disabled:K.value||!_e.value},[K.value?(u(),s(`div`,L,r[21]||=[i(`svg`,{class:`animate-spin -ml-1 mr-2 h-4 w-4 text-white`,xmlns:`http://www.w3.org/2000/svg`,fill:`none`,viewBox:`0 0 24 24`},[i(`circle`,{class:`opacity-25`,cx:`12`,cy:`12`,r:`10`,stroke:`currentColor`,"stroke-width":`4`}),i(`path`,{class:`opacity-75`,fill:`currentColor`,d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z`})],-1),c(` Approving... `,-1)])):(u(),s(`div`,R,[e(m(re),{class:`h-4 w-4 mr-2`}),r[22]||=c(` Approve Payment `,-1)]))],8,me)])]),default:d(()=>[t.paymentOrder?(u(),s(`div`,pe,[i(`div`,_,[r[11]||=i(`h4`,{class:`text-sm font-medium text-gray-900 dark:text-white mb-3`},`Payment Order Details`,-1),i(`div`,v,[i(`div`,null,[r[4]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Code:`,-1),i(`span`,y,h(t.paymentOrder.prefix)+`-`+h(t.paymentOrder.code),1)]),i(`div`,null,[r[5]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Date:`,-1),i(`span`,b,h(m(le)(t.paymentOrder.date)),1)]),i(`div`,null,[r[6]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Customer:`,-1),i(`span`,x,h(t.paymentOrder.customer?.name||`N/A`),1)]),i(`div`,null,[r[7]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Amount:`,-1),i(`span`,S,h(m(g)(t.paymentOrder.amount,!0,t.paymentOrder.currency)),1)]),i(`div`,null,[r[8]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Amount USD:`,-1),i(`span`,C,h(m(g)(t.paymentOrder.amount_usd,!0)),1)]),i(`div`,null,[r[9]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Currency Rate:`,-1),i(`span`,w,h(t.paymentOrder.currency_rate),1)])]),t.paymentOrder.note?(u(),s(`div`,T,[r[10]||=i(`span`,{class:`text-gray-500 dark:text-gray-400`},`Note:`,-1),i(`p`,E,h(t.paymentOrder.note),1)])):o(``,!0)]),X.value.length==0?(u(),s(`div`,D,[r[12]||=c(` No account is available for the `,-1),i(`span`,O,h(t.paymentOrder.currency.name),1),r[13]||=c(` currency. `,-1),r[14]||=i(`br`,null,null,-1),r[15]||=c(` Please add an account with this currency to put this payment into that account. `,-1)])):(u(),s(`form`,{key:1,onSubmit:ne($,[`prevent`]),class:`space-y-4`},[i(`div`,k,[i(`div`,null,[r[17]||=i(`label`,{for:`account_id`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},[c(` Account `),i(`span`,{class:`text-red-500`},`*`)],-1),f(i(`select`,{id:`account_id`,"onUpdate:modelValue":r[0]||=e=>J.value.account_id=e,required:``,class:`block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 sm:text-sm`,disabled:K.value},[r[16]||=i(`option`,{disabled:``,value:``},`Select Account`,-1),(u(!0),s(n,null,ae(X.value,e=>(u(),s(`option`,{key:e.id,value:e.id},h(e.name),9,j))),128))],8,A),[[ee,J.value.account_id]]),q.value.account_id?(u(),s(`p`,M,h(q.value.account_id),1)):o(``,!0)]),o(``,!0)]),i(`div`,null,[r[20]||=i(`label`,{for:`approve_note`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Approval Note `,-1),f(i(`textarea`,{id:`approve_note`,"onUpdate:modelValue":r[2]||=e=>J.value.approve_note=e,rows:`3`,class:`block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 sm:text-sm`,placeholder:`Optional approval note...`,disabled:K.value},null,8,N),[[te,J.value.approve_note]]),q.value.approve_note?(u(),s(`p`,P,h(q.value.approve_note),1)):o(``,!0)])],32))])):o(``,!0)]),_:1},8,[`modelValue`,`loading`]))}}),B=z;export{B as b};