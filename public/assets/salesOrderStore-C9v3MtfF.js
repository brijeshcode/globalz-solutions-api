import{aQ as e,aU as t,ab as n,ac as r,ad as i,ae as a,af as o,ak as s,al as c,am as l,ay as u}from"./index-B2kINIqB.js";import{b as d}from"./tableUtils-jdfVzp2e.js";var f=class{baseUrl=`/customers/sale-orders`;async getSaleOrders(e){try{let t=this.buildQueryParams(e),n=await r(`${this.baseUrl}?${t}`,{loadingMessage:`Loading sale orders...`,showLoading:!0});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching sale orders:`,e),e}}async getSaleOrder(e){try{let t=await r(`${this.baseUrl}/${e}`,{loadingMessage:`Loading sale order...`});return t.data.data}catch(e){throw console.error(`Error fetching sale order:`,e),e}}async createSaleOrder(e){try{let t=await a(this.baseUrl,e,{loadingMessage:`Creating sale order...`,showSuccessNotification:!0,successMessage:`Sale order created successfully`});return t.data.data}catch(e){throw console.error(`Error creating sale order:`,e),e}}async updateSaleOrder(e,t){try{let n=await o(`${this.baseUrl}/${e}`,t,{loadingMessage:`Updating sale order...`,showSuccessNotification:!0,successMessage:`Sale order updated successfully`});return n.data.data}catch(e){throw console.error(`Error updating sale order:`,e),e}}async deleteSaleOrder(e){try{await n(`${this.baseUrl}/${e}`,{loadingMessage:`Deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order deleted successfully`})}catch(e){throw console.error(`Error deleting sale order:`,e),e}}async getTrashedSaleOrders(e){try{let t=this.buildQueryParams(e),n=await r(`${this.baseUrl}/trashed?${t}`,{loadingMessage:`Loading trashed sale orders...`});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching trashed sale orders:`,e),e}}async approveSaleOrder(e,t){try{let n=await i(`${this.baseUrl}/${e}/approve`,t,{loadingMessage:`Approving sale order...`,showSuccessNotification:!0,successMessage:`Sale order approved successfully`});return n.data.data}catch(e){throw console.error(`Error approving sale order:`,e),e}}async restoreSaleOrder(e){try{let t=await i(`${this.baseUrl}/${e}/restore`,{},{loadingMessage:`Restoring sale order...`,showSuccessNotification:!0,successMessage:`Sale order restored successfully`});return t.data.data}catch(e){throw console.error(`Error restoring sale order:`,e),e}}async forceDeleteSaleOrder(e){try{await n(`${this.baseUrl}/${e}/force-delete`,{loadingMessage:`Permanently deleting sale order...`,showSuccessNotification:!0,successMessage:`Sale order permanently deleted`})}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}}async getSaleOrderStats(){try{let e=await r(`${this.baseUrl}/stats`,{loadingMessage:`Loading sale order statistics...`});return e.data.data}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}}async searchSaleOrders(e){try{let t=await r(`${this.baseUrl}/search?query=${encodeURIComponent(e)}`,{showLoading:!1});return t.data.data}catch(e){throw console.error(`Error searching sale orders:`,e),e}}async getSaleOrdersByCustomer(e){try{let t=await r(`${this.baseUrl}/by-customer/${e}`,{loadingMessage:`Loading customer sale orders...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by customer:`,e),e}}async getSaleOrdersByCurrency(e){try{let t=await r(`${this.baseUrl}/by-currency/${e}`,{loadingMessage:`Loading sale orders by currency...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by currency:`,e),e}}async getSaleOrdersByWarehouse(e){try{let t=await r(`${this.baseUrl}/by-warehouse/${e}`,{loadingMessage:`Loading sale orders by warehouse...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by warehouse:`,e),e}}async getSaleOrdersByPrefix(e){try{let t=await r(`${this.baseUrl}/by-prefix/${e}`,{loadingMessage:`Loading sale orders by prefix...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by prefix:`,e),e}}async getSaleOrdersByDateRange(e,t){try{let n=await r(`${this.baseUrl}/by-date-range?start_date=${e}&end_date=${t}`,{loadingMessage:`Loading sale orders by date range...`});return n.data.data}catch(e){throw console.error(`Error fetching sale orders by date range:`,e),e}}async getSaleOrdersBySalesperson(e){try{let t=await r(`${this.baseUrl}/by-salesperson/${e}`,{loadingMessage:`Loading sale orders by salesperson...`});return t.data.data}catch(e){throw console.error(`Error fetching sale orders by salesperson:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const p=new f,m=l(`saleOrders`,()=>{let n=c(),r=s(),i=t([]),a=t(null),o=t([]),l=t(d()),f=t(!1),m=t({per_page:50}),h=u(()=>e=>i.value.filter(t=>t.prefix===e)),g=u(()=>e=>i.value.filter(t=>t.customer_id===e)),ee=u(()=>e=>i.value.filter(t=>t.currency_id===e)),te=u(()=>e=>i.value.filter(t=>t.warehouse_id===e)),_=u(()=>e=>i.value.filter(t=>t.salesperson_id===e)),v=u(()=>e=>i.value.filter(t=>t.status===e)),y=u(()=>i.value.filter(e=>e.status===`Waiting`)),b=u(()=>i.value.filter(e=>e.status===`Shipped`)),x=u(()=>i.value.filter(e=>e.status===`Delivered`)),S=u(()=>i.value.reduce((e,t)=>e+t.total,0)),C=u(()=>i.value.reduce((e,t)=>e+t.total_usd,0)),w=u(()=>i.value.reduce((e,t)=>e+t.total_profit,0)),T=u(()=>(e,t)=>i.value.filter(n=>{let r=new Date(n.date),i=new Date(e),a=new Date(t);return r>=i&&r<=a})),E=u(()=>({total:i.value.length,waiting:y.value.length,shipped:b.value.length,delivered:x.value.length,totalAmount:S.value,totalAmountUSD:C.value,totalProfit:w.value,byPrefix:{INX:h.value(`INX`).length,INV:h.value(`INV`).length}})),D=u(()=>{let e={};return Object.entries(r.query).forEach(([t,n])=>{n&&typeof n==`string`&&(e[t]=n)}),e}),O=async e=>{try{f.value=!0,e&&(m.value={...m.value,...e});let t=await p.getSaleOrders(m.value);i.value=t.data,l.value=t.pagination}catch(e){throw console.error(`Error fetching sale orders:`,e),e}finally{f.value=!1}},k=async e=>{try{let t=await p.getSaleOrder(e);return a.value=t,t}catch(e){throw console.error(`Error fetching sale order:`,e),e}},A=async e=>{try{let t=await p.createSaleOrder(e);return i.value.unshift(t),l.value.total+=1,t}catch(e){throw console.error(`Error creating sale order:`,e),e}},j=async(e,t)=>{try{let n=await p.updateSaleOrder(e,t),r=i.value.findIndex(t=>t.id===e);return r!==-1&&(i.value[r]=n),a.value?.id===e&&(a.value=n),n}catch(e){throw console.error(`Error updating sale order:`,e),e}},M=async e=>{try{await p.deleteSaleOrder(e);let t=i.value.findIndex(t=>t.id===e);t!==-1&&i.value.splice(t,1),--l.value.total,a.value?.id===e&&(a.value=null)}catch(e){throw console.error(`Error deleting sale order:`,e),e}},N=async e=>{try{f.value=!0;let t=e||{},n=await p.getTrashedSaleOrders(t);o.value=n.data}catch(e){throw console.error(`Error fetching trashed orders:`,e),e}finally{f.value=!1}},P=async e=>{try{let t=await p.restoreSaleOrder(e),n=o.value.findIndex(t=>t.id===e);return n!==-1&&o.value.splice(n,1),i.value.unshift(t),l.value.total+=1,t}catch(e){throw console.error(`Error restoring sale order:`,e),e}},F=async e=>{try{await p.forceDeleteSaleOrder(e);let t=o.value.findIndex(t=>t.id===e);t!==-1&&o.value.splice(t,1)}catch(e){throw console.error(`Error permanently deleting sale order:`,e),e}},I=async(e,t)=>{try{let n=await p.approveSaleOrder(e,t),r=i.value.findIndex(t=>t.id===e);return r!==-1&&i.value.splice(r,1),--l.value.total,a.value?.id===e&&(a.value=null),n}catch(e){throw console.error(`Error approving sale order:`,e),e}},L=async e=>{try{return await p.searchSaleOrders(e)}catch(e){throw console.error(`Error searching sale orders:`,e),e}},R=async e=>{try{return await p.getSaleOrdersByCustomer(e)}catch(e){throw console.error(`Error fetching orders by customer:`,e),e}},z=async e=>{try{return await p.getSaleOrdersByCurrency(e)}catch(e){throw console.error(`Error fetching orders by currency:`,e),e}},ne=async e=>{try{return await p.getSaleOrdersByWarehouse(e)}catch(e){throw console.error(`Error fetching orders by warehouse:`,e),e}},B=async e=>{try{return await p.getSaleOrdersByPrefix(e)}catch(e){throw console.error(`Error fetching orders by prefix:`,e),e}},V=async e=>{try{return await p.getSaleOrdersBySalesperson(e)}catch(e){throw console.error(`Error fetching orders by salesperson:`,e),e}},H=async(e,t)=>{try{return await p.getSaleOrdersByDateRange(e,t)}catch(e){throw console.error(`Error fetching orders by date range:`,e),e}},U=async()=>{try{return await p.getSaleOrderStats()}catch(e){throw console.error(`Error fetching sale order statistics:`,e),e}},W=e=>{m.value={...m.value,...e}},G=()=>{m.value={per_page:50}},K=()=>{a.value=null},q=e=>{let t={...m.value,search:e,page:1};m.value=t,Z(t),$(t,!1)},J=(e,t)=>{let n={...m.value,sort_by:e,sort_direction:t,page:1};m.value=n,Z(n),$(n,!1)},Y=e=>{let t={...m.value,page:e};m.value=t,Z(t),$(t,!1)},X=e=>{let t={...m.value,per_page:e,page:1};m.value=t,Z(t),$(t,!1)},Z=(e,t=!1)=>{let i={...r.query};Object.entries(e).forEach(([e,t])=>{t!=null&&t!==``?i[e]=String(t):delete i[e]});let a=t?`replace`:`push`;n[a]({query:i})},re=()=>{n.replace({query:{}})},Q=()=>{let e={per_page:50};m.value={...e,...D.value}},$=async(e,t=!0)=>{t&&e&&Z(e),await O(e)},ie=()=>{i.value=[],a.value=null,o.value=[],l.value=d(),m.value={per_page:50},f.value=!1};return e(()=>r.query,async()=>{if(Q(),r.name&&r.name.toString().includes(`sale-order`))try{await O(m.value)}catch(e){console.error(`Error fetching sale orders on URL change:`,e)}},{immediate:!1,deep:!0}),{saleOrders:i,currentSaleOrder:a,trashedOrders:o,pagination:l,loading:f,filters:m,ordersByPrefix:h,ordersByCustomer:g,ordersByCurrency:ee,ordersByWarehouse:te,ordersBySalesperson:_,ordersByStatus:v,waitingOrders:y,shippedOrders:b,deliveredOrders:x,totalOrderAmount:S,totalOrderAmountUSD:C,totalOrderProfit:w,ordersByDateRange:T,orderStats:E,urlParams:D,fetchSaleOrders:O,fetchSaleOrder:k,createSaleOrder:A,updateSaleOrder:j,deleteSaleOrder:M,fetchTrashedOrders:N,restoreOrder:P,forceDeleteOrder:F,approveOrder:I,searchOrders:L,getOrdersByCustomer:R,getOrdersByCurrency:z,getOrdersByWarehouse:ne,getOrdersByPrefix:B,getOrdersBySalesperson:V,getOrdersByDateRange:H,getOrderStats:U,updateFilters:W,clearFilters:G,clearCurrentOrder:K,setSearch:q,setSort:J,setPage:Y,setPerPage:X,updateUrlParams:Z,clearUrlParams:re,syncFiltersWithUrl:Q,fetchData:$,reset:ie}});export{m as b};