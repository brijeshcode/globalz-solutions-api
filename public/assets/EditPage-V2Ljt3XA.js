import{D as e,K as t,aA as ee,aG as te,aH as n,aK as ne,aL as re,aO as r,aP as ie,aQ as i,aR as a,aT as o,aU as s,aV as c,aX as ae,aZ as l,a_ as u,ah as oe,av as se,az as ce,b5 as d,b6 as f,b7 as p,b8 as m,bb as h,p as le,q as ue}from"./index-KopOJhzy.js";import"./GlobalConfig-Dep5CV3r.js";import"./tableUtils-jdfVzp2e.js";import{f as g}from"./common-CAcZd9q3.js";import{b as _}from"./commissionTargetStore-B7gpTAco.js";const v={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},y={class:``},b={class:`mb-8`},x={class:`flex items-center space-x-4 mb-2`},S={key:0,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-8`},C={class:`flex flex-col items-center justify-center`},w={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg`},T={class:`px-6 py-8`},E={class:`border-b border-gray-200 dark:border-gray-700 pb-6`},D={class:`grid grid-cols-1 md:grid-cols-3 gap-6`},O=[`disabled`],k={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},A=[`disabled`],j={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},M=[`disabled`],N={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},P={class:`mt-6`},F=[`disabled`],I={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},L={class:`border-b border-gray-200 dark:border-gray-700 pb-6`},R={class:`flex items-center justify-between mb-4`},z=[`disabled`],B={key:0,class:`text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600`},V={key:1,class:`space-y-4`},H={class:`flex items-center justify-between mb-4`},U={class:`text-sm font-medium text-gray-900 dark:text-white`},de=[`onClick`,`disabled`],fe={class:`grid grid-cols-1 md:grid-cols-5 gap-4`},pe=[`for`],me=[`id`,`onUpdate:modelValue`,`disabled`],he=[`for`],ge=[`id`,`onUpdate:modelValue`,`disabled`],_e=[`for`],ve=[`id`,`onUpdate:modelValue`,`disabled`],ye=[`for`],be=[`id`,`onUpdate:modelValue`,`disabled`],xe=[`for`],Se=[`id`,`onUpdate:modelValue`,`disabled`],Ce={class:`flex items-center justify-end space-x-4 pt-6`},we=[`disabled`],Te=[`disabled`];var W=c({__name:`EditPage`,setup(c){let W=ee(),G=ce(),K=se(),q=_(),J=p(!1),Y=p(!0),X=f({}),Z=p(0),Q=f({date:``,effective_date:``,name:``,note:null,rules:[]}),Ee=()=>{Q.rules.push({type:`sale`,minimum_amount:0,maximum_amount:0,percent:0,comission_label:``})},De=e=>e?`${e}-01`:``,Oe=e=>e?e.substring(0,7):``,ke=e=>{Q.rules.splice(e,1)},Ae=()=>{if(Object.keys(X).forEach(e=>delete X[e]),Q.date||(X.date=`Date is required`),Q.effective_date||(X.effective_date=`Effective date is required`),(!Q.name||Q.name.trim()===``)&&(X.name=`Target name is required`),Q.rules.length===0)return K.error(`Please add at least one commission rule`),!1;for(let e=0;e<Q.rules.length;e++){let t=Q.rules[e];if(!t.type)return K.error(`Rule #${e+1}: Type is required`),!1;if(t.minimum_amount===void 0||t.minimum_amount<0)return K.error(`Rule #${e+1}: Valid minimum amount is required`),!1;if(t.maximum_amount===void 0||t.maximum_amount<0)return K.error(`Rule #${e+1}: Valid maximum amount is required`),!1;if(t.minimum_amount>=t.maximum_amount)return K.error(`Rule #${e+1}: Maximum amount must be greater than minimum amount`),!1;if(t.percent===void 0||t.percent<0||t.percent>100)return K.error(`Rule #${e+1}: Percent must be between 0 and 100`),!1;if(!t.comission_label||t.comission_label.trim()===``)return K.error(`Rule #${e+1}: Label is required`),!1}return Object.keys(X).length===0},je=async()=>{try{Y.value=!0;let e=parseInt(G.params.id);if(isNaN(e)){K.error(`Invalid commission target ID`),W.push({name:`commission-targets.index`});return}Z.value=e;let t=await q.fetchCommissionTarget(e);Q.date=t.date.split(` `)[0],Q.effective_date=Oe(t.effective_date),Q.name=t.name,Q.note=t.note,Q.rules=t.rules.map(e=>({id:e.id,type:e.type,minimum_amount:Number(g(e.minimum_amount)),maximum_amount:Number(g(e.maximum_amount)),percent:Number(g(e.percent)),comission_label:e.comission_label}))}catch(e){console.error(`Error loading commission target:`,e),K.error(`Failed to load commission target`),W.push({name:`commission-targets.index`})}finally{Y.value=!1}},Me=async()=>{if(Ae()){J.value=!0;try{let e=Q.rules.map(e=>({...e})),t=De(Q.effective_date);await q.updateCommissionTarget(Z.value,{date:Q.date,effective_date:t,name:Q.name,note:Q.note,rules:e}),K.success(`Commission target updated successfully`),W.push({name:`commission-targets.index`})}catch(e){console.error(`Error updating commission target:`,e),e.response?.data?.errors&&Object.assign(X,e.response.data.errors),K.error(e.response?.data?.message||`Failed to update commission target`)}finally{J.value=!1}}},$=()=>{W.push({name:`commission-targets.index`})};return ae(()=>{je()}),(ee,c)=>(l(),a(`div`,v,[r(`div`,y,[r(`div`,b,[r(`div`,x,[r(`button`,{onClick:$,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[s(m(oe),{class:`w-5 h-5`})]),c[4]||=r(`div`,null,[r(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Edit Commission Target `),r(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Update commission target and rules `)],-1)])]),Y.value?(l(),a(`div`,S,[r(`div`,C,[s(m(t),{class:`h-8 w-8 animate-spin text-blue-600 dark:text-blue-400`}),c[5]||=r(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading commission target...`,-1)])])):(l(),a(`div`,w,[r(`div`,T,[r(`form`,{onSubmit:ne(Me,[`prevent`]),class:`space-y-6`},[r(`div`,E,[c[10]||=r(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-4`},` Basic Information `,-1),r(`div`,D,[r(`div`,null,[c[6]||=r(`label`,{for:`date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},[o(` Date `),r(`span`,{class:`text-red-500 ml-1`},`*`)],-1),d(r(`input`,{id:`date`,"onUpdate:modelValue":c[0]||=e=>Q.date=e,type:`date`,disabled:J.value,required:``,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,O),[[n,Q.date]]),X.date?(l(),a(`p`,k,h(X.date),1)):i(``,!0)]),r(`div`,null,[c[7]||=r(`label`,{for:`effective_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},[o(` Effective Date `),r(`span`,{class:`text-red-500 ml-1`},`*`)],-1),d(r(`input`,{id:`effective_date`,"onUpdate:modelValue":c[1]||=e=>Q.effective_date=e,type:`month`,disabled:J.value,required:``,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,A),[[n,Q.effective_date]]),X.effective_date?(l(),a(`p`,j,h(X.effective_date),1)):i(``,!0)]),r(`div`,null,[c[8]||=r(`label`,{for:`name`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},[o(` Target Name `),r(`span`,{class:`text-red-500 ml-1`},`*`)],-1),d(r(`input`,{id:`name`,"onUpdate:modelValue":c[2]||=e=>Q.name=e,type:`text`,placeholder:`Enter target name`,disabled:J.value,required:``,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,M),[[n,Q.name]]),X.name?(l(),a(`p`,N,h(X.name),1)):i(``,!0)])]),r(`div`,P,[c[9]||=r(`label`,{for:`note`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Note `,-1),d(r(`textarea`,{id:`note`,"onUpdate:modelValue":c[3]||=e=>Q.note=e,rows:`3`,placeholder:`Add any additional notes or comments...`,disabled:J.value,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,F),[[n,Q.note]]),X.note?(l(),a(`p`,I,h(X.note),1)):i(``,!0)])]),r(`div`,L,[r(`div`,R,[c[12]||=r(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white`},` Commission Rules `,-1),r(`button`,{type:`button`,onClick:Ee,disabled:J.value,class:`inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[s(m(e),{class:`w-4 h-4 mr-2`}),c[11]||=o(` Add Rule `,-1)],8,z)]),Q.rules.length===0?(l(),a(`div`,B,[s(m(ue),{class:`mx-auto h-12 w-12 text-gray-400`}),c[13]||=r(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`No rules added yet`,-1),c[14]||=r(`p`,{class:`text-xs text-gray-400 dark:text-gray-500 mt-1`},`Click "Add Rule" to create commission rules`,-1)])):(l(),a(`div`,V,[(l(!0),a(re,null,u(Q.rules,(e,t)=>(l(),a(`div`,{key:t,class:`bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-600`},[r(`div`,H,[r(`h4`,U,` Rule #`+h(t+1),1),r(`button`,{type:`button`,onClick:e=>ke(t),disabled:J.value,class:`text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`,title:`Remove rule`},[s(m(le),{class:`w-4 h-4`})],8,de)]),r(`div`,fe,[r(`div`,null,[r(`label`,{for:`rule_type_${t}`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},c[15]||=[o(` Type `,-1),r(`span`,{class:`text-red-500`},`*`,-1)],8,pe),d(r(`select`,{id:`rule_type_${t}`,"onUpdate:modelValue":t=>e.type=t,required:``,disabled:J.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`},c[16]||=[r(`option`,{value:``},`Select Type`,-1),r(`option`,{value:`sale`},`Sale`,-1),r(`option`,{value:`payment`},`Payment`,-1),r(`option`,{value:`fuel`},`Fuel`,-1)],8,me),[[te,e.type]])]),r(`div`,null,[r(`label`,{for:`rule_min_${t}`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},c[17]||=[o(` Min Amount `,-1),r(`span`,{class:`text-red-500`},`*`,-1)],8,he),d(r(`input`,{id:`rule_min_${t}`,"onUpdate:modelValue":t=>e.minimum_amount=t,type:`number`,step:`0.01`,min:`0`,placeholder:`0.00`,required:``,disabled:J.value,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,ge),[[n,e.minimum_amount,void 0,{number:!0}]])]),r(`div`,null,[r(`label`,{for:`rule_max_${t}`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},c[18]||=[o(` Max Amount `,-1),r(`span`,{class:`text-red-500`},`*`,-1)],8,_e),d(r(`input`,{id:`rule_max_${t}`,"onUpdate:modelValue":t=>e.maximum_amount=t,type:`number`,step:`0.01`,min:`0`,placeholder:`0.00`,required:``,disabled:J.value,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,ve),[[n,e.maximum_amount,void 0,{number:!0}]])]),r(`div`,null,[r(`label`,{for:`rule_percent_${t}`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},c[19]||=[o(` Percent (%) `,-1),r(`span`,{class:`text-red-500`},`*`,-1)],8,ye),d(r(`input`,{id:`rule_percent_${t}`,"onUpdate:modelValue":t=>e.percent=t,type:`number`,step:`0.01`,min:`0`,max:`100`,placeholder:`0.00`,required:``,disabled:J.value,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,be),[[n,e.percent,void 0,{number:!0}]])]),r(`div`,null,[r(`label`,{for:`rule_label_${t}`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},c[20]||=[o(` Label `,-1),r(`span`,{class:`text-red-500`},`*`,-1)],8,xe),d(r(`input`,{id:`rule_label_${t}`,"onUpdate:modelValue":t=>e.comission_label=t,type:`text`,placeholder:`Enter label`,required:``,disabled:J.value,class:`block w-full rounded-md border-0 py-2 px-3 text-gray-900 dark:text-gray-100 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm transition-colors duration-200 bg-white dark:bg-gray-700`},null,8,Se),[[n,e.comission_label]])])])]))),128))]))]),r(`div`,Ce,[r(`button`,{type:`button`,onClick:$,disabled:J.value,class:`px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},` Cancel `,8,we),r(`button`,{type:`submit`,disabled:J.value||Q.rules.length===0,class:`inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[J.value?(l(),ie(m(t),{key:0,class:`animate-spin -ml-1 mr-2 h-4 w-4`})):i(``,!0),o(` `+h(J.value?`Updating...`:`Update Commission Target`),1)],8,Te)])],32)])]))])]))}}),G=W;export{G as default};