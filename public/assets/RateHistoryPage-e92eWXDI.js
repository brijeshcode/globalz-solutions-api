import{K as e,a5 as t,a6 as n,a7 as r,a8 as i,aA as ee,aG as a,aH as o,aL as s,aN as c,aO as l,aP as te,aQ as u,aR as d,aT as f,aU as p,aV as ne,aX as re,aZ as m,a_ as h,av as ie,az as ae,b4 as g,b5 as _,b7 as v,b8 as y,b9 as b,bb as x,n as oe}from"./index-CNeTYLu9.js";import"./GlobalConfig-wPgXFcZ5.js";import"./tableUtils-CjmxvXEY.js";import{b as se}from"./PageHeader-BFS4kY3y.js";import{b as ce}from"./Modal-D-EVXvU6.js";import{c as le}from"./currenciesStore-BKJXmJJD.js";import{b as ue}from"./SimpleButton-D4NJ0Po9.js";const de={class:`space-y-6`},fe={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},pe={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},me=[`value`],he={class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},ge={key:0,class:`p-8 text-center`},_e={key:1,class:`p-8 text-center`},ve={key:2,class:`overflow-x-auto`},ye={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},be={class:`bg-gray-50 dark:bg-gray-700`},xe={class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},S={class:`flex flex-col`},C={class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},w={class:`flex flex-col`},T={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},E={class:`px-6 py-4 whitespace-nowrap`},D={class:`text-sm font-medium text-gray-900 dark:text-white`},O={class:`px-6 py-4 whitespace-nowrap`},k={class:`text-sm font-medium text-gray-900 dark:text-white`},A={class:`px-6 py-4 whitespace-nowrap`},j={class:`px-6 py-4 whitespace-nowrap`},M={class:`text-sm text-gray-900 dark:text-gray-300`},Se={key:3,class:`bg-white dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6`},Ce={class:`flex items-center justify-between`},we={class:`flex-1 flex justify-between sm:hidden`},Te=[`disabled`],Ee=[`disabled`],De={class:`hidden sm:flex-1 sm:flex sm:items-center sm:justify-between`},Oe={class:`text-sm text-gray-700 dark:text-gray-300`},ke={class:`font-medium`},Ae={class:`font-medium`},je={class:`font-medium`},Me={class:`relative z-0 inline-flex rounded-md shadow-sm -space-x-px`,"aria-label":`Pagination`},Ne=[`disabled`],Pe=[`disabled`],Fe={class:`space-y-4`},Ie={class:`max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg`},Le={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Re={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},ze={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white`},Be={class:`px-6 py-4 whitespace-nowrap`},N={class:`flex items-center`},Ve={class:`flex-shrink-0 h-8 w-8`},He={class:`h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center`},Ue={class:`text-xs font-semibold text-green-600 dark:text-green-400`},We={class:`ml-3`},Ge={class:`text-sm font-medium text-gray-900 dark:text-white`},Ke={class:`text-sm text-gray-500 dark:text-gray-400`},qe={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400`},Je={class:`px-6 py-4 whitespace-nowrap`},Ye=[`value`,`placeholder`,`onInput`],Xe={class:`flex justify-end space-x-3 pt-4`},Ze=[`disabled`];var P=ne({__name:`RateHistoryPage`,setup(ne){let P=ee();ae();let F=le(),I=ie(),L=v(!1),R=v(!1),z=v([]),B=v([]),V=v(!1),H=v(!1),U=v({}),W=v({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),G=v({page:1,per_page:15,sort_by:`created_at`,sort_direction:`desc`,currency_id:``,date_from:``,date_to:``}),K=c(()=>B.value.filter(e=>e.code!==`USD`&&e.id!==1)),q=c(()=>Object.values(U.value).some(e=>e>0)),J=async()=>{try{L.value=!0;let e=new URLSearchParams;Object.entries(G.value).forEach(([t,n])=>{n&&e.set(t,String(n))}),P.push({query:Object.fromEntries(e)});let t=await F.getRateHistory(G.value.currency_id||null,G.value);z.value=t.data,console.log(z.value),W.value=t.pagination}catch(e){console.error(`Error fetching rate history:`,e),I.error(`Failed to load rate history`)}finally{L.value=!1}},Y=e=>{G.value.sort_by===e?G.value.sort_direction=G.value.sort_direction===`asc`?`desc`:`asc`:(G.value.sort_by=e,G.value.sort_direction=`asc`),J()},X=e=>{e>=1&&e<=W.value.last_page&&(G.value.page=e,J())},Qe=e=>{if(!e)return`N/A`;try{let t=new Date(e);return t.toLocaleString(`en-US`,{month:`short`,day:`2-digit`,year:`numeric`,hour:`2-digit`,minute:`2-digit`})}catch{return e}},Z=e=>{if(!e)return`0`;let t=typeof e==`string`?parseFloat(e):e;return Math.abs(t)<1e-6?t.toFixed(20).replace(/\.?0+$/,``):t.toString()},Q=async()=>{try{R.value=!0,await F.fetchCurrencies({per_page:1e3}),B.value=F.currencies}catch(e){console.error(`Error loading currencies:`,e),I.error(`Failed to load currencies`)}finally{R.value=!1}},$e=e=>{let t=B.value.find(t=>t.id===e);return t?.current_rate?Z(t.current_rate):null},et=()=>{let e={};K.value.forEach(t=>{if(t.current_rate){let n=typeof t.current_rate==`string`?parseFloat(t.current_rate):t.current_rate;e[t.id]=n}else e[t.id]=0}),U.value=e},tt=(e,t)=>{let n=t.target,r=n.value.trim();if(r===``||r===null){U.value[e]=0;return}let i=parseFloat(r);isNaN(i)||(U.value[e]=i)},nt=()=>{V.value=!0,et()},$=()=>{V.value=!1,U.value={}},rt=async()=>{if(q.value)try{H.value=!0;let e=Object.entries(U.value).filter(([e,t])=>t>0).map(([e,t])=>({currency_id:parseInt(e),rate:t}));await F.changeRates(e),await Q(),await J(),$()}catch{I.error(`Failed to update currency rates`)}finally{H.value=!1}};return re(async()=>{let e=new URLSearchParams(window.location.search);e.forEach((e,t)=>{t in G.value&&(G.value[t]=e)}),await Q(),await J()}),(ee,c)=>(m(),d(`div`,de,[p(se,{title:`Exchange Rate History`,description:`View rate change history for all currencies`},{actions:g(()=>[p(ue,{onClick:nt},{default:g(()=>c[10]||=[f(`Change Rate`,-1)]),_:1,__:[10]})]),_:1}),l(`div`,fe,[l(`div`,pe,[l(`div`,null,[c[12]||=l(`label`,{for:`currency_id`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Currency `,-1),_(l(`select`,{id:`currency_id`,"onUpdate:modelValue":c[0]||=e=>G.value.currency_id=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:J},[c[11]||=l(`option`,{value:``},`All Currencies`,-1),(m(!0),d(s,null,h(B.value,e=>(m(),d(`option`,{key:e.id,value:e.id},x(e.name)+` (`+x(e.code)+`) `,9,me))),128))],544),[[a,G.value.currency_id]])]),l(`div`,null,[c[13]||=l(`label`,{for:`date_from`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Date From `,-1),_(l(`input`,{id:`date_from`,"onUpdate:modelValue":c[1]||=e=>G.value.date_from=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:J},null,544),[[o,G.value.date_from]])]),l(`div`,null,[c[14]||=l(`label`,{for:`date_to`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Date To `,-1),_(l(`input`,{id:`date_to`,"onUpdate:modelValue":c[2]||=e=>G.value.date_to=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:J},null,544),[[o,G.value.date_to]])]),l(`div`,null,[c[16]||=l(`label`,{for:`per-page`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Per Page `,-1),_(l(`select`,{id:`per-page`,"onUpdate:modelValue":c[3]||=e=>G.value.per_page=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:J},c[15]||=[l(`option`,{value:15},`15`,-1),l(`option`,{value:25},`25`,-1),l(`option`,{value:50},`50`,-1),l(`option`,{value:100},`100`,-1)],544),[[a,G.value.per_page]])])])]),l(`div`,he,[L.value?(m(),d(`div`,ge,[p(y(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),c[17]||=l(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading rate history...`,-1)])):z.value.length===0?(m(),d(`div`,_e,[p(y(oe),{class:`h-12 w-12 mx-auto text-gray-400`}),c[18]||=l(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No rate history found `,-1),c[19]||=l(`p`,{class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},` No rate changes recorded for this currency. `,-1)])):(m(),d(`div`,ve,[l(`table`,ye,[l(`thead`,be,[l(`tr`,null,[c[22]||=l(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Currency `,-1),l(`th`,xe,[l(`button`,{onClick:c[4]||=e=>Y(`rate`),class:`flex items-center space-x-1 hover:text-gray-700 dark:hover:text-gray-100 transition-colors duration-200`},[c[20]||=l(`span`,null,`Rate`,-1),l(`div`,S,[p(y(t),{class:b([`h-3 w-3`,G.value.sort_by===`rate`&&G.value.sort_direction===`asc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`]),p(y(i),{class:b([`h-3 w-3 -mt-1`,G.value.sort_by===`rate`&&G.value.sort_direction===`desc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`])])])]),c[23]||=l(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Status `,-1),l(`th`,C,[l(`button`,{onClick:c[5]||=e=>Y(`created_at`),class:`flex items-center space-x-1 hover:text-gray-700 dark:hover:text-gray-100 transition-colors duration-200`},[c[21]||=l(`span`,null,`Date`,-1),l(`div`,w,[p(y(t),{class:b([`h-3 w-3`,G.value.sort_by===`created_at`&&G.value.sort_direction===`asc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`]),p(y(i),{class:b([`h-3 w-3 -mt-1`,G.value.sort_by===`created_at`&&G.value.sort_direction===`desc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`])])])])])]),l(`tbody`,T,[(m(!0),d(s,null,h(z.value,e=>(m(),d(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150`},[l(`td`,E,[l(`div`,D,x(e.currency?.name)+` (`+x(e.currency?.code)+`) `,1)]),l(`td`,O,[l(`div`,k,x(Z(e.rate)),1)]),l(`td`,A,[l(`span`,{class:b([`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full`,e.is_active?`bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`:`bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300`])},x(e.is_active?`Current`:`Old`),3)]),l(`td`,j,[l(`div`,M,x(Qe(e.created_at)),1)])]))),128))])])])),!L.value&&z.value.length>0?(m(),d(`div`,Se,[l(`div`,Ce,[l(`div`,we,[l(`button`,{onClick:c[6]||=e=>X(W.value.current_page-1),disabled:W.value.current_page===1,class:`relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},` Previous `,8,Te),l(`button`,{onClick:c[7]||=e=>X(W.value.current_page+1),disabled:W.value.current_page===W.value.last_page,class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},` Next `,8,Ee)]),l(`div`,De,[l(`div`,null,[l(`p`,Oe,[c[24]||=f(` Showing `,-1),l(`span`,ke,x(W.value.from||0),1),c[25]||=f(` to `,-1),l(`span`,Ae,x(W.value.to||0),1),c[26]||=f(` of `,-1),l(`span`,je,x(W.value.total||0),1),c[27]||=f(` results `,-1)])]),l(`div`,null,[l(`nav`,Me,[l(`button`,{onClick:c[8]||=e=>X(W.value.current_page-1),disabled:W.value.current_page===1,class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[c[28]||=l(`span`,{class:`sr-only`},`Previous`,-1),p(y(r),{class:`h-5 w-5`})],8,Ne),l(`button`,{onClick:c[9]||=e=>X(W.value.current_page+1),disabled:W.value.current_page===W.value.last_page,class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[c[29]||=l(`span`,{class:`sr-only`},`Next`,-1),p(y(n),{class:`h-5 w-5`})],8,Pe)])])])])])):u(``,!0)]),p(ce,{title:`Currency rate to USD`,modelValue:V.value,onClose:$,size:`2xl`,showCloseButton:!0,closeOnEscape:!1},{default:g(()=>[l(`div`,Fe,[c[31]||=l(`div`,{class:`bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4`},[l(`div`,{class:`flex items-center`},[l(`div`,{class:`flex-shrink-0`},[l(`svg`,{class:`h-5 w-5 text-blue-400`,fill:`currentColor`,viewBox:`0 0 20 20`},[l(`path`,{"fill-rule":`evenodd`,d:`M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z`,"clip-rule":`evenodd`})])]),l(`div`,{class:`ml-3`},[l(`p`,{class:`text-sm text-blue-800 dark:text-blue-200`},[l(`strong`,null,`Note:`),f(` All rates are relative to USD. Enter the exchange rate for 1 USD to the respective currency. `)])])])],-1),l(`div`,Ie,[l(`table`,Le,[c[30]||=l(`thead`,{class:`bg-gray-50 dark:bg-gray-700 sticky top-0 z-10`},[l(`tr`,null,[l(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` # `),l(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Currency `),l(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Current Rate `),l(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` New Rate (1 USD =) `)])],-1),l(`tbody`,Re,[(m(!0),d(s,null,h(K.value,(e,t)=>(m(),d(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[l(`td`,ze,x(t+1),1),l(`td`,Be,[l(`div`,N,[l(`div`,Ve,[l(`div`,He,[l(`span`,Ue,x(e.code.substring(0,2)),1)])]),l(`div`,We,[l(`div`,Ge,x(e.name),1),l(`div`,Ke,x(e.code),1)])])]),l(`td`,qe,x($e(e.id)||`Not set`),1),l(`td`,Je,[l(`input`,{value:Z(U.value[e.id]),type:`text`,placeholder:`Enter rate for ${e.name}`,onInput:t=>tt(e.id,t),class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm`},null,40,Ye)])]))),128))])])]),l(`div`,Xe,[l(`button`,{onClick:$,type:`button`,class:`px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200`},` Cancel `),l(`button`,{onClick:rt,disabled:H.value||!q.value,type:`button`,class:`inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[H.value?(m(),te(y(e),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):u(``,!0),f(` `+x(H.value?`Updating...`:`Update Rates`),1)],8,Ze)])])]),_:1},8,[`modelValue`])]))}}),F=P;export{F as default};