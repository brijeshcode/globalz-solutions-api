import{a$ as e,aI as t,aJ as ee,aM as te,aN as ne,aP as n,aQ as r,aR as re,aS as i,aT as a,aV as o,aW as ie,aX as s,aZ as ae,ab as c,ax as l,b0 as u,b5 as d,b6 as f,b7 as p,b9 as m,ba as h,bd as g}from"./index-BtPw0N95.js";import{b as oe}from"./useAuth-vh2YsVqv.js";import{c as se}from"./common-qdv5PS_C.js";import{b as ce}from"./Modal-BLk-vBif.js";import{b as le}from"./accountsStore-OLyi6QsD.js";import{b as _}from"./currencyUtil-Ciu0r-gB.js";import{b as ue}from"./customerPaymentOrdersStore-JGt9m0gc.js";import{b as v}from"./usersStore-QeMlPjpj.js";const y={key:0,class:`space-y-6`},b={class:`bg-gray-50 dark:bg-gray-700 rounded-lg p-4`},x={class:`grid grid-cols-1 md:grid-cols-2 gap-4 text-sm`},S={class:`ml-2 font-medium text-gray-900 dark:text-white`},C={class:`ml-2 font-medium text-gray-900 dark:text-white`},w={class:`ml-2 font-medium text-gray-900 dark:text-white`},T={class:`ml-2 font-medium text-gray-900 dark:text-white`},E={class:`ml-2 font-medium text-gray-900 dark:text-white`},D={class:`ml-2 font-medium text-gray-900 dark:text-white`},O={key:0,class:`mt-3`},k={class:`mt-1 text-sm text-gray-900 dark:text-white`},A={class:`grid grid-cols-1 gap-4`},j=[`disabled`],M=[`value`],N={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},P=[`disabled`],F={key:0,class:`mt-1 text-sm text-red-600 dark:text-red-400`},I={class:`flex items-center justify-end space-x-3`},L=[`disabled`],de=[`disabled`],R={key:0,class:`flex items-center`},z={key:1,class:`flex items-center`};var B=s({__name:`CustomerPaymentApprove`,props:{show:{type:Boolean},paymentOrder:{}},emits:[`update:show`,`approved`],setup(s,{emit:B}){let V=s,H=B,fe=ue(),U=le(),W=v(),{user:G}=oe(),K=l(),q=m(!1),J=m({}),Y=m({account_id:null,approved_by:null,approve_note:``}),X=n({get:()=>V.show,set:e=>H(`update:show`,e)}),pe=n(()=>U.accounts);n(()=>W.users);let me=n(()=>Y.value.account_id&&Y.value.approved_by),Z=()=>{q.value||(Q(),H(`update:show`,!1))},Q=()=>{Y.value={account_id:null,approved_by:G.value?.id||null,approve_note:``},J.value={}},he=()=>(J.value={},Y.value.account_id||(J.value.account_id=`Account is required`),Y.value.approved_by||(J.value.approved_by=`Approved by user is required`),Object.keys(J.value).length===0),$=async()=>{if(!(!V.paymentOrder||!he()))try{q.value=!0;let e={account_id:Y.value.account_id,approve_note:Y.value.approve_note||void 0},t=await fe.approveOrder(V.paymentOrder.id,e);K.success(`Payment approved successfully`),H(`approved`,t),Z()}catch(e){console.error(`Error approving payment:`,e),e.response?.data?.errors?J.value=e.response.data.errors:K.error(e.response?.data?.message||`Failed to approve payment`)}finally{q.value=!1}},ge=async()=>{try{await Promise.all([U.fetchAccounts(),W.fetchUsers()])}catch(e){console.error(`Error loading required data:`,e)}};return d(()=>V.show,e=>{e&&(Q(),ge())}),ae(()=>{G.value&&(Y.value.approved_by=G.value.id)}),(n,s)=>(e(),re(ce,{modelValue:X.value,"onUpdate:modelValue":s[3]||=e=>X.value=e,title:`Approve Payment`,size:`lg`,loading:q.value,onClose:Z},{footer:f(()=>[r(`div`,I,[r(`button`,{type:`button`,onClick:Z,class:`inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 transition-colors duration-200`,disabled:q.value},` Cancel `,8,L),r(`button`,{type:`submit`,onClick:$,class:`inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md shadow-sm hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-900 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed`,disabled:q.value||!me.value},[q.value?(e(),a(`div`,R,s[17]||=[r(`svg`,{class:`animate-spin -ml-1 mr-2 h-4 w-4 text-white`,xmlns:`http://www.w3.org/2000/svg`,fill:`none`,viewBox:`0 0 24 24`},[r(`circle`,{class:`opacity-25`,cx:`12`,cy:`12`,r:`10`,stroke:`currentColor`,"stroke-width":`4`}),r(`path`,{class:`opacity-75`,fill:`currentColor`,d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z`})],-1),o(` Approving... `,-1)])):(e(),a(`div`,z,[ie(h(c),{class:`h-4 w-4 mr-2`}),s[18]||=o(` Approve Payment `,-1)]))],8,de)])]),default:f(()=>[n.paymentOrder?(e(),a(`div`,y,[r(`div`,b,[s[11]||=r(`h4`,{class:`text-sm font-medium text-gray-900 dark:text-white mb-3`},`Payment Order Details`,-1),r(`div`,x,[r(`div`,null,[s[4]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Code:`,-1),r(`span`,S,g(n.paymentOrder.prefix)+`-`+g(n.paymentOrder.code),1)]),r(`div`,null,[s[5]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Date:`,-1),r(`span`,C,g(h(se)(n.paymentOrder.date)),1)]),r(`div`,null,[s[6]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Customer:`,-1),r(`span`,w,g(n.paymentOrder.customer?.name||`N/A`),1)]),r(`div`,null,[s[7]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Amount:`,-1),r(`span`,T,g(h(_)(n.paymentOrder.amount,!0,n.paymentOrder.currency)),1)]),r(`div`,null,[s[8]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Amount USD:`,-1),r(`span`,E,g(h(_)(n.paymentOrder.amount_usd,!0)),1)]),r(`div`,null,[s[9]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Currency Rate:`,-1),r(`span`,D,g(n.paymentOrder.currency_rate),1)])]),n.paymentOrder.note?(e(),a(`div`,O,[s[10]||=r(`span`,{class:`text-gray-500 dark:text-gray-400`},`Note:`,-1),r(`p`,k,g(n.paymentOrder.note),1)])):i(``,!0)]),r(`form`,{onSubmit:te($,[`prevent`]),class:`space-y-4`},[r(`div`,A,[r(`div`,null,[s[13]||=r(`label`,{for:`account_id`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},[o(` Account `),r(`span`,{class:`text-red-500`},`*`)],-1),p(r(`select`,{id:`account_id`,"onUpdate:modelValue":s[0]||=e=>Y.value.account_id=e,required:``,class:`block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 sm:text-sm`,disabled:q.value},[s[12]||=r(`option`,{value:``},`Select Account`,-1),(e(!0),a(ne,null,u(pe.value,t=>(e(),a(`option`,{key:t.id,value:t.id},g(t.name),9,M))),128))],8,j),[[t,Y.value.account_id]]),J.value.account_id?(e(),a(`p`,N,g(J.value.account_id),1)):i(``,!0)]),i(``,!0)]),r(`div`,null,[s[16]||=r(`label`,{for:`approve_note`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Approval Note `,-1),p(r(`textarea`,{id:`approve_note`,"onUpdate:modelValue":s[2]||=e=>Y.value.approve_note=e,rows:`3`,class:`block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 sm:text-sm`,placeholder:`Optional approval note...`,disabled:q.value},null,8,P),[[ee,Y.value.approve_note]]),J.value.approve_note?(e(),a(`p`,F,g(J.value.approve_note),1)):i(``,!0)])],32)])):i(``,!0)]),_:1},8,[`modelValue`,`loading`]))}}),V=B;export{V as b};