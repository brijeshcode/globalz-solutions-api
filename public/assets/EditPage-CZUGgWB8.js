import{Q as e,a$ as t,aC as n,aG as r,aH as i,aN as ee,aR as te,aS as a,aU as o,aV as s,aX as c,aY as l,a_ as u,ao as ne,b0 as re,b3 as ie,b5 as d,b6 as f,b8 as ae,bb as oe,bd as se,bf as p,bg as m,bh as h,bj as g}from"./index-Bbnq3hOa.js";import"./GlobalConfig-wPgXFcZ5.js";import{f as _}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import{b as ce}from"./accountsStore-F_sgrGVW.js";import"./currencyUtil-CTYSvgFA.js";import{b as le}from"./employeesStore-wy6LefD-.js";import{b as ue}from"./salaryStore-B2YVuWAI.js";import{b as de,c as fe,d as pe}from"./EmployeeDailyBusinessBreadDown-D1WF-llu.js";const me={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},he={class:`mx-auto`},ge={class:`mb-8`},_e={class:`flex items-center space-x-4 mb-2`},v={key:0,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-8`},y={key:1,class:`grid grid-cols-12 gap-4`},b={class:`col-span-4`},x={class:`w-full border-collapse bg-white dark:bg-gray-800 rounded-lg overflow-hidden`},S={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},C={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},w={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},T={class:`px-3 py-2 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},E={class:`col-span-8`},D={key:0,class:`text-lg`},O={key:1},k={class:`flex items-center justify-between gap-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md`},A={class:`flex gap-3`},j={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},M={class:`block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1`},N={key:2},P={key:3,class:`bg-white mt-4 dark:bg-gray-800 shadow rounded-lg`},F={class:`p-6`},I={class:`mb-4 text-sm text-gray-700 dark:text-gray-300`},ve={class:`mb-1`},ye={class:`mb-1`},be={class:`mb-1`},xe={class:`w-full border-collapse mb-4`},Se={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ce={class:`px-3 py-2 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100`},we={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Te={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Ee={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},De={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Oe={class:`bg-gray-100 dark:bg-gray-700`},ke={class:`px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`},Ae={class:`px-3 py-2 rounded-md bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 font-semibold text-gray-900 dark:text-gray-100`},je={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Me=[`disabled`],Ne=[`value`],Pe={class:`px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600`},Fe={class:`flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700`},Ie=[`disabled`],Le=[`disabled`],Re={key:0,class:`flex items-center justify-center`},ze={key:1};var L=re({__name:`EditPage`,setup(re){let L=i(),R=r(),{showSuccess:Be,showError:z}=n(),B=o(()=>parseInt(R.params.id)),V=ue(),H=le(),U=ce(),W=p(!1),G=p(!1),K=p(!1),q=p(null),J=p({}),Y=p({date:``,salary_code:``,employee_id:0,account_id:0,month:0,base_salary:0,year:0,sub_total:0,advance_payment:0,others:0,final_total:0,others_note:``,note:``});o(()=>{let e=new Date().getFullYear(),t=[];for(let n=e-5;n<=e+1;n++)t.push(n);return t.reverse()});let Ve=o(()=>H.activeEmployees||[]),He=o(()=>U.activeAccounts||[]),Ue=o(()=>V.salaries);o(()=>Object.keys(J.value).length>0);let We=o(()=>{let e=Ve.value.find(e=>e.id===Y.value.employee_id);return e?e.name:``}),X=e=>{J.value={};for(let[t,n]of Object.entries(e))n&&n.length>0&&(J.value[t]=n[0])},Z=()=>{J.value={}},Q=()=>{let e=Number(Y.value.sub_total)||0,t=Number(Y.value.advance_payment)||0,n=Number(Y.value.others)||0,r=Number(Y.value.base_salary)||0;Y.value.final_total=e-t+n+r},$=async()=>{try{G.value=!0;let e=await V.fetchSalary(B.value);e&&(Y.value={date:e.date||``,salary_code:e.salary_code||``,employee_id:e.employee_id||0,base_salary:e.base_salary,account_id:e.account_id||0,month:e.month||0,year:e.year||0,sub_total:e.sub_total||0,advance_payment:e.advance_payment||0,others:e.others||0,final_total:e.final_total||0,others_note:e.others_note||``,note:e.note||``},Z(),e.employee_id&&(await Ge(e.employee_id),await Ke(e.employee_id,e.month,e.year)))}catch(e){console.error(`Error loading salary:`,e),z(`Failed to load salary record`)}finally{G.value=!1}},Ge=async e=>{try{await V.fetchSalaries({employee_id:e})}catch(e){console.error(`Failed to load salary history:`,e)}},Ke=async(e,t,n)=>{try{K.value=!0;let r=await pe.getMonthlyCommission({employee_id:e,month:t,year:n});q.value=r}catch(e){console.error(`Failed to load commission data:`,e)}finally{K.value=!1}},qe=()=>{Z();let e={};return Y.value.date||(e.date=`Date is required`),(!Y.value.employee_id||Y.value.employee_id<=0)&&(e.employee_id=`Employee is required`),(!Y.value.account_id||Y.value.account_id<=0)&&(e.account_id=`Account is required`),(!Y.value.month||Y.value.month<1||Y.value.month>12)&&(e.month=`Valid month is required`),(!Y.value.year||Y.value.year<2e3||Y.value.year>2100)&&(e.year=`Valid year is required`),(Y.value.sub_total===void 0||Y.value.sub_total<0)&&(e.sub_total=`Sub total must be 0 or greater`),(Y.value.advance_payment===void 0||Y.value.advance_payment<0)&&(e.advance_payment=`Advance payment must be 0 or greater`),Y.value.others===void 0&&(e.others=`Others amount is required`),Y.value.others_note&&Y.value.others_note.length>500&&(e.others_note=`Others note cannot exceed 500 characters`),Y.value.note&&Y.value.note.length>1e3&&(e.note=`Notes cannot exceed 1000 characters`),J.value=e,Object.keys(e).length===0},Je=async()=>{if(qe())try{W.value=!0;let e={date:Y.value.date,employee_id:Y.value.employee_id,account_id:Y.value.account_id,base_salary:Y.value.base_salary,month:Y.value.month,year:Y.value.year,sub_total:Y.value.sub_total,advance_payment:Y.value.advance_payment,others:Y.value.others,final_total:Y.value.final_total,others_note:Y.value.others_note||void 0,note:Y.value.note||void 0};await V.updateSalary(B.value,e),Be(`Salary updated successfully`),L.push({name:`employees.salaries.index`})}catch(e){e.response?.status===422&&e.response?.data?.errors?X(e.response.data.errors):z(e.response?.data?.message||`Failed to update salary`)}finally{W.value=!1}},Ye=()=>{L.push({name:`employees.salaries.index`})},Xe=()=>{L.push({name:`employees.salaries.index`})},Ze=async()=>{try{await H.fetchEmployees({is_active:!0})}catch(e){console.error(`Failed to load employees:`,e)}},Qe=async()=>{try{await U.fetchAccounts({is_active:!0})}catch(e){console.error(`Failed to load accounts:`,e)}};return ie(async()=>{try{G.value=!0,await Promise.all([Ze(),Qe()])}catch(e){console.error(`Error loading dropdown data:`,e)}finally{G.value=!1}await $()}),oe(()=>B.value,()=>{B.value&&$()}),(n,r)=>{let i=ae(`Input`);return d(),l(`div`,me,[s(`div`,he,[s(`div`,ge,[s(`div`,_e,[s(`button`,{onClick:Xe,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[t(m(ne),{class:`w-5 h-5`})]),r[6]||=s(`div`,null,[s(`h2`,{class:`text-2xl font-bold text-gray-900 dark:text-gray-100`},` Edit Employee Salary `),s(`p`,{class:`text-sm text-gray-600 dark:text-gray-400`},` Update salary record information and details `)],-1)])]),G.value?(d(),l(`div`,v,r[7]||=[s(`div`,{class:`flex items-center justify-center`},[s(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-4`}),s(`span`,{class:`text-gray-600 dark:text-gray-400`},`Loading salary...`)],-1)])):Y.value?(d(),l(`div`,y,[s(`div`,b,[r[9]||=s(`div`,{class:`mb-3 text-lg font-semibold text-gray-900 dark:text-gray-100`},`Salary History`,-1),s(`table`,x,[r[8]||=s(`thead`,{class:`bg-gray-100 dark:bg-gray-700`},[s(`tr`,null,[s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Month`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Comm.`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Adv.`),s(`th`,{class:`px-3 py-2 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Total`)])],-1),s(`tbody`,null,[(d(!0),l(a,null,f(Ue.value,e=>(d(),l(`tr`,{key:e.id,class:h([`hover:bg-gray-50 dark:hover:bg-gray-700`,{"bg-blue-50 dark:bg-blue-900/20":e.id===B.value}])},[s(`td`,S,g(e.month)+`/`+g(e.year),1),s(`td`,C,g(m(_)(e.sub_total)),1),s(`td`,w,g(m(_)(e.advance_payment)),1),s(`td`,T,g(m(_)(e.final_total)),1)],2))),128))])])]),s(`div`,E,[K.value?(d(),l(`div`,D,[t(m(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`})])):c(``,!0),q.value&&!K.value?(d(),l(`div`,O,[s(`div`,k,[s(`div`,null,` Employee: `+g(q.value?.business_summary.employee_name),1),s(`div`,A,[s(`div`,null,[s(`label`,j,`Month: `+g(Y.value.month),1)]),s(`div`,null,[s(`label`,M,`Year: `+g(Y.value.year),1)])])])])):c(``,!0),q.value&&!K.value?(d(),l(`div`,N,[s(`div`,null,[t(de,{class:`mt-4`,"commission-data":q.value},null,8,[`commission-data`]),t(fe,{class:`mt-4`,"commission-data":q.value},null,8,[`commission-data`])])])):c(``,!0),q.value&&!K.value?(d(),l(`div`,P,[s(`div`,F,[r[21]||=s(`h2`,{class:`text-xl font-semibold mb-4 pb-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white`},` Employee Salary Summary`,-1),s(`div`,I,[s(`div`,ve,[r[10]||=s(`strong`,null,`Employee:`,-1),u(` `+g(We.value),1)]),s(`div`,ye,[r[11]||=s(`strong`,null,`Period:`,-1),u(` Month `+g(Y.value.month)+` / Year `+g(Y.value.year),1)]),s(`div`,be,[r[12]||=s(`strong`,null,`Salary Code:`,-1),u(` `+g(Y.value.salary_code),1)])]),s(`form`,{onSubmit:te(Je,[`prevent`])},[s(`table`,xe,[s(`tbody`,null,[s(`tr`,null,[r[13]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Sub Total (total commission)`,-1),s(`td`,Se,[s(`div`,Ce,g(m(_)(Y.value.sub_total)),1)])]),s(`tr`,null,[r[14]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 w-2/5`},` Base Salary`,-1),s(`td`,we,[t(i,{type:`number`,onInput:Q,class:`w-full`,modelValue:Y.value.base_salary,"onUpdate:modelValue":r[0]||=e=>Y.value.base_salary=e},null,8,[`modelValue`])])]),s(`tr`,null,[r[15]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Advance Loan (-)`,-1),s(`td`,Te,[t(i,{type:`number`,onInput:Q,class:`w-full`,modelValue:Y.value.advance_payment,"onUpdate:modelValue":r[1]||=e=>Y.value.advance_payment=e},null,8,[`modelValue`])])]),s(`tr`,null,[s(`th`,{class:h([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other (bonus or deduction)`,2),s(`td`,Ee,[t(i,{type:`number`,onInput:Q,class:h([Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:Y.value.others,"onUpdate:modelValue":r[2]||=e=>Y.value.others=e},null,8,[`class`,`modelValue`])])]),s(`tr`,null,[s(`th`,{class:h([`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600`,Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:`text-gray-700 dark:text-gray-300`])},` Other Notes`,2),s(`td`,De,[t(i,{type:`text`,class:h([Y.value.others&&Y.value.others<0?`text-red-600 dark:text-red-400`:``,`w-full`]),modelValue:Y.value.others_note,"onUpdate:modelValue":r[3]||=e=>Y.value.others_note=e,placeholder:`Other note`},null,8,[`class`,`modelValue`])])]),s(`tr`,Oe,[r[16]||=s(`th`,{class:`px-3 py-2 text-left font-bold text-base bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600`},` Net Total`,-1),s(`td`,ke,[s(`div`,Ae,g(m(_)(Y.value.final_total)),1)])]),s(`tr`,null,[r[18]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Account`,-1),s(`td`,je,[se(s(`select`,{id:`account_id`,"onUpdate:modelValue":r[4]||=e=>Y.value.account_id=e,disabled:W.value,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,required:``},[r[17]||=s(`option`,{value:``},`Select account`,-1),(d(!0),l(a,null,f(He.value,e=>(d(),l(`option`,{key:e.id,value:e.id},g(e.name),9,Ne))),128))],8,Me),[[ee,Y.value.account_id]])])]),s(`tr`,null,[r[19]||=s(`th`,{class:`px-3 py-2 text-left font-semibold bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600`},` Salary Note`,-1),s(`td`,Pe,[t(i,{type:`text`,class:`w-full`,modelValue:Y.value.note,"onUpdate:modelValue":r[5]||=e=>Y.value.note=e,placeholder:`Add any notes`},null,8,[`modelValue`])])])])]),s(`div`,Fe,[s(`button`,{type:`button`,onClick:Ye,disabled:W.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},` Cancel `,8,Ie),s(`button`,{type:`submit`,disabled:W.value,class:`w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`},[W.value?(d(),l(`div`,Re,r[20]||=[s(`div`,{class:`animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2`},null,-1),u(` Updating... `,-1)])):(d(),l(`span`,ze,`Update Salary`))],8,Le)])],32)])])):c(``,!0)])])):c(``,!0)])])}}}),R=L;export{R as default};