import{B as e,T as t,U as n,V as r,W as i,aB as a,aC as o,aD as ee,aF as s,aH as c,aI as l,aO as u,aP as d,aR as f,aS as p,aT as m,aV as h,ad as te,ah as ne,ai as re,ao as g,ap as _,at as v,av as y,aw as b,ax as ie,ay as x,az as S,k as ae}from"./index-BDpughmq.js";import"./GlobalConfig-Dep5CV3r.js";import"./tableUtils-jdfVzp2e.js";import{c as oe}from"./currenciesStore-rZ_O60T5.js";import{b as se}from"./PageHeader-BwSQDnhd.js";import{b as ce}from"./Modal-BcCsT0D_.js";import{b as le}from"./SimpleButton-BF8dOYxD.js";const ue={class:`space-y-6`},de={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},fe={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},pe=[`value`],me={class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},he={key:0,class:`p-8 text-center`},ge={key:1,class:`p-8 text-center`},_e={key:2,class:`overflow-x-auto`},ve={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},ye={class:`bg-gray-50 dark:bg-gray-700`},be={class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},C={class:`flex flex-col`},w={class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},T={class:`flex flex-col`},E={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},D={class:`px-6 py-4 whitespace-nowrap`},O={class:`text-sm font-medium text-gray-900 dark:text-white`},k={class:`px-6 py-4 whitespace-nowrap`},A={class:`text-sm font-medium text-gray-900 dark:text-white`},j={class:`px-6 py-4 whitespace-nowrap`},M={class:`px-6 py-4 whitespace-nowrap`},N={class:`text-sm text-gray-900 dark:text-gray-300`},xe={key:3,class:`bg-white dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6`},Se={class:`flex items-center justify-between`},Ce={class:`flex-1 flex justify-between sm:hidden`},we=[`disabled`],Te=[`disabled`],Ee={class:`hidden sm:flex-1 sm:flex sm:items-center sm:justify-between`},De={class:`text-sm text-gray-700 dark:text-gray-300`},Oe={class:`font-medium`},ke={class:`font-medium`},Ae={class:`font-medium`},je={class:`relative z-0 inline-flex rounded-md shadow-sm -space-x-px`,"aria-label":`Pagination`},Me=[`disabled`],Ne=[`disabled`],Pe={class:`space-y-4`},Fe={class:`max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg`},Ie={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Le={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Re={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white`},P={class:`px-6 py-4 whitespace-nowrap`},ze={class:`flex items-center`},Be={class:`flex-shrink-0 h-8 w-8`},Ve={class:`h-8 w-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center`},He={class:`text-xs font-semibold text-green-600 dark:text-green-400`},Ue={class:`ml-3`},We={class:`text-sm font-medium text-gray-900 dark:text-white`},Ge={class:`text-sm text-gray-500 dark:text-gray-400`},Ke={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400`},qe={class:`px-6 py-4 whitespace-nowrap`},Je=[`onUpdate:modelValue`,`placeholder`,`onInput`],Ye={class:`flex justify-end space-x-3 pt-4`},Xe=[`disabled`];var F=ee({__name:`RateHistoryPage`,setup(ee){let F=re();ne();let I=oe(),L=te(),R=f(!1),z=f(!1),B=f([]),V=f([]),H=f(!1),U=f(!1),W=f({}),G=f({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),K=f({page:1,per_page:15,sort_by:`created_at`,sort_direction:`desc`,currency_id:``,date_from:``,date_to:``}),q=y(()=>V.value.filter(e=>e.code!==`USD`&&e.id!==1)),J=y(()=>Object.values(W.value).some(e=>e>0)),Y=async()=>{try{R.value=!0;let e=new URLSearchParams;Object.entries(K.value).forEach(([t,n])=>{n&&e.set(t,String(n))}),F.push({query:Object.fromEntries(e)});let t=await I.getRateHistory(K.value.currency_id||null,K.value);B.value=t.data,console.log(B.value),G.value=t.pagination}catch(e){console.error(`Error fetching rate history:`,e),L.error(`Failed to load rate history`)}finally{R.value=!1}},X=e=>{K.value.sort_by===e?K.value.sort_direction=K.value.sort_direction===`asc`?`desc`:`asc`:(K.value.sort_by=e,K.value.sort_direction=`asc`),Y()},Z=e=>{e>=1&&e<=G.value.last_page&&(K.value.page=e,Y())},Ze=e=>{if(!e)return`N/A`;try{let t=new Date(e);return t.toLocaleString(`en-US`,{month:`short`,day:`2-digit`,year:`numeric`,hour:`2-digit`,minute:`2-digit`})}catch{return e}},Qe=e=>Number(e).toFixed(6),Q=async()=>{try{z.value=!0,await I.fetchCurrencies({per_page:1e3}),V.value=I.currencies}catch(e){console.error(`Error loading currencies:`,e),L.error(`Failed to load currencies`)}finally{z.value=!1}},$e=e=>{let t=V.value.find(t=>t.id===e);return t?.current_rate?parseFloat(parseFloat(t.current_rate).toFixed(4)):null},et=()=>{let e={};q.value.forEach(t=>{e[t.id]=t.current_rate?parseFloat(parseFloat(t.current_rate).toFixed(4)):0}),W.value=e},tt=(e,t)=>{let n=t.target,r=parseFloat(n.value);isNaN(r)||(W.value[e]=parseFloat(r.toFixed(4)))},nt=()=>{H.value=!0,et()},$=()=>{H.value=!1,W.value={}},rt=async()=>{if(J.value)try{U.value=!0;let e=Object.entries(W.value).filter(([e,t])=>t>0).map(([e,t])=>({currency_id:parseInt(e),rate:t}));await I.changeRates(e),await Q(),await Y(),$()}catch{L.error(`Failed to update currency rates`)}finally{U.value=!1}};return s(async()=>{let e=new URLSearchParams(window.location.search);e.forEach((e,t)=>{t in K.value&&(K.value[t]=e)}),await Q(),await Y()}),(ee,s)=>(c(),S(`div`,ue,[o(se,{title:`Exchange Rate History`,description:`View rate change history for all currencies`},{actions:u(()=>[o(le,{onClick:nt},{default:u(()=>s[10]||=[a(`Change Rate`,-1)]),_:1,__:[10]})]),_:1}),b(`div`,de,[b(`div`,fe,[b(`div`,null,[s[12]||=b(`label`,{for:`currency_id`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Currency `,-1),d(b(`select`,{id:`currency_id`,"onUpdate:modelValue":s[0]||=e=>K.value.currency_id=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Y},[s[11]||=b(`option`,{value:``},`All Currencies`,-1),(c(!0),S(v,null,l(V.value,e=>(c(),S(`option`,{key:e.id,value:e.id},h(e.name)+` (`+h(e.code)+`) `,9,pe))),128))],544),[[g,K.value.currency_id]])]),b(`div`,null,[s[13]||=b(`label`,{for:`date_from`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Date From `,-1),d(b(`input`,{id:`date_from`,"onUpdate:modelValue":s[1]||=e=>K.value.date_from=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Y},null,544),[[_,K.value.date_from]])]),b(`div`,null,[s[14]||=b(`label`,{for:`date_to`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Date To `,-1),d(b(`input`,{id:`date_to`,"onUpdate:modelValue":s[2]||=e=>K.value.date_to=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Y},null,544),[[_,K.value.date_to]])]),b(`div`,null,[s[16]||=b(`label`,{for:`per-page`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Per Page `,-1),d(b(`select`,{id:`per-page`,"onUpdate:modelValue":s[3]||=e=>K.value.per_page=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Y},s[15]||=[b(`option`,{value:15},`15`,-1),b(`option`,{value:25},`25`,-1),b(`option`,{value:50},`50`,-1),b(`option`,{value:100},`100`,-1)],544),[[g,K.value.per_page]])])])]),b(`div`,me,[R.value?(c(),S(`div`,he,[o(p(e),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),s[17]||=b(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading rate history...`,-1)])):B.value.length===0?(c(),S(`div`,ge,[o(p(ae),{class:`h-12 w-12 mx-auto text-gray-400`}),s[18]||=b(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No rate history found `,-1),s[19]||=b(`p`,{class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},` No rate changes recorded for this currency. `,-1)])):(c(),S(`div`,_e,[b(`table`,ve,[b(`thead`,ye,[b(`tr`,null,[s[22]||=b(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Currency `,-1),b(`th`,be,[b(`button`,{onClick:s[4]||=e=>X(`rate`),class:`flex items-center space-x-1 hover:text-gray-700 dark:hover:text-gray-100 transition-colors duration-200`},[s[20]||=b(`span`,null,`Rate`,-1),b(`div`,C,[o(p(t),{class:m([`h-3 w-3`,K.value.sort_by===`rate`&&K.value.sort_direction===`asc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`]),o(p(i),{class:m([`h-3 w-3 -mt-1`,K.value.sort_by===`rate`&&K.value.sort_direction===`desc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`])])])]),s[23]||=b(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Status `,-1),b(`th`,w,[b(`button`,{onClick:s[5]||=e=>X(`created_at`),class:`flex items-center space-x-1 hover:text-gray-700 dark:hover:text-gray-100 transition-colors duration-200`},[s[21]||=b(`span`,null,`Date`,-1),b(`div`,T,[o(p(t),{class:m([`h-3 w-3`,K.value.sort_by===`created_at`&&K.value.sort_direction===`asc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`]),o(p(i),{class:m([`h-3 w-3 -mt-1`,K.value.sort_by===`created_at`&&K.value.sort_direction===`desc`?`text-blue-600 dark:text-blue-400`:`text-gray-400`])},null,8,[`class`])])])])])]),b(`tbody`,E,[(c(!0),S(v,null,l(B.value,e=>(c(),S(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150`},[b(`td`,D,[b(`div`,O,h(e.currency?.name)+` (`+h(e.currency?.code)+`) `,1)]),b(`td`,k,[b(`div`,A,h(Qe(e.rate)),1)]),b(`td`,j,[b(`span`,{class:m([`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full`,e.is_active?`bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`:`bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300`])},h(e.is_active?`Current`:`Old`),3)]),b(`td`,M,[b(`div`,N,h(Ze(e.created_at)),1)])]))),128))])])])),!R.value&&B.value.length>0?(c(),S(`div`,xe,[b(`div`,Se,[b(`div`,Ce,[b(`button`,{onClick:s[6]||=e=>Z(G.value.current_page-1),disabled:G.value.current_page===1,class:`relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},` Previous `,8,we),b(`button`,{onClick:s[7]||=e=>Z(G.value.current_page+1),disabled:G.value.current_page===G.value.last_page,class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},` Next `,8,Te)]),b(`div`,Ee,[b(`div`,null,[b(`p`,De,[s[24]||=a(` Showing `,-1),b(`span`,Oe,h(G.value.from||0),1),s[25]||=a(` to `,-1),b(`span`,ke,h(G.value.to||0),1),s[26]||=a(` of `,-1),b(`span`,Ae,h(G.value.total||0),1),s[27]||=a(` results `,-1)])]),b(`div`,null,[b(`nav`,je,[b(`button`,{onClick:s[8]||=e=>Z(G.value.current_page-1),disabled:G.value.current_page===1,class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[s[28]||=b(`span`,{class:`sr-only`},`Previous`,-1),o(p(r),{class:`h-5 w-5`})],8,Me),b(`button`,{onClick:s[9]||=e=>Z(G.value.current_page+1),disabled:G.value.current_page===G.value.last_page,class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[s[29]||=b(`span`,{class:`sr-only`},`Next`,-1),o(p(n),{class:`h-5 w-5`})],8,Ne)])])])])])):x(``,!0)]),o(ce,{title:`Currency rate to USD`,modelValue:H.value,onClose:$,size:`2xl`,showCloseButton:!0,closeOnEscape:!1},{default:u(()=>[b(`div`,Pe,[s[31]||=b(`div`,{class:`bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4`},[b(`div`,{class:`flex items-center`},[b(`div`,{class:`flex-shrink-0`},[b(`svg`,{class:`h-5 w-5 text-blue-400`,fill:`currentColor`,viewBox:`0 0 20 20`},[b(`path`,{"fill-rule":`evenodd`,d:`M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z`,"clip-rule":`evenodd`})])]),b(`div`,{class:`ml-3`},[b(`p`,{class:`text-sm text-blue-800 dark:text-blue-200`},[b(`strong`,null,`Note:`),a(` All rates are relative to USD. Enter the exchange rate for 1 USD to the respective currency. `)])])])],-1),b(`div`,Fe,[b(`table`,Ie,[s[30]||=b(`thead`,{class:`bg-gray-50 dark:bg-gray-700 sticky top-0 z-10`},[b(`tr`,null,[b(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` # `),b(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Currency `),b(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Current Rate `),b(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` New Rate (1 USD =) `)])],-1),b(`tbody`,Le,[(c(!0),S(v,null,l(q.value,(e,t)=>(c(),S(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[b(`td`,Re,h(t+1),1),b(`td`,P,[b(`div`,ze,[b(`div`,Be,[b(`div`,Ve,[b(`span`,He,h(e.code.substring(0,2)),1)])]),b(`div`,Ue,[b(`div`,We,h(e.name),1),b(`div`,Ge,h(e.code),1)])])]),b(`td`,Ke,h($e(e.id)||`Not set`),1),b(`td`,qe,[d(b(`input`,{"onUpdate:modelValue":t=>W.value[e.id]=t,type:`number`,step:`0.0001`,min:`0`,placeholder:`Enter rate for ${e.name}`,onInput:t=>tt(e.id,t),class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm`},null,40,Je),[[_,W.value[e.id],void 0,{number:!0}]])])]))),128))])])]),b(`div`,Ye,[b(`button`,{onClick:$,type:`button`,class:`px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200`},` Cancel `),b(`button`,{onClick:rt,disabled:U.value||!J.value,type:`button`,class:`inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200`},[U.value?(c(),ie(p(e),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):x(``,!0),a(` `+h(U.value?`Updating...`:`Update Rates`),1)],8,Xe)])])]),_:1},8,[`modelValue`])]))}}),I=F;export{I as default};