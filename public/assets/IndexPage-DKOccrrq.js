import{G as e,J as t,T as n,W as r,aC as i,aD as a,aH as o,aJ as s,aK as c,aM as l,aN as u,aO as ee,aQ as d,aR as f,aV as p,aW as m,ag as te,an as h,ar as ne,aw as re,ax as g,b1 as _,b3 as v,b4 as y,b5 as ie,b7 as b,h as ae,n as oe,o as se,t as x}from"./index-vBZhi31r.js";import"./GlobalConfig-Dep5CV3r.js";import"./tableUtils-BFc6-TYF.js";import{b as ce}from"./PageHeader-FCIC-Y9H.js";import{c as le,f as S}from"./common-C6Lq_4yD.js";import{b as C}from"./StatCard-DiOVkzOE.js";import{c as ue}from"./itemsStore-BhsMxN-1.js";import{b as de}from"./warehousesStore-BBh4eLAg.js";var w=class{baseUrl=`/items/movements`;async getItemMovements(e){try{let t=this.buildQueryParams(e),n=await h(`${this.baseUrl}?${t}`,{loadingMessage:`Loading item movements...`,showLoading:!0});return{data:n.data.data||[],stats:n.data.stats||{total_credit:0,total_debit:0,balance:0}}}catch(e){throw console.error(`Error fetching item movements:`,e),e}}async getItemMovement(e){try{let t=await h(`${this.baseUrl}/${e}`,{loadingMessage:`Loading item movement...`});return t.data.data}catch(e){throw console.error(`Error fetching item movement:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const T=new w,fe=g(`itemMovements`,()=>{let e=v([]),t=v(null),n=v({total_credit:0,total_debit:0,balance:0}),r=v(!1),i=v({}),a=async t=>{try{r.value=!0,t&&(i.value={...i.value,...t});let a=await T.getItemMovements(i.value);e.value=a.data,n.value=a.stats}catch(e){throw console.error(`Error fetching item movements:`,e),e}finally{r.value=!1}},o=async e=>{try{let n=await T.getItemMovement(e);return t.value=n,n}catch(e){throw console.error(`Error fetching item movement:`,e),e}},s=e=>{i.value={...i.value,...e}},c=()=>{i.value={}},l=()=>{t.value=null},u=()=>{e.value=[],t.value=null,n.value={total_credit:0,total_debit:0,balance:0},i.value={},r.value=!1};return{itemMovements:e,currentItemMovement:t,stats:n,loading:r,filters:i,fetchItemMovements:a,fetchItemMovement:o,updateFilters:s,clearFilters:c,clearCurrentItemMovement:l,reset:u}}),pe={class:`space-y-6`},me={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},E={class:`grid grid-cols-1 md:grid-cols-3 gap-4`},D={class:`md:col-span-2`},O={class:`relative`},k={key:0,class:`absolute z-10 mt-1 w-full md:w-2/3 bg-white dark:bg-gray-700 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm`},A=[`onClick`],j={class:`flex items-center`},M={class:`font-medium block truncate text-gray-900 dark:text-white`},N={class:`text-gray-500 dark:text-gray-400 ml-2 text-xs block truncate`},P={key:0,class:`flex items-end`},F={class:`w-full p-3 bg-blue-50 dark:bg-blue-900 rounded-md`},I={class:`flex justify-between items-start`},L={class:`text-sm font-medium text-blue-900 dark:text-blue-100`},R={class:`text-xs text-blue-700 dark:text-blue-300`},z={key:0,class:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6`},he={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},ge={class:`grid grid-cols-1 md:grid-cols-6 gap-4`},_e=[`value`],ve={class:`relative`},ye={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},be={key:0,class:`p-8 text-center`},xe={key:1,class:`p-8 text-center`},Se={class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},Ce={key:2,class:`overflow-x-auto`},we={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Te={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ee={class:`px-4 py-1 whitespace-nowrap`},De={class:`text-sm text-gray-900 dark:text-white`},Oe={class:`px-4 py-1 whitespace-nowrap`},ke={class:`text-sm text-gray-900 dark:text-white`},Ae={class:`px-4 py-1 whitespace-nowrap`},je={class:`px-4 py-1 whitespace-nowrap`},Me={class:`text-sm text-gray-900 dark:text-white`},Ne={class:`px-4 py-1 whitespace-nowrap text-right`},Pe={class:`text-sm font-medium text-green-600 dark:text-green-400`},Fe={class:`px-4 py-1 whitespace-nowrap text-right`},Ie={class:`text-sm font-medium text-red-600 dark:text-red-400`},Le={class:`px-4 py-1 whitespace-nowrap text-right`},Re={class:`text-sm font-medium text-blue-600 dark:text-blue-400`},ze={class:`px-4 py-1 whitespace-nowrap`},Be={class:`text-sm text-gray-900 dark:text-white`},Ve={class:`px-4 py-1 whitespace-nowrap text-center`},He=[`onClick`],Ue={key:1,class:`text-gray-400`},We={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center`};var B=f({__name:`IndexPage`,setup(f){let h=re(),g=ne(),w=ue(),T=fe(),B=de(),V=v(!1),H=v(null),U=v(null),W=v(``),G=v([]),K=v(null),q=v({search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``}),J=s(()=>T.itemMovements),Y=s(()=>T.stats),Ge=s(()=>B.warehousesForSelect),Ke=s(()=>Y.value?.total_credit||0),qe=s(()=>Y.value?.total_debit||0),X=s(()=>Y.value?.balance||0),Je=()=>{U.value&&clearTimeout(U.value),U.value=setTimeout(async()=>{W.value.length>=2?await Ye():G.value=[]},300)},Ye=async()=>{try{await w.fetchItems({search:W.value,is_active:!0,per_page:20}),G.value=w.items}catch(e){console.error(`Error searching items:`,e),g.error(`Failed to search items`)}},Xe=e=>{K.value=e,W.value=`${e.code} - ${e.short_name}`,G.value=[],Z()},Ze=()=>{K.value=null,W.value=``,T.reset(),$()},Z=async()=>{if(K.value?.id)try{V.value=!0,await T.fetchItemMovements({item_id:K.value.id,...q.value})}catch(e){g.error(`Failed to load item movements`,{title:`Error`}),console.error(`Error fetching movements:`,e)}finally{V.value=!1}},Qe=()=>{H.value&&clearTimeout(H.value),H.value=setTimeout(()=>{Z()},300)},Q=()=>{Z()},$=()=>{q.value={search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``},K.value&&Z()},$e=e=>{let t={purchase:`Purchase`,sale:`Sale`,transfer_in:`Transfer In`,transfer_out:`Transfer Out`,adjust_add:`Adjust Add`,adjust_subtract:`Adjust Subtract`,purchase_return:`Purchase Return`,sale_return:`Sale Return`};return t[e]||e},et=e=>{let t={purchase:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`,sale:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100`,transfer_in:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100`,transfer_out:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100`,adjust_add:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-teal-100 text-teal-800 dark:bg-teal-800 dark:text-teal-100`,adjust_subtract:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100`,purchase_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100`,sale_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-100`};return t[e]||`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100`},tt=e=>{if(!e.transaction_type||!e.parent_id)return;let t={sale:`sales.show`,purchase:`purchases.view`,transfer_in:`item-transfers.view`,transfer_out:`item-transfers.view`,adjustment:`item-adjusts.view`,initial_inventory:`items.view`,purchase_return:`purchase-returns.view`,sale_return:`customer.return.show`},n=t[e.transaction_type];if(!n){console.warn(`No route mapping for transaction type:`,e.transaction_type);return}let r=h.resolve({name:n,params:{id:e.parent_id}});window.open(r.href,`_blank`)};return B.fetchWarehouses(),(s,f)=>(p(),u(`div`,pe,[d(ce,{title:`Item Movements`,description:`Search and view item transaction history including purchases, sales, transfers, and adjustments`,showCreateButton:!1}),c(`div`,me,[c(`div`,E,[c(`div`,D,[f[6]||=c(`label`,{for:`item-search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Item (by code or name) `,-1),c(`div`,O,[_(c(`input`,{id:`item-search`,"onUpdate:modelValue":f[0]||=e=>W.value=e,type:`text`,placeholder:`Enter item code or name...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Je},null,544),[[a,W.value]]),d(y(x),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})]),G.value.length>0&&W.value?(p(),u(`div`,k,[(p(!0),u(o,null,m(G.value,e=>(p(),u(`div`,{key:e.id,onClick:t=>Xe(e),class:`cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100 dark:hover:bg-gray-600`},[c(`div`,j,[c(`span`,M,b(e.code)+` - `+b(e.short_name),1)]),c(`span`,N,b(e.description),1)],8,A))),128))])):l(``,!0)]),K.value?(p(),u(`div`,P,[c(`div`,F,[c(`div`,I,[c(`div`,null,[c(`p`,L,b(K.value.code)+` - `+b(K.value.short_name),1),c(`p`,R,b(K.value.description),1)]),c(`button`,{onClick:Ze,class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`},[d(y(ae),{class:`h-4 w-4`})])])])])):l(``,!0)])]),K.value&&J.value.length>0?(p(),u(`div`,z,[d(C,{label:`Total In`,value:y(S)(Ke.value),icon:y(oe),"icon-color":`green`},null,8,[`value`,`icon`]),d(C,{label:`Total Out`,value:y(S)(qe.value),icon:y(se),"icon-color":`red`},null,8,[`value`,`icon`]),d(C,{label:`Net Balance`,value:y(S)(X.value),icon:y(e),"icon-color":`blue`},null,8,[`value`,`icon`]),d(C,{label:`Total Movements`,value:J.value.length.toString(),icon:y(te),"icon-color":`purple`},null,8,[`value`,`icon`])])):l(``,!0),K.value?(p(),u(`div`,he,[c(`div`,ge,[c(`div`,null,[f[7]||=c(`label`,{for:`from_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` From Date `,-1),_(c(`input`,{id:`from_date`,"onUpdate:modelValue":f[1]||=e=>q.value.from_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[a,q.value.from_date]])]),c(`div`,null,[f[8]||=c(`label`,{for:`to_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` To Date `,-1),_(c(`input`,{id:`to_date`,"onUpdate:modelValue":f[2]||=e=>q.value.to_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[a,q.value.to_date]])]),c(`div`,null,[f[10]||=c(`label`,{for:`warehouse`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Warehouse `,-1),_(c(`select`,{id:`warehouse`,"onUpdate:modelValue":f[3]||=e=>q.value.warehouse_id=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},[f[9]||=c(`option`,{value:``},`All Warehouses`,-1),(p(!0),u(o,null,m(Ge.value,e=>(p(),u(`option`,{key:e.value,value:e.value},b(e.label),9,_e))),128))],544),[[i,q.value.warehouse_id]])]),c(`div`,null,[f[12]||=c(`label`,{for:`movement_type`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Movement Type `,-1),_(c(`select`,{id:`movement_type`,"onUpdate:modelValue":f[4]||=e=>q.value.movement_type=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},f[11]||=[ee(`<option value="">All Types</option><option value="purchase">Purchase</option><option value="sale">Sale</option><option value="transfer_in">Transfer In</option><option value="transfer_out">Transfer Out</option><option value="adjust_add">Adjust Add</option><option value="adjust_subtract">Adjust Subtract</option><option value="purchase_return">Purchase Return</option><option value="sale_return">Sale Return</option>`,9)],544),[[i,q.value.movement_type]])]),c(`div`,null,[f[13]||=c(`label`,{for:`search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search `,-1),c(`div`,ve,[_(c(`input`,{id:`search`,"onUpdate:modelValue":f[5]||=e=>q.value.search=e,type:`text`,placeholder:`Search...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Qe},null,544),[[a,q.value.search]]),d(y(x),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})])]),c(`div`,{class:`flex items-end`},[c(`button`,{onClick:$,class:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200`},` Clear `)])])])):l(``,!0),K.value?(p(),u(`div`,ye,[V.value?(p(),u(`div`,be,[d(y(t),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),f[14]||=c(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading movements...`,-1)])):J.value.length===0?(p(),u(`div`,xe,[d(y(n),{class:`h-12 w-12 mx-auto text-gray-400`}),f[15]||=c(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No movements found `,-1),c(`p`,Se,b(q.value.search||q.value.movement_type?`Try adjusting your search criteria.`:`No movements available for this item.`),1)])):(p(),u(`div`,Ce,[c(`table`,we,[f[16]||=c(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[c(`tr`,null,[c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Date `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Trans # `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Type `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Warehouse `),c(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Credit (In) `),c(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Debit (Out) `),c(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Balance `),c(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` By `),c(`th`,{class:`px-4 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Action `)])],-1),c(`tbody`,Te,[(p(!0),u(o,null,m(J.value,e=>(p(),u(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200`},[c(`td`,Ee,[c(`div`,De,b(y(le)(e.date)),1)]),c(`td`,Oe,[c(`div`,ke,b(e.code||`-`),1)]),c(`td`,Ae,[c(`span`,{class:ie(et(e.type))},b($e(e.type)),3)]),c(`td`,je,[c(`div`,Me,b(e.warehouse?.name||`-`),1)]),c(`td`,Ne,[c(`div`,Pe,b(e.credit?y(S)(e.credit):`-`),1)]),c(`td`,Fe,[c(`div`,Ie,b(e.debit?y(S)(e.debit):`-`),1)]),c(`td`,Le,[c(`div`,Re,b(y(S)(e.balance)),1)]),c(`td`,ze,[c(`div`,Be,b(e.by||`N/A`),1)]),c(`td`,Ve,[e.code?(p(),u(`button`,{key:0,onClick:t=>tt(e),class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`,title:`View Details`},[d(y(r),{class:`h-4 w-4`})],8,He)):(p(),u(`span`,Ue,`-`))])]))),128))])])]))])):(p(),u(`div`,We,[d(y(e),{class:`h-16 w-16 mx-auto text-gray-400 mb-4`}),f[17]||=c(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Select an Item `,-1),f[18]||=c(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},` Search and select an item to view its movement history `,-1)]))]))}}),V=B;export{V as default};