import{$ as e,L as t,O as n,Y as r,aE as i,aF as a,aK as o,aL as s,aP as c,aR as l,aS as u,aU as d,aV as f,aW as ee,aY as p,aZ as m,ao as te,av as h,az as ne,b2 as g,b3 as _,ba as v,bc as y,bd as b,be as re,bg as x,j as ie,q as ae,r as oe,y as S}from"./index-C0meH5qn.js";import"./GlobalConfig-wPgXFcZ5.js";import{b as C}from"./StatCard-Bf9AxJ8S.js";import{c as se,f as w}from"./common-CZbH6H1Z.js";import"./tableUtils-dXs1kjAL.js";import{b as ce}from"./PageHeader-BL74d-wS.js";import{c as le}from"./itemsStore-Ckn6JSnu.js";import{b as ue}from"./warehousesStore-SmXlRIm0.js";var T=class{baseUrl=`/items/movements`;async getItemMovements(e){try{let t=this.buildQueryParams(e),n=await h(`${this.baseUrl}?${t}`,{loadingMessage:`Loading item movements...`,showLoading:!0});return{data:n.data.data||[],stats:n.data.stats||{total_credit:0,total_debit:0,balance:0}}}catch(e){throw console.error(`Error fetching item movements:`,e),e}}async getItemMovement(e){try{let t=await h(`${this.baseUrl}/${e}`,{loadingMessage:`Loading item movement...`});return t.data.data}catch(e){throw console.error(`Error fetching item movement:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const E=new T,de=a(`itemMovements`,()=>{let e=y([]),t=y(null),n=y({total_credit:0,total_debit:0,balance:0}),r=y(!1),i=y({}),a=async t=>{try{r.value=!0,t&&(i.value={...i.value,...t});let a=await E.getItemMovements(i.value);e.value=a.data,n.value=a.stats}catch(e){throw console.error(`Error fetching item movements:`,e),e}finally{r.value=!1}},o=async e=>{try{let n=await E.getItemMovement(e);return t.value=n,n}catch(e){throw console.error(`Error fetching item movement:`,e),e}},s=e=>{i.value={...i.value,...e}},c=()=>{i.value={}},l=()=>{t.value=null},u=()=>{e.value=[],t.value=null,n.value={total_credit:0,total_debit:0,balance:0},i.value={},r.value=!1};return{itemMovements:e,currentItemMovement:t,stats:n,loading:r,filters:i,fetchItemMovements:a,fetchItemMovement:o,updateFilters:s,clearFilters:c,clearCurrentItemMovement:l,reset:u}}),fe={class:`space-y-6`},pe={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},me={class:`grid grid-cols-1 md:grid-cols-3 gap-4`},D={class:`md:col-span-2`},O={class:`relative`},k={key:0,class:`absolute z-10 mt-1 w-full md:w-2/3 bg-white dark:bg-gray-700 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm`},A=[`onClick`],j={class:`flex items-center`},M={class:`font-medium block truncate text-gray-900 dark:text-white`},N={class:`text-gray-500 dark:text-gray-400 ml-2 text-xs block truncate`},P={key:0,class:`flex items-end`},F={class:`w-full p-3 bg-blue-50 dark:bg-blue-900 rounded-md`},I={class:`flex justify-between items-start`},L={class:`text-sm font-medium text-blue-900 dark:text-blue-100`},R={class:`text-xs text-blue-700 dark:text-blue-300`},z={key:0,class:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6`},he={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},ge={class:`grid grid-cols-1 md:grid-cols-6 gap-4`},_e=[`value`],ve={class:`relative`},ye={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},be={key:0,class:`p-8 text-center`},xe={key:1,class:`p-8 text-center`},Se={class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},Ce={key:2,class:`overflow-x-auto`},we={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Te={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ee={class:`px-4 py-1 whitespace-nowrap`},De={class:`text-sm text-gray-900 dark:text-white`},Oe={class:`px-4 py-1 whitespace-nowrap`},ke={class:`text-sm text-gray-900 dark:text-white`},Ae={class:`px-4 py-1 whitespace-nowrap`},je={class:`px-4 py-1 whitespace-nowrap`},Me={class:`text-sm text-gray-900 dark:text-white`},Ne={class:`px-4 py-1 whitespace-nowrap text-right`},Pe={class:`text-sm font-medium text-green-600 dark:text-green-400`},Fe={class:`px-4 py-1 whitespace-nowrap text-right`},Ie={class:`text-sm font-medium text-red-600 dark:text-red-400`},Le={class:`px-4 py-1 whitespace-nowrap text-right`},Re={class:`text-sm font-medium text-blue-600 dark:text-blue-400`},ze={class:`px-4 py-1 whitespace-nowrap`},Be={class:`text-sm text-gray-900 dark:text-white`},Ve={class:`px-4 py-1 whitespace-nowrap text-center`},He=[`onClick`],Ue={key:1,class:`text-gray-400`},We={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center`};var B=m({__name:`IndexPage`,setup(a){let m=i(),h=ne(),T=le(),E=de(),B=ue(),V=y(!1),H=y(null),U=y(null),W=y(``),G=y([]),K=y(null),q=y({search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``}),J=l(()=>E.itemMovements),Y=l(()=>E.stats),Ge=l(()=>B.warehousesForSelect),Ke=l(()=>Y.value?.total_credit||0),qe=l(()=>Y.value?.total_debit||0),X=l(()=>Y.value?.balance||0),Je=()=>{U.value&&clearTimeout(U.value),U.value=setTimeout(async()=>{W.value.length>=2?await Ye():G.value=[]},300)},Ye=async()=>{try{await T.fetchItems({search:W.value,is_active:!0,per_page:20}),G.value=T.items}catch(e){console.error(`Error searching items:`,e),h.error(`Failed to search items`)}},Xe=e=>{K.value=e,W.value=`${e.code} - ${e.short_name}`,G.value=[],Z()},Ze=()=>{K.value=null,W.value=``,E.reset(),$()},Z=async()=>{if(K.value?.id)try{V.value=!0,await E.fetchItemMovements({item_id:K.value.id,...q.value})}catch(e){h.error(`Failed to load item movements`,{title:`Error`}),console.error(`Error fetching movements:`,e)}finally{V.value=!1}},Qe=()=>{H.value&&clearTimeout(H.value),H.value=setTimeout(()=>{Z()},300)},Q=()=>{Z()},$=()=>{q.value={search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``},K.value&&Z()},$e=e=>{let t={purchase:`Purchase`,sale:`Sale`,transfer_in:`Transfer In`,transfer_out:`Transfer Out`,adjust_add:`Adjust Add`,adjust_subtract:`Adjust Subtract`,purchase_return:`Purchase Return`,sale_return:`Sale Return`};return t[e]||e},et=e=>{let t={purchase:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`,sale:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100`,transfer_in:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100`,transfer_out:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100`,adjust_add:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-teal-100 text-teal-800 dark:bg-teal-800 dark:text-teal-100`,adjust_subtract:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100`,purchase_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100`,sale_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-100`};return t[e]||`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100`},tt=e=>{if(!e.transaction_type||!e.parent_id)return;let t={sale:`sales.show`,purchase:`purchases.view`,transfer_in:`item-transfers.view`,transfer_out:`item-transfers.view`,adjustment:`item-adjusts.view`,initial_inventory:`items.view`,purchase_return:`purchase-returns.view`,sale_return:`customer.return.show`},n=t[e.transaction_type];if(!n){console.warn(`No route mapping for transaction type:`,e.transaction_type);return}let r=m.resolve({name:n,params:{id:e.parent_id}});window.open(r.href,`_blank`)};return B.fetchWarehouses(),(i,a)=>(g(),f(`div`,fe,[p(ce,{title:`Item Movements`,description:`Search and view item transaction history including purchases, sales, transfers, and adjustments`,showCreateButton:!1}),u(`div`,pe,[u(`div`,me,[u(`div`,D,[a[6]||=u(`label`,{for:`item-search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Item (by code or name) `,-1),u(`div`,O,[v(u(`input`,{id:`item-search`,"onUpdate:modelValue":a[0]||=e=>W.value=e,type:`text`,placeholder:`Enter item code or name...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Je},null,544),[[s,W.value]]),p(b(S),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})]),G.value.length>0&&W.value?(g(),f(`div`,k,[(g(!0),f(c,null,_(G.value,e=>(g(),f(`div`,{key:e.id,onClick:t=>Xe(e),class:`cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100 dark:hover:bg-gray-600`},[u(`div`,j,[u(`span`,M,x(e.code)+` - `+x(e.short_name),1)]),u(`span`,N,x(e.description),1)],8,A))),128))])):d(``,!0)]),K.value?(g(),f(`div`,P,[u(`div`,F,[u(`div`,I,[u(`div`,null,[u(`p`,L,x(K.value.code)+` - `+x(K.value.short_name),1),u(`p`,R,x(K.value.description),1)]),u(`button`,{onClick:Ze,class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`},[p(b(ie),{class:`h-4 w-4`})])])])])):d(``,!0)])]),K.value&&J.value.length>0?(g(),f(`div`,z,[p(C,{label:`Total In`,value:b(w)(Ke.value),icon:b(ae),"icon-color":`green`},null,8,[`value`,`icon`]),p(C,{label:`Total Out`,value:b(w)(qe.value),icon:b(oe),"icon-color":`red`},null,8,[`value`,`icon`]),p(C,{label:`Net Balance`,value:b(w)(X.value),icon:b(t),"icon-color":`blue`},null,8,[`value`,`icon`]),p(C,{label:`Total Movements`,value:J.value.length.toString(),icon:b(te),"icon-color":`purple`},null,8,[`value`,`icon`])])):d(``,!0),K.value?(g(),f(`div`,he,[u(`div`,ge,[u(`div`,null,[a[7]||=u(`label`,{for:`from_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` From Date `,-1),v(u(`input`,{id:`from_date`,"onUpdate:modelValue":a[1]||=e=>q.value.from_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[s,q.value.from_date]])]),u(`div`,null,[a[8]||=u(`label`,{for:`to_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` To Date `,-1),v(u(`input`,{id:`to_date`,"onUpdate:modelValue":a[2]||=e=>q.value.to_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[s,q.value.to_date]])]),u(`div`,null,[a[10]||=u(`label`,{for:`warehouse`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Warehouse `,-1),v(u(`select`,{id:`warehouse`,"onUpdate:modelValue":a[3]||=e=>q.value.warehouse_id=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},[a[9]||=u(`option`,{value:``},`All Warehouses`,-1),(g(!0),f(c,null,_(Ge.value,e=>(g(),f(`option`,{key:e.value,value:e.value},x(e.label),9,_e))),128))],544),[[o,q.value.warehouse_id]])]),u(`div`,null,[a[12]||=u(`label`,{for:`movement_type`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Movement Type `,-1),v(u(`select`,{id:`movement_type`,"onUpdate:modelValue":a[4]||=e=>q.value.movement_type=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},a[11]||=[ee(`<option value="">All Types</option><option value="purchase">Purchase</option><option value="sale">Sale</option><option value="transfer_in">Transfer In</option><option value="transfer_out">Transfer Out</option><option value="adjust_add">Adjust Add</option><option value="adjust_subtract">Adjust Subtract</option><option value="purchase_return">Purchase Return</option><option value="sale_return">Sale Return</option>`,9)],544),[[o,q.value.movement_type]])]),u(`div`,null,[a[13]||=u(`label`,{for:`search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search `,-1),u(`div`,ve,[v(u(`input`,{id:`search`,"onUpdate:modelValue":a[5]||=e=>q.value.search=e,type:`text`,placeholder:`Search...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Qe},null,544),[[s,q.value.search]]),p(b(S),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})])]),u(`div`,{class:`flex items-end`},[u(`button`,{onClick:$,class:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200`},` Clear `)])])])):d(``,!0),K.value?(g(),f(`div`,ye,[V.value?(g(),f(`div`,be,[p(b(n),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),a[14]||=u(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading movements...`,-1)])):J.value.length===0?(g(),f(`div`,xe,[p(b(r),{class:`h-12 w-12 mx-auto text-gray-400`}),a[15]||=u(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No movements found `,-1),u(`p`,Se,x(q.value.search||q.value.movement_type?`Try adjusting your search criteria.`:`No movements available for this item.`),1)])):(g(),f(`div`,Ce,[u(`table`,we,[a[16]||=u(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[u(`tr`,null,[u(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Date `),u(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Trans # `),u(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Type `),u(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Warehouse `),u(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Credit (In) `),u(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Debit (Out) `),u(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Balance `),u(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` By `),u(`th`,{class:`px-4 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Action `)])],-1),u(`tbody`,Te,[(g(!0),f(c,null,_(J.value,t=>(g(),f(`tr`,{key:t.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200`},[u(`td`,Ee,[u(`div`,De,x(b(se)(t.date)),1)]),u(`td`,Oe,[u(`div`,ke,x(t.code||`-`),1)]),u(`td`,Ae,[u(`span`,{class:re(et(t.type))},x($e(t.type)),3)]),u(`td`,je,[u(`div`,Me,x(t.warehouse?.name||`-`),1)]),u(`td`,Ne,[u(`div`,Pe,x(t.credit?b(w)(t.credit):`-`),1)]),u(`td`,Fe,[u(`div`,Ie,x(t.debit?b(w)(t.debit):`-`),1)]),u(`td`,Le,[u(`div`,Re,x(b(w)(t.balance)),1)]),u(`td`,ze,[u(`div`,Be,x(t.by||`N/A`),1)]),u(`td`,Ve,[t.code?(g(),f(`button`,{key:0,onClick:e=>tt(t),class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`,title:`View Details`},[p(b(e),{class:`h-4 w-4`})],8,He)):(g(),f(`span`,Ue,`-`))])]))),128))])])]))])):(g(),f(`div`,We,[p(b(t),{class:`h-16 w-16 mx-auto text-gray-400 mb-4`}),a[17]||=u(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Select an Item `,-1),a[18]||=u(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},` Search and select an item to view its movement history `,-1)]))]))}}),V=B;export{V as default};