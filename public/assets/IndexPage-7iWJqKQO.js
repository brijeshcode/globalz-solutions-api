import{J as e,M as t,W as n,Z as r,a$ as i,aC as a,aD as o,aI as s,aJ as c,aN as l,aP as u,aQ as d,aS as f,aT as p,aU as ee,aW as m,aX as h,am as te,at as g,ax as ne,b0 as _,b7 as v,b9 as y,ba as b,bb as re,bd as x,i as ie,p as ae,q as oe,w as S}from"./index-BtpdY0Il.js";import"./GlobalConfig-wPgXFcZ5.js";import"./tableUtils-ylneqlK-.js";import{b as se}from"./PageHeader-DqGdvhG5.js";import{c as ce,f as C}from"./common-qdv5PS_C.js";import{b as w}from"./StatCard-t5rr1PMW.js";import{c as le}from"./itemsStore-CB9jouay.js";import{b as ue}from"./warehousesStore-Cerz7aVB.js";var T=class{baseUrl=`/items/movements`;async getItemMovements(e){try{let t=this.buildQueryParams(e),n=await g(`${this.baseUrl}?${t}`,{loadingMessage:`Loading item movements...`,showLoading:!0});return{data:n.data.data||[],stats:n.data.stats||{total_credit:0,total_debit:0,balance:0}}}catch(e){throw console.error(`Error fetching item movements:`,e),e}}async getItemMovement(e){try{let t=await g(`${this.baseUrl}/${e}`,{loadingMessage:`Loading item movement...`});return t.data.data}catch(e){throw console.error(`Error fetching item movement:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const E=new T,de=o(`itemMovements`,()=>{let e=y([]),t=y(null),n=y({total_credit:0,total_debit:0,balance:0}),r=y(!1),i=y({}),a=async t=>{try{r.value=!0,t&&(i.value={...i.value,...t});let a=await E.getItemMovements(i.value);e.value=a.data,n.value=a.stats}catch(e){throw console.error(`Error fetching item movements:`,e),e}finally{r.value=!1}},o=async e=>{try{let n=await E.getItemMovement(e);return t.value=n,n}catch(e){throw console.error(`Error fetching item movement:`,e),e}},s=e=>{i.value={...i.value,...e}},c=()=>{i.value={}},l=()=>{t.value=null},u=()=>{e.value=[],t.value=null,n.value={total_credit:0,total_debit:0,balance:0},i.value={},r.value=!1};return{itemMovements:e,currentItemMovement:t,stats:n,loading:r,filters:i,fetchItemMovements:a,fetchItemMovement:o,updateFilters:s,clearFilters:c,clearCurrentItemMovement:l,reset:u}}),fe={class:`space-y-6`},pe={class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},me={class:`grid grid-cols-1 md:grid-cols-3 gap-4`},D={class:`md:col-span-2`},O={class:`relative`},k={key:0,class:`absolute z-10 mt-1 w-full md:w-2/3 bg-white dark:bg-gray-700 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm`},A=[`onClick`],j={class:`flex items-center`},M={class:`font-medium block truncate text-gray-900 dark:text-white`},N={class:`text-gray-500 dark:text-gray-400 ml-2 text-xs block truncate`},P={key:0,class:`flex items-end`},F={class:`w-full p-3 bg-blue-50 dark:bg-blue-900 rounded-md`},I={class:`flex justify-between items-start`},L={class:`text-sm font-medium text-blue-900 dark:text-blue-100`},R={class:`text-xs text-blue-700 dark:text-blue-300`},z={key:0,class:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6`},he={key:1,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-4`},ge={class:`grid grid-cols-1 md:grid-cols-6 gap-4`},_e=[`value`],ve={class:`relative`},ye={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden`},be={key:0,class:`p-8 text-center`},xe={key:1,class:`p-8 text-center`},Se={class:`mt-1 text-sm text-gray-500 dark:text-gray-400`},Ce={key:2,class:`overflow-x-auto`},we={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},Te={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},Ee={class:`px-4 py-1 whitespace-nowrap`},De={class:`text-sm text-gray-900 dark:text-white`},Oe={class:`px-4 py-1 whitespace-nowrap`},ke={class:`text-sm text-gray-900 dark:text-white`},Ae={class:`px-4 py-1 whitespace-nowrap`},je={class:`px-4 py-1 whitespace-nowrap`},Me={class:`text-sm text-gray-900 dark:text-white`},Ne={class:`px-4 py-1 whitespace-nowrap text-right`},Pe={class:`text-sm font-medium text-green-600 dark:text-green-400`},Fe={class:`px-4 py-1 whitespace-nowrap text-right`},Ie={class:`text-sm font-medium text-red-600 dark:text-red-400`},Le={class:`px-4 py-1 whitespace-nowrap text-right`},Re={class:`text-sm font-medium text-blue-600 dark:text-blue-400`},ze={class:`px-4 py-1 whitespace-nowrap`},Be={class:`text-sm text-gray-900 dark:text-white`},Ve={class:`px-4 py-1 whitespace-nowrap text-center`},He=[`onClick`],Ue={key:1,class:`text-gray-400`},We={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center`};var B=h({__name:`IndexPage`,setup(o){let h=a(),g=ne(),T=le(),E=de(),B=ue(),V=y(!1),H=y(null),U=y(null),W=y(``),G=y([]),K=y(null),q=y({search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``}),J=u(()=>E.itemMovements),Y=u(()=>E.stats),Ge=u(()=>B.warehousesForSelect),Ke=u(()=>Y.value?.total_credit||0),qe=u(()=>Y.value?.total_debit||0),X=u(()=>Y.value?.balance||0),Je=()=>{U.value&&clearTimeout(U.value),U.value=setTimeout(async()=>{W.value.length>=2?await Ye():G.value=[]},300)},Ye=async()=>{try{await T.fetchItems({search:W.value,is_active:!0,per_page:20}),G.value=T.items}catch(e){console.error(`Error searching items:`,e),g.error(`Failed to search items`)}},Xe=e=>{K.value=e,W.value=`${e.code} - ${e.short_name}`,G.value=[],Z()},Ze=()=>{K.value=null,W.value=``,E.reset(),$()},Z=async()=>{if(K.value?.id)try{V.value=!0,await E.fetchItemMovements({item_id:K.value.id,...q.value})}catch(e){g.error(`Failed to load item movements`,{title:`Error`}),console.error(`Error fetching movements:`,e)}finally{V.value=!1}},Qe=()=>{H.value&&clearTimeout(H.value),H.value=setTimeout(()=>{Z()},300)},Q=()=>{Z()},$=()=>{q.value={search:``,from_date:``,to_date:``,warehouse_id:``,movement_type:``},K.value&&Z()},$e=e=>{let t={purchase:`Purchase`,sale:`Sale`,transfer_in:`Transfer In`,transfer_out:`Transfer Out`,adjust_add:`Adjust Add`,adjust_subtract:`Adjust Subtract`,purchase_return:`Purchase Return`,sale_return:`Sale Return`};return t[e]||e},et=e=>{let t={purchase:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`,sale:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100`,transfer_in:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100`,transfer_out:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100`,adjust_add:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-teal-100 text-teal-800 dark:bg-teal-800 dark:text-teal-100`,adjust_subtract:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100`,purchase_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100`,sale_return:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-100`};return t[e]||`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100`},tt=e=>{if(!e.transaction_type||!e.parent_id)return;let t={sale:`sales.show`,purchase:`purchases.view`,transfer_in:`item-transfers.view`,transfer_out:`item-transfers.view`,adjustment:`item-adjusts.view`,initial_inventory:`items.view`,purchase_return:`purchase-returns.view`,sale_return:`customer.return.show`},n=t[e.transaction_type];if(!n){console.warn(`No route mapping for transaction type:`,e.transaction_type);return}let r=h.resolve({name:n,params:{id:e.parent_id}});window.open(r.href,`_blank`)};return B.fetchWarehouses(),(a,o)=>(i(),p(`div`,fe,[m(se,{title:`Item Movements`,description:`Search and view item transaction history including purchases, sales, transfers, and adjustments`,showCreateButton:!1}),d(`div`,pe,[d(`div`,me,[d(`div`,D,[o[6]||=d(`label`,{for:`item-search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search Item (by code or name) `,-1),d(`div`,O,[v(d(`input`,{id:`item-search`,"onUpdate:modelValue":o[0]||=e=>W.value=e,type:`text`,placeholder:`Enter item code or name...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Je},null,544),[[c,W.value]]),m(b(S),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})]),G.value.length>0&&W.value?(i(),p(`div`,k,[(i(!0),p(l,null,_(G.value,e=>(i(),p(`div`,{key:e.id,onClick:t=>Xe(e),class:`cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100 dark:hover:bg-gray-600`},[d(`div`,j,[d(`span`,M,x(e.code)+` - `+x(e.short_name),1)]),d(`span`,N,x(e.description),1)],8,A))),128))])):f(``,!0)]),K.value?(i(),p(`div`,P,[d(`div`,F,[d(`div`,I,[d(`div`,null,[d(`p`,L,x(K.value.code)+` - `+x(K.value.short_name),1),d(`p`,R,x(K.value.description),1)]),d(`button`,{onClick:Ze,class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`},[m(b(ie),{class:`h-4 w-4`})])])])])):f(``,!0)])]),K.value&&J.value.length>0?(i(),p(`div`,z,[m(w,{label:`Total In`,value:b(C)(Ke.value),icon:b(ae),"icon-color":`green`},null,8,[`value`,`icon`]),m(w,{label:`Total Out`,value:b(C)(qe.value),icon:b(oe),"icon-color":`red`},null,8,[`value`,`icon`]),m(w,{label:`Net Balance`,value:b(C)(X.value),icon:b(e),"icon-color":`blue`},null,8,[`value`,`icon`]),m(w,{label:`Total Movements`,value:J.value.length.toString(),icon:b(te),"icon-color":`purple`},null,8,[`value`,`icon`])])):f(``,!0),K.value?(i(),p(`div`,he,[d(`div`,ge,[d(`div`,null,[o[7]||=d(`label`,{for:`from_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` From Date `,-1),v(d(`input`,{id:`from_date`,"onUpdate:modelValue":o[1]||=e=>q.value.from_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[c,q.value.from_date]])]),d(`div`,null,[o[8]||=d(`label`,{for:`to_date`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` To Date `,-1),v(d(`input`,{id:`to_date`,"onUpdate:modelValue":o[2]||=e=>q.value.to_date=e,type:`date`,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},null,544),[[c,q.value.to_date]])]),d(`div`,null,[o[10]||=d(`label`,{for:`warehouse`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Warehouse `,-1),v(d(`select`,{id:`warehouse`,"onUpdate:modelValue":o[3]||=e=>q.value.warehouse_id=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},[o[9]||=d(`option`,{value:``},`All Warehouses`,-1),(i(!0),p(l,null,_(Ge.value,e=>(i(),p(`option`,{key:e.value,value:e.value},x(e.label),9,_e))),128))],544),[[s,q.value.warehouse_id]])]),d(`div`,null,[o[12]||=d(`label`,{for:`movement_type`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Movement Type `,-1),v(d(`select`,{id:`movement_type`,"onUpdate:modelValue":o[4]||=e=>q.value.movement_type=e,class:`block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm transition-colors duration-200`,onChange:Q},o[11]||=[ee(`<option value="">All Types</option><option value="purchase">Purchase</option><option value="sale">Sale</option><option value="transfer_in">Transfer In</option><option value="transfer_out">Transfer Out</option><option value="adjust_add">Adjust Add</option><option value="adjust_subtract">Adjust Subtract</option><option value="purchase_return">Purchase Return</option><option value="sale_return">Sale Return</option>`,9)],544),[[s,q.value.movement_type]])]),d(`div`,null,[o[13]||=d(`label`,{for:`search`,class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1`},` Search `,-1),d(`div`,ve,[v(d(`input`,{id:`search`,"onUpdate:modelValue":o[5]||=e=>q.value.search=e,type:`text`,placeholder:`Search...`,class:`block w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 sm:text-sm transition-colors duration-200`,onInput:Qe},null,544),[[c,q.value.search]]),m(b(S),{class:`absolute left-3 top-2.5 h-5 w-5 text-gray-400`})])]),d(`div`,{class:`flex items-end`},[d(`button`,{onClick:$,class:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200`},` Clear `)])])])):f(``,!0),K.value?(i(),p(`div`,ye,[V.value?(i(),p(`div`,be,[m(b(t),{class:`h-8 w-8 animate-spin mx-auto text-blue-600 dark:text-blue-400`}),o[14]||=d(`p`,{class:`mt-2 text-sm text-gray-500 dark:text-gray-400`},`Loading movements...`,-1)])):J.value.length===0?(i(),p(`div`,xe,[m(b(n),{class:`h-12 w-12 mx-auto text-gray-400`}),o[15]||=d(`h3`,{class:`mt-2 text-sm font-medium text-gray-900 dark:text-white`},` No movements found `,-1),d(`p`,Se,x(q.value.search||q.value.movement_type?`Try adjusting your search criteria.`:`No movements available for this item.`),1)])):(i(),p(`div`,Ce,[d(`table`,we,[o[16]||=d(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[d(`tr`,null,[d(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Date `),d(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Trans # `),d(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Type `),d(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Warehouse `),d(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Credit (In) `),d(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Debit (Out) `),d(`th`,{class:`px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Balance `),d(`th`,{class:`px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` By `),d(`th`,{class:`px-4 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Action `)])],-1),d(`tbody`,Te,[(i(!0),p(l,null,_(J.value,e=>(i(),p(`tr`,{key:e.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200`},[d(`td`,Ee,[d(`div`,De,x(b(ce)(e.date)),1)]),d(`td`,Oe,[d(`div`,ke,x(e.code||`-`),1)]),d(`td`,Ae,[d(`span`,{class:re(et(e.type))},x($e(e.type)),3)]),d(`td`,je,[d(`div`,Me,x(e.warehouse?.name||`-`),1)]),d(`td`,Ne,[d(`div`,Pe,x(e.credit?b(C)(e.credit):`-`),1)]),d(`td`,Fe,[d(`div`,Ie,x(e.debit?b(C)(e.debit):`-`),1)]),d(`td`,Le,[d(`div`,Re,x(b(C)(e.balance)),1)]),d(`td`,ze,[d(`div`,Be,x(e.by||`N/A`),1)]),d(`td`,Ve,[e.code?(i(),p(`button`,{key:0,onClick:t=>tt(e),class:`text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200`,title:`View Details`},[m(b(r),{class:`h-4 w-4`})],8,He)):(i(),p(`span`,Ue,`-`))])]))),128))])])]))])):(i(),p(`div`,We,[m(b(e),{class:`h-16 w-16 mx-auto text-gray-400 mb-4`}),o[17]||=d(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Select an Item `,-1),o[18]||=d(`p`,{class:`text-sm text-gray-500 dark:text-gray-400`},` Search and select an item to view its movement history `,-1)]))]))}}),V=B;export{V as default};