import{aB as e,aC as t,aD as n,aP as r,as as i,at as a,au as o,av as s,aw as c,b5 as l,b9 as u}from"./index-Bnis6Z4a.js";import{c as d}from"./GlobalConfig-wPgXFcZ5.js";import{b as f}from"./tableUtils-ylneqlK-.js";var p=class{baseUrl=`/setups/items`;async getItems(e){try{let t=this.buildQueryParams(e),n=await a(`${this.baseUrl}?${t}`,{loadingMessage:`Loading items...`,showLoading:!0});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching items:`,e),e}}async getItem(e){try{let t=await a(`${this.baseUrl}/${e}`,{loadingMessage:`Loading item...`});return t.data.data}catch(e){throw console.error(`Error fetching item:`,e),e}}async createItem(e){try{let t=await s(this.baseUrl,e,{loadingMessage:`Creating item...`,showSuccessNotification:!0,successMessage:`Item created successfully`});return t.data.data}catch(e){throw console.error(`Error creating item:`,e),e}}async createItemWithImages(e){try{let t=await s(this.baseUrl,e,{loadingMessage:`Creating item with images...`,showSuccessNotification:!0,successMessage:`Item created successfully`,headers:{"Content-Type":`multipart/form-data`}});return t.data.data}catch(e){throw console.error(`Error creating item with images:`,e),e}}async updateItem(e,t){try{let n=await c(`${this.baseUrl}/${e}`,t,{loadingMessage:`Updating item...`,showSuccessNotification:!0,successMessage:`Item updated successfully`});return n.data.data}catch(e){throw console.error(`Error updating item:`,e),e}}async updateItemWithImages(e,t){try{let n=await s(`${this.baseUrl}/${e}`,t,{loadingMessage:`Updating item with images...`,showSuccessNotification:!0,successMessage:`Item updated successfully`,headers:{"Content-Type":`multipart/form-data`}});return n.data.data}catch(e){throw console.error(`Error updating item with images:`,e),e}}async deleteItem(e){try{await i(`${this.baseUrl}/${e}`,{loadingMessage:`Deleting item...`,showSuccessNotification:!0,successMessage:`Item deleted successfully`})}catch(e){throw console.error(`Error deleting item:`,e),e}}async getTrashedItems(e){try{let t=this.buildQueryParams(e),n=await a(`${this.baseUrl}/trashed?${t}`,{loadingMessage:`Loading trashed items...`});return{data:n.data.data,pagination:n.data.pagination}}catch(e){throw console.error(`Error fetching trashed items:`,e),e}}async restoreItem(e){try{let t=await o(`${this.baseUrl}/${e}/restore`,{},{loadingMessage:`Restoring item...`,showSuccessNotification:!0,successMessage:`Item restored successfully`});return t.data.data}catch(e){throw console.error(`Error restoring item:`,e),e}}async forceDeleteItem(e){try{await i(`${this.baseUrl}/${e}/force-delete`,{loadingMessage:`Permanently deleting item...`,showSuccessNotification:!0,successMessage:`Item permanently deleted`})}catch(e){throw console.error(`Error permanently deleting item:`,e),e}}async getItemStats(){try{let e=await a(`${this.baseUrl}/stats`,{loadingMessage:`Loading item statistics...`});return e.data.data}catch(e){throw console.error(`Error fetching item statistics:`,e),e}}async exportItems(e){try{let t=this.buildQueryParams(e),n=await a(`${this.baseUrl}/export?${t}`,{loadingMessage:`Exporting items...`,showSuccessNotification:!0,successMessage:`Items exported successfully`});return n.data.data}catch(e){throw console.error(`Error exporting items:`,e),e}}async downloadImportTemplate(){try{let e=await a(`${this.baseUrl}/import-template`,{loadingMessage:`Downloading import template...`,responseType:`blob`});return e.data}catch(e){throw console.error(`Error downloading import template:`,e),e}}async importItems(e,t=!1){try{let n=new FormData;n.append(`file`,e),n.append(`update_existing`,t?`1`:`0`);let r=await s(`${this.baseUrl}/import`,n,{loadingMessage:`Importing items...`,showSuccessNotification:!0,successMessage:`Items imported successfully`});return r.data}catch(e){throw console.error(`Error importing items:`,e),e}}async getNextCode(){try{let e=await a(`${this.baseUrl}/next-code`,{showLoading:!1});return e.data.data}catch(e){throw console.error(`Error fetching next code:`,e),e}}async checkCodeAvailability(e){try{let t=await s(`${this.baseUrl}/check-code`,{code:e},{showLoading:!1});return t.data.data}catch(e){throw console.error(`Error checking code availability:`,e),e}}async getItemsForSelect(e){try{let t=this.buildQueryParams(e),n=await a(`${this.baseUrl}/all?${t}`,{showLoading:!1});return n.data.data}catch(e){throw console.error(`Error fetching items for select:`,e),e}}async searchItems(e,t=50){try{return await this.getItemsForSelect(e)}catch(e){throw console.error(`Error searching items:`,e),e}}async getLowStockItems(e){try{let t={...e},n=this.buildQueryParams(t),r=await a(`${this.baseUrl}?low_stock=true&${n}`,{loadingMessage:`Loading low stock items...`});return{data:r.data.data,pagination:r.data.pagination}}catch(e){throw console.error(`Error fetching low stock items:`,e),e}}buildQueryParams(e){if(!e)return``;let t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{n!=null&&n!==``&&t.append(e,String(n))}),t.toString()}};const m=new p,h=n(`items`,()=>{let n=t(),i=e(),a=u([]),o=u([]),s=u(null),c=u([]),p=u({total_items:0,active_items:0,inactive_items:0,trashed_items:0,low_stock_items:0,total_inventory_value:0,items_by_type:[],items_by_family:[],cost_calculation_breakdown:[]}),h=u(f()),g=u(!1),_=u({}),v=r(()=>({page:i.query.page?parseInt(i.query.page):1,per_page:i.query.per_page?parseInt(i.query.per_page):d.defaultPerPage,search:i.query.search||``,search_field:i.query.search_field||``,sort_by:i.query.sort_by||``,sort_direction:i.query.sort_direction||`desc`,is_active:i.query.is_active===void 0?void 0:i.query.is_active===`true`,item_type_id:i.query.item_type_id?parseInt(i.query.item_type_id):void 0,item_family_id:i.query.item_family_id?parseInt(i.query.item_family_id):void 0,item_group_id:i.query.item_group_id?parseInt(i.query.item_group_id):void 0,item_category_id:i.query.item_category_id?parseInt(i.query.item_category_id):void 0,item_brand_id:i.query.item_brand_id?parseInt(i.query.item_brand_id):void 0,supplier_id:i.query.supplier_id?parseInt(i.query.supplier_id):void 0,item_profit_margin_id:i.query.item_profit_margin_id?parseInt(i.query.item_profit_margin_id):void 0,warehouse_id:i.query.warehouse_id?parseInt(i.query.warehouse_id):void 0,cost_calculation:i.query.cost_calculation||void 0,code:i.query.code||void 0})),y=r(()=>a.value.filter(e=>e.is_active)),b=r(()=>a.value.filter(e=>!e.is_active)),x=r(()=>y.value.map(e=>({value:e.id,label:`${e.code} - ${e.description}`,code:e.code,disabled:!1}))),S=r(()=>a.value.filter(e=>e.low_quantity_alert!==null&&e.starting_quantity<=e.low_quantity_alert)),C=(e,t=!1)=>{let r={...i.query};Object.entries(e).forEach(([e,t])=>{t!=null&&t!==``?r[e]=String(t):delete r[e]});let a=t?`replace`:`push`;n[a]({query:r})},w=()=>{n.replace({query:{}})},T=()=>{_.value={...v.value}};l(()=>i.query,()=>{T()},{immediate:!0,deep:!0});let E=async(e,t=!0)=>{try{g.value=!0;let n=_.value;e&&(n={..._.value,...e},t&&C(e));let r=await m.getItems(n);a.value=r.data,h.value=r.pagination}catch(e){throw console.error(`Error fetching items:`,e),e}finally{g.value=!1}},D=async e=>{try{let t=await m.getItem(e);return s.value=t,t}catch(e){throw console.error(`Error fetching item:`,e),e}},O=async e=>{try{let t=await m.createItem(e);return a.value.unshift(t),h.value.total+=1,p.value.total_items+=1,e.is_active===!1?p.value.inactive_items+=1:p.value.active_items+=1,t}catch(e){throw console.error(`Error creating item:`,e),e}},k=async e=>{try{let t=await m.createItemWithImages(e);a.value.unshift(t),h.value.total+=1,p.value.total_items+=1;let n=e.get(`is_active`)!==`0`;return n?p.value.active_items+=1:p.value.inactive_items+=1,t}catch(e){throw console.error(`Error creating item with images:`,e),e}},A=async(e,t)=>{try{let n=await m.updateItem(e,t),r=a.value.findIndex(t=>t.id===e);return r!==-1&&(a.value[r]=n),s.value?.id===e&&(s.value=n),n}catch(e){throw console.error(`Error updating item:`,e),e}},j=async(e,t)=>{try{let n=await m.updateItemWithImages(e,t),r=a.value.findIndex(t=>t.id===e);return r!==-1&&(a.value[r]=n),s.value?.id===e&&(s.value=n),n}catch(e){throw console.error(`Error updating item with images:`,e),e}},M=async e=>{try{await m.deleteItem(e);let t=a.value.findIndex(t=>t.id===e);t!==-1&&a.value.splice(t,1),--h.value.total,--p.value.total_items,p.value.trashed_items+=1,s.value?.id===e&&(s.value=null)}catch(e){throw console.error(`Error deleting item:`,e),e}},N=async e=>{try{g.value=!0;let t=e||{},n=await m.getTrashedItems(t);c.value=n.data}catch(e){throw console.error(`Error fetching trashed items:`,e),e}finally{g.value=!1}},P=async e=>{try{let t=await m.restoreItem(e),n=c.value.findIndex(t=>t.id===e);return n!==-1&&c.value.splice(n,1),a.value.unshift(t),h.value.total+=1,--p.value.trashed_items,t}catch(e){throw console.error(`Error restoring item:`,e),e}},F=async e=>{try{await m.forceDeleteItem(e);let t=c.value.findIndex(t=>t.id===e);t!==-1&&c.value.splice(t,1),--p.value.trashed_items}catch(e){throw console.error(`Error permanently deleting item:`,e),e}},I=async()=>{try{let e=await m.getItemStats();return p.value=e,e}catch(e){throw console.error(`Error fetching item stats:`,e),e}},L=async e=>{try{let t=e||_.value;return await m.exportItems(t)}catch(e){throw console.error(`Error exporting items:`,e),e}},R=async()=>{try{return await m.downloadImportTemplate()}catch(e){throw console.error(`Error downloading import template:`,e),e}},z=async(e,t=!1)=>{try{let n=await m.importItems(e,t);return await E(),n}catch(e){throw console.error(`Error importing items:`,e),e}},B=async()=>{try{return await m.getNextCode()}catch(e){throw console.error(`Error getting next code:`,e),e}},V=async e=>{try{return await m.checkCodeAvailability(e)}catch(e){throw console.error(`Error checking code availability:`,e),e}},H=async(e,t=50)=>{try{return await m.searchItems(e,t)}catch(e){return console.error(`Error searching items:`,e),[]}},U=async e=>{try{return await m.getLowStockItems(e)}catch(e){throw console.error(`Error fetching low stock items:`,e),e}},W=(e,t=!0)=>{_.value={..._.value,...e},t&&C(e)},G=(e=!0)=>{_.value={},e&&w()},K=e=>{W({page:e},!0)},q=e=>{W({per_page:e,page:1},!0)},J=(e,t=`desc`)=>{W({sort_by:e,sort_direction:t,page:1},!0)},Y=(e,t=``)=>{W({search:e,search_field:t,page:1},!0)},X=()=>{s.value=null},Z=()=>{a.value=[],s.value=null,c.value=[],h.value=f(),_.value={},g.value=!1,p.value={total_items:0,active_items:0,inactive_items:0,trashed_items:0,low_stock_items:0,total_inventory_value:0,items_by_type:[],items_by_family:[],cost_calculation_breakdown:[]}},Q=async()=>{try{let e=await m.getItemsForSelect();return o.value=e,e}catch(e){return console.error(`Error fetching items for select:`,e),[]}};return{items:a,allItems:o,currentItem:s,trashedItems:c,stats:p,pagination:h,loading:g,filters:_,urlParams:v,activeItems:y,inactiveItems:b,itemsForSelect:x,lowStockItems:S,updateUrlParams:C,clearUrlParams:w,syncFiltersWithUrl:T,fetchItems:E,fetchItem:D,createItem:O,createItemWithImages:k,updateItem:A,updateItemWithImages:j,deleteItem:M,fetchTrashedItems:N,restoreItem:P,forceDeleteItem:F,fetchStats:I,exportItems:L,downloadImportTemplate:R,importItems:z,getNextCode:B,checkCodeAvailability:V,searchItems:H,fetchLowStockItems:U,updateFilters:W,clearFilters:G,setPage:K,setPerPage:q,setSort:J,setSearch:Y,clearCurrentItem:X,reset:Z,fetchItemsForSelect:Q}});var g=h;export{g as b,h as c};