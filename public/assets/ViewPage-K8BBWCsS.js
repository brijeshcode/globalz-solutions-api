import{D as e,H as t,I as n,J as r,M as i,Q as ee,_ as te,aA as a,aC as ne,aD as re,aE as o,aF as ie,aH as s,aI as ae,aL as c,aO as l,aP as u,aQ as d,aS as f,ab as oe,af as se,ag as ce,aq as le,as as p,at as m,au as h,av as g,aw as _,ay as v,az as y,l as ue}from"./index-DPZISxi2.js";import"./GlobalConfig-BnwaQAhg.js";import"./tableUtils-BvWofAYZ.js";import{b,c as de,d as x}from"./common-BPa_8IsB.js";import{b as fe,c as S,d as C}from"./SystemInfoCard-C8RuJEat.js";import{b as pe}from"./expenseTransactionStore-DQ2odYY6.js";import{b as w}from"./documentService-CSdS-TBK.js";const T=[`stroke-width`];var E=a({__name:`DownloadIcon`,props:{size:{},color:{},stroke:{}},setup(e){let t=e,n=t.size??5,r=t.color??`text-current`,i=t.stroke??1.5;return(e,t)=>(o(),_(`svg`,{xmlns:`http://www.w3.org/2000/svg`,fill:`none`,viewBox:`0 0 24 24`,stroke:`currentColor`,"stroke-width":u(i),class:d([`w-${u(n)}`,`h-${u(n)}`,u(r)])},t[0]||=[m(`path`,{d:`M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5 5-5M12 4v12`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)],10,T))}}),D=E;const O={class:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`},k={class:`mb-8`},A={class:`flex items-center justify-between`},j={class:`flex items-center space-x-4`},M={class:`text-3xl font-bold text-gray-900 dark:text-gray-100`},N={class:`text-sm text-gray-600 dark:text-gray-400 mt-1`},P={class:`flex items-center space-x-3`},F={key:0,class:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300`},I={key:0,class:`flex items-center justify-center py-12`},L={key:1,class:`bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6`},R={class:`flex items-center`},z={class:`text-red-600 dark:text-red-400 mt-1`},B={key:2,class:`space-y-8`},me={class:`font-medium text-blue-600 dark:text-blue-400`},he={class:`text-lg font-semibold text-red-600 dark:text-red-400`},ge={class:`text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap`},_e={key:2,class:`bg-white dark:bg-gray-800 shadow rounded-lg`},ve={class:`px-6 py-5 border-b border-gray-200 dark:border-gray-700`},ye={class:`flex items-center justify-between`},be={class:`text-lg font-medium text-gray-900 dark:text-gray-100`},xe={class:`px-6 py-5`},Se={class:`grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3`},Ce={class:`flex items-start space-x-3`},we={class:`flex-shrink-0`},Te={class:`flex-1 min-w-0`},Ee={class:`text-sm font-medium text-gray-900 dark:text-gray-100 truncate`},De={class:`text-xs text-gray-500 dark:text-gray-400 mt-1`},Oe={class:`text-xs text-gray-500 dark:text-gray-400`},ke={class:`flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity`},Ae={class:`flex space-x-2`},je=[`onClick`],Me=[`onClick`],Ne={key:3,class:`bg-white dark:bg-gray-800 shadow rounded-lg p-8`},Pe={class:`text-center`},Fe={key:4,class:`fixed inset-0 z-50 overflow-y-auto`,"aria-labelledby":`modal-title`,role:`dialog`,"aria-modal":`true`},Ie={class:`flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0`},Le={class:`inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6`},Re={class:`absolute top-0 right-0 pt-4 pr-4`},ze={class:`mt-3 text-center sm:mt-5`},Be={class:`text-lg leading-6 font-medium text-gray-900 dark:text-gray-100 mb-4`},Ve={key:0,class:`max-h-96 overflow-auto`},He=[`src`,`alt`],Ue={key:1,class:`flex items-center justify-center py-8`},We={key:1,class:`h-96`},Ge=[`src`],Ke={key:1,class:`flex items-center justify-center py-8`},qe={key:2,class:`text-center py-8`},Je={class:`mt-5 sm:mt-6 flex justify-center space-x-3`};var V=a({__name:`ViewPage`,setup(a){let d=ce(),T=se(),E=pe(),{showError:V}=oe(),H=l(!0),U=l(null),Ye=p(()=>Number(T.params.id)),W=l(!1),G=l(null),K=l(``),q=p(()=>E.currentExpenseTransaction),J=async e=>{await w.download(e)},Y=async e=>{try{G.value=e,W.value=!0;let t=await w.preview(e.id);K.value=t.preview_url}catch(t){console.error(`Error getting preview URL:`,t),K.value=Ze(e)}},X=()=>{W.value=!1,G.value=null,K.value=``},Xe=e=>Z(e)||Q(e),Z=e=>{let t=e.file_extension?.toLowerCase();return[`jpg`,`jpeg`,`png`,`gif`,`bmp`,`svg`,`webp`].includes(t||``)},Q=e=>{let t=e.file_extension?.toLowerCase();return t===`pdf`},Ze=e=>{let t=`http://127.0.0.1:8000`;return`${t}/api/documents/${e.id}/preview`},Qe=r=>{let i=r?.toLowerCase();return[`jpg`,`jpeg`,`png`,`gif`,`bmp`,`svg`].includes(i)?e:[`pdf`].includes(i)?n:t},$e=async()=>{try{H.value=!0,U.value=null,await E.fetchExpenseTransaction(Ye.value),!E.currentExpenseTransaction&&(U.value=`Transaction not found`)}catch(e){U.value=e.response?.data?.message||`Failed to load transaction details`,V(U.value)}finally{H.value=!1}},et=()=>{q.value&&d.push({name:`expenses.transactions.edit`,params:{id:q.value.id}})},$=()=>{d.go(-1)};return ne(()=>{$e()}),re(()=>{E.clearCurrentExpenseTransaction()}),(e,t)=>{let n=s(`X`),a=s(`FileTextIcon`);return o(),_(`div`,O,[m(`div`,k,[m(`div`,A,[m(`div`,j,[m(`button`,{onClick:$,class:`inline-flex items-center p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors`},[y(u(te),{class:`w-5 h-5`})]),m(`div`,null,[m(`h1`,M,f(q.value?.subject||`Expense Transaction Details`),1),m(`p`,N,` Transaction Code: `+f(q.value?.code),1)])]),m(`div`,P,[q.value?(o(),_(`span`,F,f(u(b)(q.value.amount)),1)):g(``,!0),m(`button`,{onClick:et,class:`inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700`},[y(u(ue),{class:`w-4 h-4 mr-2`}),t[1]||=v(` Edit `,-1)])])])]),H.value?(o(),_(`div`,I,t[2]||=[m(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-4`},null,-1),m(`span`,{class:`text-gray-600 dark:text-gray-400`},`Loading transaction details...`,-1)])):U.value?(o(),_(`div`,L,[m(`div`,R,[y(u(ee),{class:`w-6 h-6 text-red-500 mr-3`}),m(`div`,null,[t[3]||=m(`h3`,{class:`text-lg font-medium text-red-800 dark:text-red-300`},`Error Loading Transaction`,-1),m(`p`,z,f(U.value),1)])])])):q.value?(o(),_(`div`,B,[y(S,{title:`Transaction Information`},{default:c(()=>[y(C,{label:`Transaction Date`,value:u(de)(q.value.date)},null,8,[`value`]),y(C,{label:`Code`},{default:c(()=>[m(`span`,me,f(q.value.code),1)]),_:1}),y(C,{label:`Amount`},{default:c(()=>[m(`span`,he,f(u(b)(q.value.amount)),1)]),_:1}),y(C,{label:`Subject`,value:q.value.subject||`No subject provided`},null,8,[`value`]),y(C,{label:`Expense Category`,value:q.value.expense_category?.name},null,8,[`value`]),y(C,{label:`Account`,value:q.value.account?.name},null,8,[`value`])]),_:1}),q.value.order_number||q.value.check_number||q.value.bank_ref_number?(o(),h(S,{key:0,title:`Reference Information`,gridCols:`cols-3`},{default:c(()=>[y(C,{label:`Order Number`,value:q.value.order_number},null,8,[`value`]),y(C,{label:`Check Number`,value:q.value.check_number},null,8,[`value`]),y(C,{label:`Bank Reference`,value:q.value.bank_ref_number},null,8,[`value`])]),_:1})):g(``,!0),q.value.note?(o(),h(S,{key:1,title:`Notes`},{default:c(()=>[y(C,{label:`Notes`,class:`sm:col-span-3`},{default:c(()=>[m(`p`,ge,f(q.value.note),1)]),_:1})]),_:1})):g(``,!0),q.value.documents&&q.value.documents.length>0?(o(),_(`div`,_e,[m(`div`,ve,[m(`div`,ye,[m(`h3`,be,` Documents (`+f(q.value.documents.length)+`) `,1)])]),m(`div`,xe,[m(`div`,Se,[(o(!0),_(le,null,ie(q.value.documents,e=>(o(),_(`div`,{key:e.id,class:`relative group bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors`},[m(`div`,Ce,[m(`div`,we,[(o(),h(ae(Qe(e.file_extension)),{class:`h-8 w-8 text-gray-400`}))]),m(`div`,Te,[m(`p`,Ee,f(e.title||e.original_name),1),m(`p`,De,f(e.file_size_human),1),m(`p`,Oe,f(u(x)(e.created_at)),1)]),m(`div`,ke,[m(`div`,Ae,[Xe(e)?(o(),_(`button`,{key:0,onClick:t=>Y(e),class:`text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300`,title:`Preview`},[y(u(r),{class:`h-5 w-5`})],8,je)):g(``,!0),m(`button`,{onClick:t=>J(e),class:`text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300`,title:`Download`},[y(D,{class:`h-5 w-5`})],8,Me)])])])]))),128))])])])):g(``,!0),y(fe,{item:q.value,formatDateTime:u(x)},null,8,[`item`,`formatDateTime`])])):(o(),_(`div`,Ne,[m(`div`,Pe,[y(u(i),{class:`h-12 w-12 mx-auto text-gray-400`}),t[4]||=m(`h3`,{class:`text-lg font-medium text-gray-900 dark:text-white mb-2`},` Transaction Not Found `,-1),t[5]||=m(`p`,{class:`text-gray-600 dark:text-gray-400 mb-4`},` The expense transaction you're looking for could not be found. `,-1),m(`button`,{onClick:$,class:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`},` Go Back `)])])),W.value?(o(),_(`div`,Fe,[m(`div`,Ie,[m(`div`,{class:`fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity`,onClick:X}),m(`div`,Le,[m(`div`,Re,[m(`button`,{onClick:X,class:`bg-white dark:bg-gray-800 rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none`},[y(n,{class:`h-6 w-6`})])]),m(`div`,ze,[m(`h3`,Be,f(G.value?.title||G.value?.original_name),1),G.value&&Z(G.value)?(o(),_(`div`,Ve,[K.value?(o(),_(`img`,{key:0,src:K.value,alt:G.value.original_name,class:`max-w-full h-auto mx-auto rounded-lg shadow-lg`},null,8,He)):(o(),_(`div`,Ue,t[6]||=[m(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-4`},null,-1),m(`span`,{class:`text-gray-600 dark:text-gray-400`},`Loading preview...`,-1)]))])):G.value&&Q(G.value)?(o(),_(`div`,We,[K.value?(o(),_(`iframe`,{key:0,src:K.value,class:`w-full h-full border rounded-lg`,title:`PDF Preview`,frameborder:`0`},null,8,Ge)):(o(),_(`div`,Ke,t[7]||=[m(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-4`},null,-1),m(`span`,{class:`text-gray-600 dark:text-gray-400`},`Loading preview...`,-1)]))])):(o(),_(`div`,qe,[y(a,{class:`mx-auto h-12 w-12 text-gray-400 mb-4`}),t[8]||=m(`p`,{class:`text-gray-500 dark:text-gray-400`},`Preview not available for this file type.`,-1)]))]),m(`div`,Je,[m(`button`,{onClick:t[0]||=e=>J(G.value),class:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700`},[y(D,{class:`h-4 w-4 mr-2`}),t[9]||=v(` Download `,-1)]),m(`button`,{onClick:X,class:`inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600`},` Close `)])])])])):g(``,!0)])}}}),H=V;export{H as default};